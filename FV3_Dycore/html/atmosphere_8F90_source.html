<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FV3DYCORE: /Users/valbona/GFDL_atmos_cubed_sphere/driver/fvGFS/atmosphere.F90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ccpp_dox_extra_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="UFSLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FV3DYCORE
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('atmosphere_8F90_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">atmosphere.F90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="atmosphere_8F90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">!***********************************************************************</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">!*                   GNU Lesser General Public License                 </span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">!*</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">!* This file is part of the FV3 dynamical core.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">!*</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">!* The FV3 dynamical core is free software: you can redistribute it </span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">!* and/or modify it under the terms of the</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">!* GNU Lesser General Public License as published by the</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">!* Free Software Foundation, either version 3 of the License, or </span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">!* (at your option) any later version.</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">!*</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">!* The FV3 dynamical core is distributed in the hope that it will be </span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">!* useful, but WITHOUT ANYWARRANTY; without even the implied warranty </span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">!* of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  </span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">!* See the GNU General Public License for more details.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">!*</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">!* You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">!* License along with the FV3 dynamical core.  </span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">!* If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">!***********************************************************************</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html">   26</a></span>&#160;<span class="keyword">module</span> <a class="code" href="namespaceatmosphere__mod.html">atmosphere_mod</a></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">! &lt;table&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">! &lt;tr&gt;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">!     &lt;th&gt;Module Name&lt;/th&gt;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">!     &lt;th&gt;Functions Included&lt;/th&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">!     &lt;td&gt;block_control_mod&lt;/td&gt;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">!     &lt;td&gt;block_control_type&lt;/td&gt;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">!     &lt;td&gt;constants_mod&lt;/td&gt;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">!     &lt;td&gt;cp_air, rdgas, grav, rvgas, kappa, pstd_mks&lt;/td&gt;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">!     &lt;td&gt;field_manager_mod&lt;/td&gt;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">!     &lt;td&gt;MODEL_ATMOS&lt;/td&gt;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">!     &lt;td&gt;fms_mod&lt;/td&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">!     &lt;td&gt;file_exist, open_namelist_file,close_file, error_mesg, FATAL,</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">!         check_nml_error, stdlog,write_version_number,set_domain,</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">!         mpp_clock_id, mpp_clock_begin, mpp_clock_end, CLOCK_SUBCOMPONENT, </span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">!         clock_flag_default, nullify_domain&lt;/td&gt;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">!     &lt;td&gt;fv_arrays_mod&lt;/td&gt;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">!     &lt;td&gt;fv_atmos_type, R_GRID&lt;/td&gt;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">!     &lt;td&gt;fv_control_mod&lt;/td&gt;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">!     &lt;td&gt;fv_init, fv_end, ngrids&lt;/td&gt;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">!     &lt;td&gt;fv_diagnostics_mod&lt;/td&gt;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">!     &lt;td&gt;fv_diag_init, fv_diag, fv_time, prt_maxmin, prt_height&lt;/td&gt;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">!     &lt;td&gt;fv_dynamics_mod&lt;/td&gt;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">!     &lt;td&gt;fv_dynamics&lt;/td&gt;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">!     &lt;td&gt;fv_eta_mod&lt;/td&gt;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">!     &lt;td&gt;get_eta_level&lt;/td&gt;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">!     &lt;td&gt;fv_fill_mod&lt;/td&gt;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">!     &lt;td&gt;fill_gfs&lt;/td&gt;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">!     &lt;td&gt;fv_mp_mod&lt;/td&gt;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">!     &lt;td&gt;switch_current_Atm&lt;/td&gt;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">!     &lt;td&gt;fv_nesting_mod&lt;/td&gt;</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">!     &lt;td&gt;twoway_nesting&lt;/td&gt;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">!     &lt;td&gt;fv_nggps_diags_mod&lt;/td&gt;</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">!     &lt;td&gt;fv_nggps_diag_init, fv_nggps_diag&lt;/td&gt;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">!     &lt;td&gt;fv_nwp_nudge_mod&lt;/td&gt;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">!     &lt;td&gt;fv_nwp_nudge_init, fv_nwp_nudge_end, do_adiabatic_init&lt;/td&gt;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">!     &lt;td&gt;fv_restart_mod&lt;/td&gt;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">!     &lt;td&gt;fv_restart, fv_write_restart&lt;/td&gt;</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">!     &lt;td&gt;fv_sg_mod&lt;/td&gt;</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">!     &lt;td&gt;fv_subgrid_z&lt;/td&gt;</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">!     &lt;td&gt;fv_timing_mod&lt;/td&gt;</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">!     &lt;td&gt;timing_on, timing_off&lt;/td&gt;</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">!     &lt;td&gt;fv_update_phys_mod&lt;/td&gt;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">!     &lt;td&gt;fv_update_phys&lt;/td&gt;</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">!     &lt;td&gt;IPD_typedefs_mod&lt;/td&gt;</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">!     &lt;td&gt;IPD_data_type, kind_phys =&gt; IPD_kind_phys&lt;/td&gt;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">!     &lt;td&gt;mpp_mod&lt;/td&gt;</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">!     &lt;td&gt;mpp_error, stdout, FATAL, NOTE, input_nml_file, mpp_root_pe,</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">!                    mpp_npes, mpp_pe, mpp_chksum,mpp_get_current_pelist,     </span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">!                    mpp_set_current_pelist&lt;/td&gt;</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">!     &lt;td&gt;mpp_domains_mod&lt;/td&gt;</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">!     &lt;td&gt;mpp_get_data_domain, mpp_get_compute_domain, domain2d, mpp_update_domains&lt;/td&gt;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">!     &lt;td&gt;mpp_parameter_mod&lt;/td&gt;</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">!     &lt;td&gt;EUPDATE, WUPDATE, SUPDATE, NUPDATE&lt;/td&gt;</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">!     &lt;td&gt;time_manager_mod&lt;/td&gt;</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">!     &lt;td&gt;time_type, get_time, set_time, operator(+), operator(-)&lt;/td&gt;</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">!     &lt;td&gt;tracer_manager_mod&lt;/td&gt;</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">!     &lt;td&gt;get_tracer_index, get_number_tracers, NO_TRACER&lt;/td&gt;</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">!   &lt;tr&gt;</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">!     &lt;td&gt;xgrid_mod&lt;/td&gt;</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">!     &lt;td&gt;grid_box_type&lt;/td&gt;</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">!   &lt;/tr&gt;</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">! &lt;/table&gt;</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor">#include &lt;fms_platform.h&gt;</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">!-----------------</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">! FMS modules:</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">!-----------------</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="keywordtype">use </span>block_control_mod,      <span class="keywordtype">only</span>: block_control_type</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="keywordtype">use </span>constants_mod,          <span class="keywordtype">only</span>: cp_air, rdgas, grav, rvgas, kappa, pstd_mks</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="keywordtype">use </span>time_manager_mod,       <span class="keywordtype">only</span>: time_type, get_time, set_time, <span class="keyword">operator</span>(+), &amp;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                                  <span class="keyword">operator</span>(-), <span class="keyword">operator</span>(/), time_type_to_real</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="keywordtype">use </span>fms_mod,                <span class="keywordtype">only</span>: file_exist, open_namelist_file,    &amp;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                                  close_file, error_mesg, fatal,     &amp;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                                  check_nml_error, stdlog,           &amp;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                                  write_version_number,              &amp;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                                  set_domain,                        &amp;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                                  read_data,                         &amp;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                                  mpp_clock_id, mpp_clock_begin,     &amp;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                                  mpp_clock_end, clock_subcomponent, &amp;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                                  clock_flag_default, nullify_domain</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keywordtype">use </span>mpp_mod,                <span class="keywordtype">only</span>: mpp_error, stdout, fatal, note,    &amp;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                                  input_nml_file, mpp_root_pe,       &amp;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                                  mpp_npes, mpp_pe, mpp_chksum,      &amp;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                                  mpp_get_current_pelist,            &amp;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                                  mpp_set_current_pelist</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="keywordtype">use </span>mpp_parameter_mod,      <span class="keywordtype">only</span>: eupdate, wupdate, supdate, nupdate</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="keywordtype">use </span>mpp_domains_mod,        <span class="keywordtype">only</span>: domain2d, mpp_update_domains</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keywordtype">use </span>xgrid_mod,              <span class="keywordtype">only</span>: grid_box_type</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="keywordtype">use </span>field_manager_mod,      <span class="keywordtype">only</span>: model_atmos</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keywordtype">use </span>tracer_manager_mod,     <span class="keywordtype">only</span>: get_tracer_index, get_number_tracers, &amp;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                                  no_tracer</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacedycore__typedefs.html">dycore_typedefs</a>,        <span class="keywordtype">only</span>: <a class="code" href="structdycore__typedefs_1_1dycore__data__type.html">dycore_data_type</a></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="keywordtype">use </span>ipd_typedefs,           <span class="keywordtype">only</span>: ipd_data_type, kind_phys =&gt; ipd_kind_phys</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__iau__mod.html">fv_iau_mod</a>,             <span class="keywordtype">only</span>: <a class="code" href="structfv__iau__mod_1_1iau__external__data__type.html">iau_external_data_type</a></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">!-----------------</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">! FV core modules:</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">!-----------------</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__arrays__mod.html">fv_arrays_mod</a>,      <span class="keywordtype">only</span>: <a class="code" href="structfv__arrays__mod_1_1fv__atmos__type.html">fv_atmos_type</a>, <a class="code" href="namespacefv__arrays__mod.html#ab0ba8527d270f349a84fa0a330be1923">r_grid</a></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__control__mod.html">fv_control_mod</a>,     <span class="keywordtype">only</span>: <a class="code" href="namespacefv__control__mod.html#ad626f01c20738f5101fb5f64e5d3dcfe">fv_init</a>, <a class="code" href="namespacefv__control__mod.html#a94ddeaf4916cd0adc5a56db5ec3c5081">fv_end</a>, <a class="code" href="namespacefv__control__mod.html#abaa40fc70569bf400e1385f95bae1f5f">ngrids</a></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__eta__mod.html">fv_eta_mod</a>,         <span class="keywordtype">only</span>: <a class="code" href="namespacefv__eta__mod.html#ac666b63cee9afad18f2cf33dbced10f6">get_eta_level</a></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__fill__mod.html">fv_fill_mod</a>,        <span class="keywordtype">only</span>: <a class="code" href="namespacefv__fill__mod.html#a527172ca182ebcb99a72bdbd536165d2">fill_gfs</a></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__dynamics__mod.html">fv_dynamics_mod</a>,    <span class="keywordtype">only</span>: <a class="code" href="namespacefv__dynamics__mod.html#a57030300ce6aacf81a3588faf906f07f">fv_dynamics</a></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__nesting__mod.html">fv_nesting_mod</a>,     <span class="keywordtype">only</span>: <a class="code" href="namespacefv__nesting__mod.html#afedcc378d1c25e2b9d58ea796dc10b9b">twoway_nesting</a></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__diagnostics__mod.html">fv_diagnostics_mod</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacefv__diagnostics__mod.html#acfb51973f4727b7ba5e27a04b28d3396">fv_diag_init</a>, <a class="code" href="namespacefv__diagnostics__mod.html#a6f0646bd762a9150bf0636f22f70cfbc">fv_diag</a>, <a class="code" href="namespacefv__diagnostics__mod.html#ad47b1fcfcd29f3dc6009a3a52208a573">fv_time</a>, <a class="code" href="namespacefv__diagnostics__mod.html#a1fad494d94b2fd086c4003778d3f9f63">prt_maxmin</a>, <a class="code" href="namespacefv__diagnostics__mod.html#a2caa18f65b49b0d404e4eee6e8514441">prt_height</a></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__nggps__diags__mod.html">fv_nggps_diags_mod</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacefv__nggps__diags__mod.html#ab37da1eb0394d52c06db856e9f875833">fv_nggps_diag_init</a>, <a class="code" href="namespacefv__nggps__diags__mod.html#a2067cd5af978609a6dc1614795abea87">fv_nggps_diag</a>, <a class="code" href="namespacefv__nggps__diags__mod.html#a87ed4a1f80258a1b15835104526747e8">fv_nggps_tavg</a></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__restart__mod.html">fv_restart_mod</a>,     <span class="keywordtype">only</span>: <a class="code" href="namespacefv__restart__mod.html#aaa447f67223fef4de61917a1a912a133">fv_restart</a>, <a class="code" href="namespacefv__restart__mod.html#a4e73a658fb6e3a1e2425e248c355a777">fv_write_restart</a></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__timing__mod.html">fv_timing_mod</a>,      <span class="keywordtype">only</span>: <a class="code" href="namespacefv__timing__mod.html#a85fb4c4c6b3d9604bb682356ab3e7a82">timing_on</a>, <a class="code" href="namespacefv__timing__mod.html#ad40e8855859ae4d87ac63985163a1c3d">timing_off</a></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__mp__mod.html">fv_mp_mod</a>,          <span class="keywordtype">only</span>: switch_current_atm</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__sg__mod.html">fv_sg_mod</a>,          <span class="keywordtype">only</span>: <a class="code" href="namespacefv__sg__mod.html#a12f8e293e862927c307b386cdd8217cb">fv_subgrid_z</a></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__update__phys__mod.html">fv_update_phys_mod</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacefv__update__phys__mod.html#a07d63d9929b6cb44156f6ceb8bc27728">fv_update_phys</a></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacefv__nwp__nudge__mod.html">fv_nwp_nudge_mod</a>,   <span class="keywordtype">only</span>: <a class="code" href="namespacefv__nwp__nudge__mod.html#ac6397ea7496a338d4a086a95bb58fa38">fv_nwp_nudge_init</a>, <a class="code" href="namespacefv__nwp__nudge__mod.html#a824609f6aaef3ce3b013048f4402ecb6">fv_nwp_nudge_end</a>, <a class="code" href="namespacefv__nwp__nudge__mod.html#a1be70541c37811b39b54dcf8d977feac">do_adiabatic_init</a></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor">#ifdef MULTI_GASES</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="preprocessor"></span><span class="keywordtype">use </span><a class="code" href="namespacemulti__gases__mod.html">multi_gases_mod</a>,  <span class="keywordtype">only</span>: <a class="code" href="namespacemulti__gases__mod.html#a91649465dfa64dee4a0aa4db33496b34">virq</a>, <a class="code" href="namespacemulti__gases__mod.html#ab6332eff515faa91fd8560fff744f704">virq_max</a>, <a class="code" href="namespacemulti__gases__mod.html#ada7f0ffe52c60fbe7f6cafd04490c4d8">num_gas</a>, <a class="code" href="namespacemulti__gases__mod.html#acdbd2cbc0014ad073f6daadeffc5cfce">ri</a>, <a class="code" href="namespacemulti__gases__mod.html#a85983a7159ef293fa1c2d65647a66400">cpi</a></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="preprocessor"></span><span class="keywordtype">use </span><a class="code" href="namespacefv__regional__mod.html">fv_regional_mod</a>,    <span class="keywordtype">only</span>: <a class="code" href="namespacefv__regional__mod.html#a0d3b818eb47e19e7254ccd506c5a5895">start_regional_restart</a>, <a class="code" href="namespacefv__regional__mod.html#ae3ebee89f81e0493a8c7e17875152d72">read_new_bc_data</a>, &amp;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                              <a class="code" href="namespacefv__regional__mod.html#a7d48ecf3376e882113cf29f2c50b996c">a_step</a>, <a class="code" href="namespacefv__regional__mod.html#a829242ae29d3a80d8bf09dbc093cbac0">p_step</a>, <a class="code" href="namespacefv__regional__mod.html#acb12d0df0e8fb775d3a41fba0b0f34e9">current_time_in_seconds</a></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="keywordtype">use </span>mpp_domains_mod,    <span class="keywordtype">only</span>:  mpp_get_data_domain, mpp_get_compute_domain</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="keywordtype">implicit none</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keywordtype">private</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">!--- driver routines</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="keywordtype">public</span> :: <a class="code" href="namespaceatmosphere__mod.html#a38757921a7432338ac2a4135dbc7d9c8">atmosphere_init</a>, <a class="code" href="namespaceatmosphere__mod.html#ac8fcb2d928bac9a8e1d31fb4bd5fe3b1">atmosphere_end</a>, <a class="code" href="namespaceatmosphere__mod.html#a1648cbd61c86f2e8890375435b532a5d">atmosphere_restart</a>, &amp;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;          <a class="code" href="namespaceatmosphere__mod.html#a46726a89e78937df996b8fa2987af885">atmosphere_dynamics</a>, <a class="code" href="namespaceatmosphere__mod.html#abf96613ef8db32b3e66f3297f62a0346">atmosphere_state_update</a></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">!--- utility routines</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="keywordtype">public</span> :: <a class="code" href="namespaceatmosphere__mod.html#a55d141fa3702c01dae8e656e283827dc">atmosphere_resolution</a>,   <a class="code" href="namespaceatmosphere__mod.html#a3f2bb9d476f9525e20747fd29951dde5">atmosphere_grid_bdry</a>,         &amp;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;          <a class="code" href="namespaceatmosphere__mod.html#a9a51c2f1c5e1cf01dcf112478ecf8cf4">atmosphere_grid_ctr</a>,     <a class="code" href="namespaceatmosphere__mod.html#a35547644843aec32773bc727b07252de">atmosphere_domain</a>,            &amp;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;          <a class="code" href="namespaceatmosphere__mod.html#adc8bdf1db2df9551cfc25a0c1f7b1385">atmosphere_control_data</a>, <a class="code" href="namespaceatmosphere__mod.html#a15f14a6344439b29298bfb2b37d9c694">atmosphere_pref</a>,              &amp;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;          <a class="code" href="namespaceatmosphere__mod.html#af5d819faa34aef7024501c7696540bf0">atmosphere_diag_axes</a>,    <a class="code" href="namespaceatmosphere__mod.html#ad2c962b25778b4cbd91b48874a52ab95">atmosphere_etalvls</a>,           &amp;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;          <a class="code" href="namespaceatmosphere__mod.html#af16043b77ee4e18b8a8497ad49cfd670">atmosphere_hgt</a>,          <a class="code" href="namespaceatmosphere__mod.html#af9fa6ffe6500a97af113b7a6afb348a6">atmosphere_scalar_field_halo</a>, &amp;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">! experimental APIs not ready for use</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">!         atmosphere_tracer_postinit, &amp;</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;          <a class="code" href="namespaceatmosphere__mod.html#a5966b09ae320c441007e26cc72e00cea">atmosphere_diss_est</a>,         &amp; <span class="comment">! dissipation estimate for SKEB </span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;          <a class="code" href="namespaceatmosphere__mod.html#af09657a508e73ba69d7a3abeb88d034f">atmosphere_get_bottom_layer</a>, &amp;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;          <a class="code" href="namespaceatmosphere__mod.html#a008a0c84b653d2f8027039570957c12c">atmosphere_nggps_diag</a>,       &amp;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;          <a class="code" href="namespaceatmosphere__mod.html#a2b3029ec0c463f6b1b3b3b6f1b5a0ada">set_atmosphere_pelist</a></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">!--- physics/radiation data exchange routines</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="keywordtype">public</span> :: <a class="code" href="namespaceatmosphere__mod.html#a5dfb607fd7c0bb4cd771a72f1daf8ded">atmos_phys_driver_statein</a></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">! version number of this module</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">! Include variable &quot;version&quot; to be written to log file.</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="preprocessor">#include&lt;file_version.h&gt;</span></div><div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#ad4f4fdf067d2b71eb5764b34cea8cb92">  225</a></span>&#160;<span class="preprocessor"></span><span class="keywordtype">character(len=20)</span>   :: <a class="code" href="namespaceatmosphere__mod.html#ad4f4fdf067d2b71eb5764b34cea8cb92">mod_name</a> = <span class="stringliteral">&#39;fvGFS/atmosphere_mod&#39;</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">!---- private data ----</span></div><div class="line"><a name="l00228"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a6d42cfe750246363957a2e0aaa251f0b">  228</a></span>&#160;  type(time_type) :: <a class="code" href="namespaceatmosphere__mod.html#a6d42cfe750246363957a2e0aaa251f0b">time_step_atmos</a></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordtype">public</span> <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>, <a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="comment">!These are convenience variables for local use only, and are set to values in Atm%</span></div><div class="line"><a name="l00232"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">  232</a></span>&#160;  <span class="keywordtype">real</span>    :: <a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a></div><div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">  233</a></span>&#160;  <span class="keywordtype">real</span>    :: <a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a></div><div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a3ae095d62282ac16560419aa858cbd5b">  234</a></span>&#160;  <span class="keywordtype">integer</span> :: <a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>, <a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a>, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>, <a class="code" href="namespaceatmosphere__mod.html#a9a8c995d33f2c1869ae7d0b49d5e1002">ncnst</a>, <a class="code" href="namespaceatmosphere__mod.html#a3ae095d62282ac16560419aa858cbd5b">pnats</a></div><div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">  235</a></span>&#160;  <span class="keywordtype">integer</span> :: <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>, <a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>, <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>, <a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a></div><div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a972cd4fc5737c35941feca9dbb6e46a8">  236</a></span>&#160;  <span class="keywordtype">integer</span> :: <a class="code" href="namespaceatmosphere__mod.html#a26b6f2e397bc0d76f12ae674aad670be">isd</a>, <a class="code" href="namespaceatmosphere__mod.html#a775666c64f59edcf96c530c1fc0f1ee9">ied</a>, <a class="code" href="namespaceatmosphere__mod.html#a972cd4fc5737c35941feca9dbb6e46a8">jsd</a>, <a class="code" href="namespaceatmosphere__mod.html#a0d51bfe05ec1bd062c1fbbc01c42bf3a">jed</a></div><div class="line"><a name="l00237"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">  237</a></span>&#160;  <span class="keywordtype">integer</span> :: <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>                       <span class="comment">!  number of transported tracers</span></div><div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#aafb92c94f8850295ad027e0538ae78ca">  238</a></span>&#160;  <span class="keywordtype">integer</span> :: <a class="code" href="namespaceatmosphere__mod.html#abe192872a4a5b42159d0c2251ac9cb14">sec</a>, <a class="code" href="namespaceatmosphere__mod.html#aafb92c94f8850295ad027e0538ae78ca">seconds</a>, <a class="code" href="namespaceatmosphere__mod.html#a110bc10bed586ca2cddc28ac924959a7">days</a></div><div class="line"><a name="l00239"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#af368e346f77c2d615969072223e3edad">  239</a></span>&#160;  <span class="keywordtype">integer</span> :: <a class="code" href="namespaceatmosphere__mod.html#ac1b450b5b014a927fb0456a5b8e73710">id_dynam</a>, <a class="code" href="namespaceatmosphere__mod.html#a6d434f016963346507b32a22b7f41440">id_fv_diag</a>, <a class="code" href="namespaceatmosphere__mod.html#af368e346f77c2d615969072223e3edad">id_subgridz</a></div><div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a6f65980184c149309238cf3926145607">  240</a></span>&#160;  <span class="keywordtype">logical</span> :: <a class="code" href="namespaceatmosphere__mod.html#a6f65980184c149309238cf3926145607">cold_start</a> = .false.     <span class="comment">!  used in initial condition</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#ae021e6f5700c65ee41c520e77e44712d">  242</a></span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: <a class="code" href="namespaceatmosphere__mod.html#ae021e6f5700c65ee41c520e77e44712d">id_tracerdt_dyn</a></div><div class="line"><a name="l00243"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a794b092a72b516a3078dbff077136a08">  243</a></span>&#160;  <span class="keywordtype">integer</span> :: <a class="code" href="namespaceatmosphere__mod.html#a794b092a72b516a3078dbff077136a08">sphum</a>, <a class="code" href="namespaceatmosphere__mod.html#a41f34859d8c8fd6e84cd71aabd6d2a25">liq_wat</a>, <a class="code" href="namespaceatmosphere__mod.html#ad9345d06c2a877903e3bfdfb529a2a63">rainwat</a>, <a class="code" href="namespaceatmosphere__mod.html#a9d5b133b6c0010773c3f475af7e879fc">ice_wat</a>, <a class="code" href="namespaceatmosphere__mod.html#a638b8d7ecc568cfe3706105b9db0affe">snowwat</a>, <a class="code" href="namespaceatmosphere__mod.html#a6af183d451e4d59e5cd97150b69e9ec7">graupel</a>  <span class="comment">! condensate species tracer indices</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="preprocessor">#ifdef CCPP</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">integer</span> :: cld_amt</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00248"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">  248</a></span>&#160;  <span class="keywordtype">integer</span> :: <a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>  = 1</div><div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a95ee36e402cdda22fbff7a5e5a698d2d">  249</a></span>&#160;  <span class="keywordtype">integer</span> :: <a class="code" href="namespaceatmosphere__mod.html#a95ee36e402cdda22fbff7a5e5a698d2d">p_split</a> = 1</div><div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a40b6e75a5e8c4bafc747edc08eceaed5">  250</a></span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: <a class="code" href="namespaceatmosphere__mod.html#a40b6e75a5e8c4bafc747edc08eceaed5">pelist</a>(:)</div><div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#ad80223528e58b40110f8a1ffdd3b9aad">  251</a></span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">allocatable</span> :: <a class="code" href="namespaceatmosphere__mod.html#ad80223528e58b40110f8a1ffdd3b9aad">grids_on_this_pe</a>(:)</div><div class="line"><a name="l00252"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">  252</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structfv__arrays__mod_1_1fv__atmos__type.html">fv_atmos_type</a>), <span class="keywordtype">allocatable</span>, <span class="keywordtype">target</span> :: <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(:)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#aa372781c11fb092462ce67e7d29f3cb0">  254</a></span>&#160;  <span class="keywordtype">integer</span> :: <a class="code" href="namespaceatmosphere__mod.html#a0c326e48546ef823bdc928ba03bac964">id_udt_dyn</a>, <a class="code" href="namespaceatmosphere__mod.html#aa372781c11fb092462ce67e7d29f3cb0">id_vdt_dyn</a></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#ac2c4834fc822689255bc707f8405fed1">  256</a></span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span>:: <a class="code" href="namespaceatmosphere__mod.html#ac2c4834fc822689255bc707f8405fed1">w0_big</a> = 60.  <span class="comment">! to prevent negative w-tracer diffusion</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">!---dynamics tendencies for use in fv_subgrid_z and during fv_update_phys</span></div><div class="line"><a name="l00259"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a8245233dc81e751888853150262e6489">  259</a></span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span>   :: <a class="code" href="namespaceatmosphere__mod.html#a9f0ef35864e057ad8b3b0d5b644cff55">u_dt</a>, <a class="code" href="namespaceatmosphere__mod.html#a8245233dc81e751888853150262e6489">v_dt</a>, <a class="code" href="namespaceatmosphere__mod.html#adeb134091a56f59ab4c371a3855a6bdc">t_dt</a></div><div class="line"><a name="l00260"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">  260</a></span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">allocatable</span>                     :: <a class="code" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">pref</a>(:,:), <a class="code" href="namespaceatmosphere__mod.html#ab2d51769b2b98337ac742bc3f80d55a7">dum1d</a>(:)</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#ad7cd98f866fa2b4b4f8528f385d7efc1">  262</a></span>&#160;  <span class="keywordtype">logical</span> :: <a class="code" href="namespaceatmosphere__mod.html#ad7cd98f866fa2b4b4f8528f385d7efc1">first_diag</a> = .true.</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="keyword">contains</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a38757921a7432338ac2a4135dbc7d9c8">atmosphere_init</a> (Time_init, Time, Time_step, Grid_box, area)</div><div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a38757921a7432338ac2a4135dbc7d9c8">  271</a></span>&#160;<span class="preprocessor">#ifdef CCPP</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifdef STATIC</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="preprocessor"></span><span class="comment">! For static builds, the ccpp_physics_{init,run,finalize} calls</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">! are not pointing to code in the CCPP framework, but to auto-generated</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">! ccpp_suite_cap and ccpp_group_*_cap modules behind a ccpp_static_api</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;   <span class="keywordtype">use </span>ccpp_api,          <span class="keywordtype">only</span>: ccpp_init</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   <span class="keywordtype">use </span>ccpp_static_api,   <span class="keywordtype">only</span>: ccpp_physics_init</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor"></span>   <span class="keywordtype">use </span>iso_c_binding,     <span class="keywordtype">only</span>: c_loc</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   <span class="keywordtype">use </span>ccpp_api,          <span class="keywordtype">only</span>: ccpp_init,           &amp;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                ccpp_physics_init,   &amp;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                                ccpp_field_add,      &amp;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                                ccpp_error</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="preprocessor"></span>   <span class="keywordtype">use </span>ccpp_data,         <span class="keywordtype">only</span>: ccpp_suite,          &amp;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                                cdata =&gt; cdata_tile, &amp;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                                ccpp_interstitial</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="preprocessor">#ifdef OPENMP</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor"></span>   <span class="keywordtype">use </span>omp_lib</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef STATIC</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="preprocessor"></span><span class="comment">! Begin include auto-generated list of modules for ccpp</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="preprocessor">#include &quot;ccpp_modules_fast_physics.inc&quot;</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor"></span><span class="comment">! End include auto-generated list of modules for ccpp</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="preprocessor"></span>   type(time_type),    <span class="keywordtype">intent(in)</span>    :: time_init, time, time_step</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;   <span class="keywordtype">type</span>(grid_box_type), <span class="keywordtype">intent(inout)</span> :: grid_box</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;   <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: area</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">!--- local variables ---</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   <span class="keywordtype">integer</span> :: i, n</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">!  integer :: itrac</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;   <span class="keywordtype">logical</span> :: do_atmos_nudge</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   <span class="keywordtype">character(len=32)</span> :: tracer_name, tracer_units</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;   <span class="keywordtype">real</span>    :: ps1, ps2</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor">#ifdef CCPP</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="preprocessor"></span>   <span class="keywordtype">integer</span> :: nthreads</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   <span class="keywordtype">integer</span> :: ierr</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;   <a class="code" href="namespacefv__regional__mod.html#acb12d0df0e8fb775d3a41fba0b0f34e9">current_time_in_seconds</a> = time_type_to_real( time - time_init )</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;   <span class="keywordflow">if</span> (mpp_pe() == 0) <span class="keyword">write</span>(*,<span class="stringliteral">&quot;(&#39;atmosphere_init: current_time_seconds = &#39;,f9.1)&quot;</span>)<a class="code" href="namespacefv__regional__mod.html#acb12d0df0e8fb775d3a41fba0b0f34e9">current_time_in_seconds</a></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                    <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#a85fb4c4c6b3d9604bb682356ab3e7a82">timing_on</a>(<span class="stringliteral">&#39;ATMOS_INIT&#39;</span>)</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;   <span class="keyword">allocate</span>(<a class="code" href="namespaceatmosphere__mod.html#a40b6e75a5e8c4bafc747edc08eceaed5">pelist</a>(mpp_npes()))</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;   <span class="keyword">call </span>mpp_get_current_pelist(<a class="code" href="namespaceatmosphere__mod.html#a40b6e75a5e8c4bafc747edc08eceaed5">pelist</a>)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a> = rvgas/rdgas - 1.</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">!---- compute physics/atmos time step in seconds ----</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a6d42cfe750246363957a2e0aaa251f0b">time_step_atmos</a> = time_step</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;   <span class="keyword">call </span>get_time (<a class="code" href="namespaceatmosphere__mod.html#a6d42cfe750246363957a2e0aaa251f0b">time_step_atmos</a>, <a class="code" href="namespaceatmosphere__mod.html#abe192872a4a5b42159d0c2251ac9cb14">sec</a>)</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a> = <span class="keywordtype">real</span>(<a class="code" href="namespaceatmosphere__mod.html#abe192872a4a5b42159d0c2251ac9cb14">sec</a>)</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">!----- initialize FV dynamical core -----</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <span class="comment">!NOTE do we still need the second file_exist call?</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a6f65980184c149309238cf3926145607">cold_start</a> = (.not.file_exist(<span class="stringliteral">&#39;INPUT/fv_core.res.nc&#39;</span>) .and. .not.file_exist(<span class="stringliteral">&#39;INPUT/fv_core.res.tile1.nc&#39;</span>))</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacefv__control__mod.html#ad626f01c20738f5101fb5f64e5d3dcfe">fv_init</a>( <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>, <a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a>, <a class="code" href="namespaceatmosphere__mod.html#ad80223528e58b40110f8a1ffdd3b9aad">grids_on_this_pe</a>, <a class="code" href="namespaceatmosphere__mod.html#a95ee36e402cdda22fbff7a5e5a698d2d">p_split</a> )  <span class="comment">! allocates Atm components</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;   <span class="keywordflow">do</span> n=1,<a class="code" href="namespacefv__control__mod.html#abaa40fc70569bf400e1385f95bae1f5f">ngrids</a></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespaceatmosphere__mod.html#ad80223528e58b40110f8a1ffdd3b9aad">grids_on_this_pe</a>(n)) <a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a> = n</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="keywordflow">   enddo</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%Time_init = time_init</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   <a class="code" href="namespacefv__regional__mod.html#a7d48ecf3376e882113cf29f2c50b996c">a_step</a> = 0</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%warm_start) <span class="keywordflow">then</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;     <a class="code" href="namespacefv__regional__mod.html#a7d48ecf3376e882113cf29f2c50b996c">a_step</a> = nint(<a class="code" href="namespacefv__regional__mod.html#acb12d0df0e8fb775d3a41fba0b0f34e9">current_time_in_seconds</a>/<a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a>)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">!----- write version and namelist to log file -----</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;   <span class="keyword">call </span>write_version_number ( <span class="stringliteral">&#39;fvGFS/ATMOSPHERE_MOD&#39;</span>, version )</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>   = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npx</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a>   = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npy</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>   = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npz</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a9a8c995d33f2c1869ae7d0b49d5e1002">ncnst</a> = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ncnst</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a3ae095d62282ac16560419aa858cbd5b">pnats</a> = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%pnats</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a> = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%isc</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a> = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%iec</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a> = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%jsc</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a> = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%jec</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a26b6f2e397bc0d76f12ae674aad670be">isd</a> = <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a> - <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%ng</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a775666c64f59edcf96c530c1fc0f1ee9">ied</a> = <a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a> + <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%ng</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a972cd4fc5737c35941feca9dbb6e46a8">jsd</a> = <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a> - <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%ng</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a0d51bfe05ec1bd062c1fbbc01c42bf3a">jed</a> = <a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a> + <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%ng</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a> = <a class="code" href="namespaceatmosphere__mod.html#a9a8c995d33f2c1869ae7d0b49d5e1002">ncnst</a>-<a class="code" href="namespaceatmosphere__mod.html#a3ae095d62282ac16560419aa858cbd5b">pnats</a></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a794b092a72b516a3078dbff077136a08">sphum</a>   = get_tracer_index(model_atmos, <span class="stringliteral">&#39;sphum&#39;</span> )</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a41f34859d8c8fd6e84cd71aabd6d2a25">liq_wat</a> = get_tracer_index(model_atmos, <span class="stringliteral">&#39;liq_wat&#39;</span> )</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a9d5b133b6c0010773c3f475af7e879fc">ice_wat</a> = get_tracer_index(model_atmos, <span class="stringliteral">&#39;ice_wat&#39;</span> )</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#ad9345d06c2a877903e3bfdfb529a2a63">rainwat</a> = get_tracer_index(model_atmos, <span class="stringliteral">&#39;rainwat&#39;</span> )</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a638b8d7ecc568cfe3706105b9db0affe">snowwat</a> = get_tracer_index(model_atmos, <span class="stringliteral">&#39;snowwat&#39;</span> )</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a6af183d451e4d59e5cd97150b69e9ec7">graupel</a> = get_tracer_index(model_atmos, <span class="stringliteral">&#39;graupel&#39;</span> )</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="preprocessor">#ifdef CCPP</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="preprocessor"></span>   cld_amt = get_tracer_index(model_atmos, <span class="stringliteral">&#39;cld_amt&#39;</span>)</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;   <span class="keywordflow">if</span> (max(<a class="code" href="namespaceatmosphere__mod.html#a794b092a72b516a3078dbff077136a08">sphum</a>,<a class="code" href="namespaceatmosphere__mod.html#a41f34859d8c8fd6e84cd71aabd6d2a25">liq_wat</a>,<a class="code" href="namespaceatmosphere__mod.html#a9d5b133b6c0010773c3f475af7e879fc">ice_wat</a>,<a class="code" href="namespaceatmosphere__mod.html#ad9345d06c2a877903e3bfdfb529a2a63">rainwat</a>,<a class="code" href="namespaceatmosphere__mod.html#a638b8d7ecc568cfe3706105b9db0affe">snowwat</a>,<a class="code" href="namespaceatmosphere__mod.html#a6af183d451e4d59e5cd97150b69e9ec7">graupel</a>) &gt; <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%nwat) <span class="keywordflow">then</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keyword">call </span>mpp_error (fatal,<span class="stringliteral">&#39; atmosphere_init: condensate species are not first in the list of &amp;</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="stringliteral"></span><span class="stringliteral">                            &amp;tracers defined in the field_table&#39;</span>)</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;   <span class="comment">! Allocate grid variables to be used to calculate gradient in 2nd order flux exchange</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   <span class="comment">! This data is only needed for the COARSEST grid.</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;   <span class="keyword">call </span>switch_current_atm(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>))</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   <span class="keyword">allocate</span>(grid_box%dx    (   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>  , <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>+1))</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   <span class="keyword">allocate</span>(grid_box%dy    (   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>+1, <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  ))</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   <span class="keyword">allocate</span>(grid_box%area  (   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>  , <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  ))</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;   <span class="keyword">allocate</span>(grid_box%edge_w(              <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>+1))</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;   <span class="keyword">allocate</span>(grid_box%edge_e(              <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>+1))</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;   <span class="keyword">allocate</span>(grid_box%edge_s(   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>+1           ))</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   <span class="keyword">allocate</span>(grid_box%edge_n(   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>+1           ))</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;   <span class="keyword">allocate</span>(grid_box%en1   (3, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>  , <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>+1))</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;   <span class="keyword">allocate</span>(grid_box%en2   (3, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>+1, <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  ))</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;   <span class="keyword">allocate</span>(grid_box%vlon  (3, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>  , <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  ))</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;   <span class="keyword">allocate</span>(grid_box%vlat  (3, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>  , <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  ))</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;   grid_box%dx    (   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>  , <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>+1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%dx    (   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,   <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>+1)</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;   grid_box%dy    (   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>+1, <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  ) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%dy    (   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>+1, <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  )</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;   grid_box%area  (   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>  , <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  ) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%area  (   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>  , <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  )</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;   grid_box%edge_w(              <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>+1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%edge_w(              <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>+1)</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;   grid_box%edge_e(              <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>+1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%edge_e(              <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>+1)</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;   grid_box%edge_s(   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>+1           ) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%edge_s(   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>+1)</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;   grid_box%edge_n(   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>+1           ) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%edge_n(   <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>+1)</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;   grid_box%en1   (:, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>  , <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>+1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%en1   (:, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>  , <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>+1)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;   grid_box%en2   (:, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>+1, <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  ) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%en2   (:, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>+1, <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  )</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;   <span class="keywordflow">do</span> i = 1,3</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;     grid_box%vlon(i, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>  , <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  ) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%vlon  (<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a> ,  <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>, i )</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;     grid_box%vlat(i, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>  , <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  ) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%vlat  (<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a> ,  <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>, i )</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="keywordflow">   enddo</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;   <span class="keyword">allocate</span> (area(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>  , <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>  ))</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   area(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%area_64(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>)</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">!----- allocate and zero out the dynamics (and accumulated) tendencies</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;   <span class="keyword">allocate</span>( <a class="code" href="namespaceatmosphere__mod.html#a9f0ef35864e057ad8b3b0d5b644cff55">u_dt</a>(<a class="code" href="namespaceatmosphere__mod.html#a26b6f2e397bc0d76f12ae674aad670be">isd</a>:<a class="code" href="namespaceatmosphere__mod.html#a775666c64f59edcf96c530c1fc0f1ee9">ied</a>,<a class="code" href="namespaceatmosphere__mod.html#a972cd4fc5737c35941feca9dbb6e46a8">jsd</a>:<a class="code" href="namespaceatmosphere__mod.html#a0d51bfe05ec1bd062c1fbbc01c42bf3a">jed</a>,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>), &amp;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;             <a class="code" href="namespaceatmosphere__mod.html#a8245233dc81e751888853150262e6489">v_dt</a>(<a class="code" href="namespaceatmosphere__mod.html#a26b6f2e397bc0d76f12ae674aad670be">isd</a>:<a class="code" href="namespaceatmosphere__mod.html#a775666c64f59edcf96c530c1fc0f1ee9">ied</a>,<a class="code" href="namespaceatmosphere__mod.html#a972cd4fc5737c35941feca9dbb6e46a8">jsd</a>:<a class="code" href="namespaceatmosphere__mod.html#a0d51bfe05ec1bd062c1fbbc01c42bf3a">jed</a>,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>), &amp;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;             <a class="code" href="namespaceatmosphere__mod.html#adeb134091a56f59ab4c371a3855a6bdc">t_dt</a>(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>) )</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">!--- allocate pref</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;   <span class="keyword">allocate</span>(<a class="code" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">pref</a>(<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1,2), <a class="code" href="namespaceatmosphere__mod.html#ab2d51769b2b98337ac742bc3f80d55a7">dum1d</a>(<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1))</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;   <span class="keyword">call </span>set_domain ( <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%domain )</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacefv__restart__mod.html#aaa447f67223fef4de61917a1a912a133">fv_restart</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%domain, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>, <a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a>, <a class="code" href="namespaceatmosphere__mod.html#aafb92c94f8850295ad027e0538ae78ca">seconds</a>, <a class="code" href="namespaceatmosphere__mod.html#a110bc10bed586ca2cddc28ac924959a7">days</a>, <a class="code" href="namespaceatmosphere__mod.html#a6f65980184c149309238cf3926145607">cold_start</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%grid_type, <a class="code" href="namespaceatmosphere__mod.html#ad80223528e58b40110f8a1ffdd3b9aad">grids_on_this_pe</a>)</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;   <a class="code" href="namespacefv__diagnostics__mod.html#ad47b1fcfcd29f3dc6009a3a52208a573">fv_time</a> = time</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">!----- initialize atmos_axes and fv_dynamics diagnostics</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;       <span class="comment">!I&#39;ve had trouble getting this to work with multiple grids at a time; worth revisiting?</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacefv__diagnostics__mod.html#acfb51973f4727b7ba5e27a04b28d3396">fv_diag_init</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>:<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>), <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%atmos_axes, time, <a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>, <a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a>, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%p_ref)</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">!---------- reference profile -----------</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    ps1 = 101325.</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    ps2 =  81060.</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <a class="code" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">pref</a>(<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1,1) = ps1</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <a class="code" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">pref</a>(<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1,2) = ps2</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacefv__eta__mod.html#ac666b63cee9afad18f2cf33dbced10f6">get_eta_level</a> ( <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>, ps1, <a class="code" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">pref</a>(1,1), <a class="code" href="namespaceatmosphere__mod.html#ab2d51769b2b98337ac742bc3f80d55a7">dum1d</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bk )</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacefv__eta__mod.html#ac666b63cee9afad18f2cf33dbced10f6">get_eta_level</a> ( <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>, ps2, <a class="code" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">pref</a>(1,2), <a class="code" href="namespaceatmosphere__mod.html#ab2d51769b2b98337ac742bc3f80d55a7">dum1d</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bk )</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">!  --- initialize clocks for dynamics, physics_down and physics_up</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#ac1b450b5b014a927fb0456a5b8e73710">id_dynam</a>     = mpp_clock_id(<span class="stringliteral">&#39;FV dy-core&#39;</span>,  flags = clock_flag_default, grain=clock_subcomponent )</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#af368e346f77c2d615969072223e3edad">id_subgridz</a>  = mpp_clock_id(<span class="stringliteral">&#39;FV subgrid_z&#39;</span>,flags = clock_flag_default, grain=clock_subcomponent )</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a6d434f016963346507b32a22b7f41440">id_fv_diag</a>   = mpp_clock_id(<span class="stringliteral">&#39;FV Diag&#39;</span>,     flags = clock_flag_default, grain=clock_subcomponent )</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                    <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#ad40e8855859ae4d87ac63985163a1c3d">timing_off</a>(<span class="stringliteral">&#39;ATMOS_INIT&#39;</span>)</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="preprocessor">#ifdef CCPP</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="preprocessor"></span>   <span class="comment">! Do CCPP fast physics initialization before call to adiabatic_init (since this calls fv_dynamics)</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;   <span class="comment">! Initialize the cdata structure</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;   <span class="keyword">call </span>ccpp_init(trim(ccpp_suite), cdata, ierr)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;   <span class="keywordflow">if</span> (ierr/=0) <span class="keywordflow">then</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      cdata%errmsg = <span class="stringliteral">&#39; atmosphere_dynamics: error in ccpp_init: &#39;</span> // trim(cdata%errmsg)</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="keyword">call </span>mpp_error (fatal, cdata%errmsg)</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="keywordflow">   end if</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;   </div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   <span class="comment">! For fast physics running over the entire domain, block and thread</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;   <span class="comment">! number are not used; set to safe values</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;   cdata%blk_no = 1</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;   cdata%thrd_no = 1</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;   <span class="comment">! Create shared data type for fast and slow physics, one for each thread</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="preprocessor">#ifdef OPENMP</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="preprocessor"></span>   nthreads = omp_get_max_threads()</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="preprocessor"></span>   nthreads = 1</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="preprocessor"></span>   <span class="comment">! Create interstitial data type for fast physics; for multi-gases physics,</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;   <span class="comment">! pass q(:,:,:,1:num_gas) as qvi, otherwise pass q(:,:,:,1:1) as 4D array</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;   <span class="keyword">call </span>ccpp_interstitial%create(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%is, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%ie, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%isd, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%ied, &amp;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%js, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%je, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%jsd, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%jed, &amp;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ng,                                              &amp;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                                 <a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a>, <a class="code" href="namespaceatmosphere__mod.html#a95ee36e402cdda22fbff7a5e5a698d2d">p_split</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%k_split,                            &amp;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                                 <a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%p_ref, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bk,           &amp;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                                 cld_amt&gt;0, kappa, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic,                         &amp;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%do_sat_adj,                                            &amp;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%area_64,           &amp;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%phis, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pkz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt,          &amp;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="preprocessor">#ifdef MULTI_GASES</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="preprocessor"></span>                                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(:,:,:,1:max(1,<a class="code" href="namespacemulti__gases__mod.html#ada7f0ffe52c60fbe7f6cafd04490c4d8">num_gas</a>)),                                        &amp;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="preprocessor"></span>                                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(:,:,:,1:1),                                                     &amp;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="preprocessor"></span>                                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(:,:,:,<a class="code" href="namespaceatmosphere__mod.html#a794b092a72b516a3078dbff077136a08">sphum</a>), <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(:,:,:,<a class="code" href="namespaceatmosphere__mod.html#a41f34859d8c8fd6e84cd71aabd6d2a25">liq_wat</a>),                     &amp;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(:,:,:,<a class="code" href="namespaceatmosphere__mod.html#a9d5b133b6c0010773c3f475af7e879fc">ice_wat</a>), <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(:,:,:,<a class="code" href="namespaceatmosphere__mod.html#ad9345d06c2a877903e3bfdfb529a2a63">rainwat</a>),                   &amp;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(:,:,:,<a class="code" href="namespaceatmosphere__mod.html#a638b8d7ecc568cfe3706105b9db0affe">snowwat</a>), <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(:,:,:,<a class="code" href="namespaceatmosphere__mod.html#a6af183d451e4d59e5cd97150b69e9ec7">graupel</a>),                   &amp;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(:,:,:,cld_amt), <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q_con, nthreads,                    &amp;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%nwat,                                                  &amp;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="preprocessor">#ifdef MULTI_GASES</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="preprocessor"></span>                                 ngas=<a class="code" href="namespacemulti__gases__mod.html#ada7f0ffe52c60fbe7f6cafd04490c4d8">num_gas</a>, rilist=<a class="code" href="namespacemulti__gases__mod.html#acdbd2cbc0014ad073f6daadeffc5cfce">ri</a>, cpilist=<a class="code" href="namespacemulti__gases__mod.html#a85983a7159ef293fa1c2d65647a66400">cpi</a>,                                         &amp;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="preprocessor"></span>                                 mpirank=mpp_pe(), mpiroot=mpp_root_pe())</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="preprocessor">#ifndef STATIC</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="preprocessor"></span><span class="comment">! Populate cdata structure with fields required to run fast physics (auto-generated).</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="preprocessor">#include &quot;ccpp_fields_fast_physics.inc&quot;</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%do_sat_adj) <span class="keywordflow">then</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="comment">! Initialize fast physics</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="preprocessor">#ifdef STATIC</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="preprocessor"></span>      <span class="keyword">call </span>ccpp_physics_init(cdata, suite_name=trim(ccpp_suite), group_name=<span class="stringliteral">&quot;fast_physics&quot;</span>, ierr=ierr)</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="preprocessor"></span>      <span class="keyword">call </span>ccpp_physics_init(cdata, group_name=<span class="stringliteral">&quot;fast_physics&quot;</span>, ierr=ierr)</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span> (ierr/=0) <span class="keywordflow">then</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;         cdata%errmsg = <span class="stringliteral">&#39; atmosphere_dynamics: error in ccpp_physics_init for group fast_physics: &#39;</span> // trim(cdata%errmsg)</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;         <span class="keyword">call </span>mpp_error (fatal, cdata%errmsg)</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="keywordflow">      end if</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordflow">   end if</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">!  --- initiate the start for a restarted regional forecast</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;   <span class="keywordflow">if</span> ( <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%regional .and. <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%warm_start ) <span class="keywordflow">then</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;     <span class="keyword">call </span><a class="code" href="namespacefv__regional__mod.html#a0d3b818eb47e19e7254ccd506c5a5895">start_regional_restart</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(1),             &amp;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                                 <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>, <a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>, <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>, <a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>, &amp;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                                 <a class="code" href="namespaceatmosphere__mod.html#a26b6f2e397bc0d76f12ae674aad670be">isd</a>, <a class="code" href="namespaceatmosphere__mod.html#a775666c64f59edcf96c530c1fc0f1ee9">ied</a>, <a class="code" href="namespaceatmosphere__mod.html#a972cd4fc5737c35941feca9dbb6e46a8">jsd</a>, <a class="code" href="namespaceatmosphere__mod.html#a0d51bfe05ec1bd062c1fbbc01c42bf3a">jed</a> )</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;   <span class="keywordflow">if</span> ( <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%na_init&gt;0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="keyword">call </span>nullify_domain ( )</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="keywordflow">if</span> ( .not. <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic ) <span class="keywordflow">then</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;           <span class="keyword">call </span><a class="code" href="namespacefv__diagnostics__mod.html#a1fad494d94b2fd086c4003778d3f9f63">prt_maxmin</a>(<span class="stringliteral">&#39;Before adi: W&#39;</span>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%w, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>, <a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>, <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>, <a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ng, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>, 1.)</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <span class="keyword">call </span><a class="code" href="namespaceatmosphere__mod.html#abd3fee5137633b7451c0ee1f29942e26">adiabatic_init</a>(<a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>,<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%nudge_dz,time)</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">if</span> ( .not. <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic ) <span class="keywordflow">then</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;           <span class="keyword">call </span><a class="code" href="namespacefv__diagnostics__mod.html#a1fad494d94b2fd086c4003778d3f9f63">prt_maxmin</a>(<span class="stringliteral">&#39;After adi: W&#39;</span>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%w, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>, <a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>, <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>, <a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ng, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>, 1.)</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">! Not nested?</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;           <span class="keyword">call </span><a class="code" href="namespacefv__diagnostics__mod.html#a2caa18f65b49b0d404e4eee6e8514441">prt_height</a>(<span class="stringliteral">&#39;na_ini Z500&#39;</span>, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>,<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>, <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>,<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>, 3, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>, 500.e2, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%phis, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz,    &amp;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%area_64(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>), <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%agrid_64(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,2))</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="keyword">call </span>mpp_error(note,<span class="stringliteral">&#39;No adiabatic initialization correction in use&#39;</span>)</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="preprocessor"></span>   <span class="keyword">call </span>nullify_domain()</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacefv__diagnostics__mod.html#a6f0646bd762a9150bf0636f22f70cfbc">fv_diag</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>:<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>), <a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>, time, -1)</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;   n = <a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;   <span class="keyword">call </span>switch_current_atm(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)) </div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      </div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a38757921a7432338ac2a4135dbc7d9c8">atmosphere_init</a></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#aa742152443b418c81cda5ab32bf17f0e">p_adi</a>(km, ng, ifirst, ilast, jfirst, jlast, ptop,   &amp;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                  delp, pt, ps, pe, peln, pk, pkz, hydrostatic)</div><div class="line"><a name="l00547"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#aa742152443b418c81cda5ab32bf17f0e">  547</a></span>&#160;<span class="comment">! Given (ptop, delp) computes (ps, pk, pe, peln, pkz)</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">! Input:</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;   <span class="keywordtype">integer</span>,  <span class="keywordtype">intent(in)</span>:: km, ng</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;   <span class="keywordtype">integer</span>,  <span class="keywordtype">intent(in)</span>:: ifirst, ilast</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;   <span class="keywordtype">integer</span>,  <span class="keywordtype">intent(in)</span>:: jfirst, jlast</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;   <span class="keywordtype">logical</span>,  <span class="keywordtype">intent(in)</span>::  hydrostatic</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;   <span class="keywordtype">real</span>,     <span class="keywordtype">intent(in)</span>:: ptop</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;   <span class="keywordtype">real</span>,     <span class="keywordtype">intent(in)</span>::   pt(ifirst-ng:ilast+ng,jfirst-ng:jlast+ng, km)</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   <span class="keywordtype">real</span>,     <span class="keywordtype">intent(in)</span>:: delp(ifirst-ng:ilast+ng,jfirst-ng:jlast+ng, km)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">! Output:</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   <span class="keywordtype">real</span>,     <span class="keywordtype">intent(out)</span> ::   ps(ifirst-ng:ilast+ng, jfirst-ng:jlast+ng)</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;   <span class="keywordtype">real</span>,     <span class="keywordtype">intent(out)</span> ::   pk(ifirst:ilast, jfirst:jlast, km+1)</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;   <span class="keywordtype">real</span>,     <span class="keywordtype">intent(out)</span> ::   pe(ifirst-1:ilast+1,km+1,jfirst-1:jlast+1)</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;   <span class="keywordtype">real</span>,     <span class="keywordtype">intent(out)</span> :: peln(ifirst:ilast, km+1, jfirst:jlast)</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;   <span class="keywordtype">real</span>,     <span class="keywordtype">intent(out)</span> ::  pkz(ifirst:ilast, jfirst:jlast, km)</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">! Local</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;   <span class="keywordtype">real</span> pek</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;   <span class="keywordtype">integer</span> i, j, k</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   pek = ptop ** kappa</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">!$OMP parallel do default (none) &amp;</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">!$OMP              shared (ifirst,ilast,jfirst,jlast,km,ptop,pek,pe,pk, &amp;</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">!$OMP                      ps,delp,peln,hydrostatic,pkz) &amp;</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">!$OMP             private (j, i, k)</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;   <span class="keywordflow">do</span> j=jfirst,jlast</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="keywordflow">do</span> i=ifirst,ilast</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;         pe(i,1,j) = ptop</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;         pk(i,j,1) = pek</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="keywordflow">do</span> k=2,km+1</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;         <span class="keywordflow">do</span> i=ifirst,ilast</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            pe(i,k,j)   = pe(i,k-1,j) + delp(i,j,k-1)</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            peln(i,k,j) = log(pe(i,k,j))</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            pk(i,j,k)   = exp( kappa*peln(i,k,j) )</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <span class="keywordflow">do</span> i=ifirst,ilast</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;         ps(i,j) = pe(i,km+1,j)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <span class="keywordflow">if</span> ( hydrostatic ) <span class="keywordflow">then</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;         <span class="keywordflow">do</span> k=1,km</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            <span class="keywordflow">do</span> i=ifirst,ilast</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;               pkz(i,j,k) = (pk(i,j,k+1)-pk(i,j,k))/(kappa*(peln(i,k+1,j)-peln(i,k,j)))</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="keywordflow">   enddo</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#aa742152443b418c81cda5ab32bf17f0e">p_adi</a></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a46726a89e78937df996b8fa2987af885">atmosphere_dynamics</a> ( Time )</div><div class="line"><a name="l00604"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a46726a89e78937df996b8fa2987af885">  604</a></span>&#160;   <span class="keywordtype">type</span>(time_type),<span class="keywordtype">intent(in)</span> :: time</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;   <span class="keywordtype">integer</span> :: n, psc, atmos_time_step</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;   <span class="keywordtype">integer</span> :: k, w_diff, nt_dyn, n_split_loc, <a class="code" href="namespaceatmosphere__mod.html#aafb92c94f8850295ad027e0538ae78ca">seconds</a>, <a class="code" href="namespaceatmosphere__mod.html#a110bc10bed586ca2cddc28ac924959a7">days</a></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;   <span class="keywordtype">type</span>(time_type) :: atmos_time</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">!---- Call FV dynamics -----</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;   <span class="keyword">call </span>mpp_clock_begin (<a class="code" href="namespaceatmosphere__mod.html#ac1b450b5b014a927fb0456a5b8e73710">id_dynam</a>)</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;   n = <a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;   <span class="keyword">call </span>get_time (time, <a class="code" href="namespaceatmosphere__mod.html#aafb92c94f8850295ad027e0538ae78ca">seconds</a>,  <a class="code" href="namespaceatmosphere__mod.html#a110bc10bed586ca2cddc28ac924959a7">days</a>)</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">!  if (seconds &lt; 10800 .and. days == 0) then</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment">!    n_split_loc = (Atm(n)%flagstruct%n_split * 3) / 2</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="namespaceatmosphere__mod.html#aafb92c94f8850295ad027e0538ae78ca">seconds</a> &lt; nint(3600*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%fhouri) .and. <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%fac_n_spl &gt; 1.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;     n_split_loc = nint(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%n_split * <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%fac_n_spl)</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;     n_split_loc = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%n_split</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">!     write(0,*)&#39; before calling init  n_split_loc=&#39;,n_split_loc,&#39; seconds=&#39;,seconds,&#39; days=&#39;,days,&amp;</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">!               &#39; n_split=&#39;,Atm(mytile)%flagstruct%n_split,&#39; mytile=&#39;,mytile</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;   <a class="code" href="namespacefv__regional__mod.html#a7d48ecf3376e882113cf29f2c50b996c">a_step</a> = <a class="code" href="namespacefv__regional__mod.html#a7d48ecf3376e882113cf29f2c50b996c">a_step</a> + 1</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">!*** If this is a regional run then read in the next boundary data when it is time.</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%regional)<span class="keywordflow">then</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;     <span class="keyword">call </span><a class="code" href="namespacefv__regional__mod.html#ae3ebee89f81e0493a8c7e17875152d72">read_new_bc_data</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n), time, <a class="code" href="namespaceatmosphere__mod.html#a6d42cfe750246363957a2e0aaa251f0b">time_step_atmos</a>, <a class="code" href="namespaceatmosphere__mod.html#a95ee36e402cdda22fbff7a5e5a698d2d">p_split</a>, &amp;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                           <a class="code" href="namespaceatmosphere__mod.html#a26b6f2e397bc0d76f12ae674aad670be">isd</a>, <a class="code" href="namespaceatmosphere__mod.html#a775666c64f59edcf96c530c1fc0f1ee9">ied</a>, <a class="code" href="namespaceatmosphere__mod.html#a972cd4fc5737c35941feca9dbb6e46a8">jsd</a>, <a class="code" href="namespaceatmosphere__mod.html#a0d51bfe05ec1bd062c1fbbc01c42bf3a">jed</a> )</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;   <span class="keywordflow">do</span> psc=1,abs(<a class="code" href="namespaceatmosphere__mod.html#a95ee36e402cdda22fbff7a5e5a698d2d">p_split</a>)</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <a class="code" href="namespacefv__regional__mod.html#a829242ae29d3a80d8bf09dbc093cbac0">p_step</a> = psc</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                    <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#a85fb4c4c6b3d9604bb682356ab3e7a82">timing_on</a>(<span class="stringliteral">&#39;fv_dynamics&#39;</span>)</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">!uc/vc only need be same on coarse grid? However BCs do need to be the same</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacefv__dynamics__mod.html#a57030300ce6aacf81a3588faf906f07f">fv_dynamics</a>(<a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>, <a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a>, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>, <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ng, <a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a>/<span class="keywordtype">real(abs(p_split))</span>,&amp;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%consv_te, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%fill,       &amp;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%reproduce_sum, kappa, cp_air, <a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>,     &amp;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ptop, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ks, <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>,                               &amp;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                       n_split_loc, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%q_split,                   &amp;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">!                      Atm(n)%flagstruct%n_split, Atm(n)%flagstruct%q_split,     &amp;</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%u,    <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%v,     <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%w,  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%delz,        &amp;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%hydrostatic,                            &amp;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%pt  , <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%delp,  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%q,  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ps,          &amp;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%pe,   <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%pk,    <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%peln,                   &amp;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%pkz,  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%phis,  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%q_con,                  &amp;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%omga, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ua,    <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%va, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%uc,          &amp;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%vc,   <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ak,    <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%bk, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%mfx,         &amp;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%mfy , <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%cx,    <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%cy, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ze0,         &amp;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%hybrid_z,                               &amp;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%gridstruct,  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct,                    &amp;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%neststruct,  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%idiag, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%bd,              &amp;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                       <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%parent_grid, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%domain,<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%diss_est)</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#ad40e8855859ae4d87ac63985163a1c3d">timing_off</a>(<span class="stringliteral">&#39;fv_dynamics&#39;</span>)</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacefv__control__mod.html#abaa40fc70569bf400e1385f95bae1f5f">ngrids</a> &gt; 1 .and. (psc &lt; <a class="code" href="namespaceatmosphere__mod.html#a95ee36e402cdda22fbff7a5e5a698d2d">p_split</a> .or. <a class="code" href="namespaceatmosphere__mod.html#a95ee36e402cdda22fbff7a5e5a698d2d">p_split</a> &lt; 0)) <span class="keywordflow">then</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#a85fb4c4c6b3d9604bb682356ab3e7a82">timing_on</a>(<span class="stringliteral">&#39;TWOWAY_UPDATE&#39;</span>)</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacefv__nesting__mod.html#afedcc378d1c25e2b9d58ea796dc10b9b">twoway_nesting</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>, <a class="code" href="namespacefv__control__mod.html#abaa40fc70569bf400e1385f95bae1f5f">ngrids</a>, <a class="code" href="namespaceatmosphere__mod.html#ad80223528e58b40110f8a1ffdd3b9aad">grids_on_this_pe</a>, <a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>)</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#ad40e8855859ae4d87ac63985163a1c3d">timing_off</a>(<span class="stringliteral">&#39;TWOWAY_UPDATE&#39;</span>)</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="keywordflow">    end do</span> <span class="comment">!p_split</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keyword">call </span>mpp_clock_end (<a class="code" href="namespaceatmosphere__mod.html#ac1b450b5b014a927fb0456a5b8e73710">id_dynam</a>)</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">!-----------------------------------------------------</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">!--- COMPUTE SUBGRID Z</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">!-----------------------------------------------------</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">!--- zero out tendencies</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keyword">call </span>mpp_clock_begin (<a class="code" href="namespaceatmosphere__mod.html#af368e346f77c2d615969072223e3edad">id_subgridz</a>)</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <a class="code" href="namespaceatmosphere__mod.html#a9f0ef35864e057ad8b3b0d5b644cff55">u_dt</a>(:,:,:)   = 0.</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <a class="code" href="namespaceatmosphere__mod.html#a8245233dc81e751888853150262e6489">v_dt</a>(:,:,:)   = 0.</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <a class="code" href="namespaceatmosphere__mod.html#adeb134091a56f59ab4c371a3855a6bdc">t_dt</a>(:,:,:)   = 0.</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    w_diff = get_tracer_index(model_atmos, <span class="stringliteral">&#39;w_diff&#39;</span> )</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%fv_sg_adj &gt; 0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      nt_dyn = <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="keywordflow">if</span> ( w_diff /= no_tracer ) <span class="keywordflow">then</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        nt_dyn = <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a> - 1</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacefv__sg__mod.html#a12f8e293e862927c307b386cdd8217cb">fv_subgrid_z</a>(<a class="code" href="namespaceatmosphere__mod.html#a26b6f2e397bc0d76f12ae674aad670be">isd</a>, <a class="code" href="namespaceatmosphere__mod.html#a775666c64f59edcf96c530c1fc0f1ee9">ied</a>, <a class="code" href="namespaceatmosphere__mod.html#a972cd4fc5737c35941feca9dbb6e46a8">jsd</a>, <a class="code" href="namespaceatmosphere__mod.html#a0d51bfe05ec1bd062c1fbbc01c42bf3a">jed</a>, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>, <a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>, <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>, <a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%npz, &amp;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                        nt_dyn, <a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%fv_sg_adj,      &amp;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%nwat, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%delp, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%pe,     &amp;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%peln, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%pkz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%pt, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%q,       &amp;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ua, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%va, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%hydrostatic,&amp;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%w, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%delz, <a class="code" href="namespaceatmosphere__mod.html#a9f0ef35864e057ad8b3b0d5b644cff55">u_dt</a>, <a class="code" href="namespaceatmosphere__mod.html#a8245233dc81e751888853150262e6489">v_dt</a>, <a class="code" href="namespaceatmosphere__mod.html#adeb134091a56f59ab4c371a3855a6bdc">t_dt</a>,            &amp;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%n_sponge)</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="preprocessor">#ifdef USE_Q_DT</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( .not. <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%hydrostatic .and. w_diff /= no_tracer ) <span class="keywordflow">then</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">!$OMP parallel do default (none) &amp;</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">!$OMP              shared (isc, iec, jsc, jec, w_diff, n, Atm, q_dt) &amp;</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">!$OMP             private (k)</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;       <span class="keywordflow">do</span> k=1, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%npz</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;          <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%q(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,k,w_diff) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%w(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,k) + <a class="code" href="namespaceatmosphere__mod.html#ac2c4834fc822689255bc707f8405fed1">w0_big</a></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;          q_dt(:,:,k,w_diff) = 0.</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;   <span class="keyword">call </span>mpp_clock_end (<a class="code" href="namespaceatmosphere__mod.html#af368e346f77c2d615969072223e3edad">id_subgridz</a>)</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a46726a89e78937df996b8fa2987af885">atmosphere_dynamics</a></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#ac8fcb2d928bac9a8e1d31fb4bd5fe3b1">atmosphere_end</a> (Time, Grid_box)</div><div class="line"><a name="l00716"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#ac8fcb2d928bac9a8e1d31fb4bd5fe3b1">  716</a></span>&#160;<span class="preprocessor">#ifdef CCPP</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifdef STATIC</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="preprocessor"></span><span class="comment">! For static builds, the ccpp_physics_{init,run,finalize} calls</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">! are not pointing to code in the CCPP framework, but to auto-generated</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">! ccpp_suite_cap and ccpp_group_*_cap modules behind a ccpp_static_api</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;   <span class="keywordtype">use </span>ccpp_static_api,   <span class="keywordtype">only</span>: ccpp_physics_finalize</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;   <span class="keywordtype">use </span>ccpp_data,         <span class="keywordtype">only</span>: ccpp_suite</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="preprocessor"></span>   <span class="keywordtype">use </span>ccpp_api,          <span class="keywordtype">only</span>: ccpp_physics_finalize</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="preprocessor"></span>   <span class="keywordtype">use </span>ccpp_data,         <span class="keywordtype">only</span>: cdata =&gt; cdata_tile</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="preprocessor"></span>   type(time_type),      <span class="keywordtype">intent(in)</span>    :: time</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;   <span class="keywordtype">type</span>(grid_box_type),   <span class="keywordtype">intent(inout)</span> :: grid_box</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="preprocessor">#ifdef CCPP</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="preprocessor"></span>   <span class="keywordtype">integer</span> :: ierr</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%do_sat_adj) <span class="keywordflow">then</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="comment">! Finalize fast physics</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="preprocessor">#ifdef STATIC</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="preprocessor"></span>      <span class="keyword">call </span>ccpp_physics_finalize(cdata, suite_name=trim(ccpp_suite), group_name=<span class="stringliteral">&quot;fast_physics&quot;</span>, ierr=ierr)</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="preprocessor"></span>      <span class="keyword">call </span>ccpp_physics_finalize(cdata, group_name=<span class="stringliteral">&quot;fast_physics&quot;</span>, ierr=ierr)</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span> (ierr/=0) <span class="keywordflow">then</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;         cdata%errmsg = <span class="stringliteral">&#39; atmosphere_dynamics: error in ccpp_physics_finalize for group fast_physics: &#39;</span> // trim(cdata%errmsg)</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;         <span class="keyword">call </span>mpp_error (fatal, cdata%errmsg)</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="keywordflow">      end if</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="keywordflow">   end if</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;   <span class="keyword">call </span>nullify_domain ( )</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="namespaceatmosphere__mod.html#ad7cd98f866fa2b4b4f8528f385d7efc1">first_diag</a>) <span class="keywordflow">then</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#a85fb4c4c6b3d9604bb682356ab3e7a82">timing_on</a>(<span class="stringliteral">&#39;FV_DIAG&#39;</span>)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacefv__diagnostics__mod.html#a6f0646bd762a9150bf0636f22f70cfbc">fv_diag</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>:<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>), <a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>, <a class="code" href="namespacefv__diagnostics__mod.html#ad47b1fcfcd29f3dc6009a3a52208a573">fv_time</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%print_freq)</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacefv__nggps__diags__mod.html#a2067cd5af978609a6dc1614795abea87">fv_nggps_diag</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>:<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>), <a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>, <a class="code" href="namespacefv__diagnostics__mod.html#ad47b1fcfcd29f3dc6009a3a52208a573">fv_time</a>)</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <a class="code" href="namespaceatmosphere__mod.html#ad7cd98f866fa2b4b4f8528f385d7efc1">first_diag</a> = .false.</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#ad40e8855859ae4d87ac63985163a1c3d">timing_off</a>(<span class="stringliteral">&#39;FV_DIAG&#39;</span>)</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacefv__control__mod.html#a94ddeaf4916cd0adc5a56db5ec3c5081">fv_end</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>, <a class="code" href="namespaceatmosphere__mod.html#ad80223528e58b40110f8a1ffdd3b9aad">grids_on_this_pe</a>)</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;   <span class="keyword">deallocate</span> (<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>)</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;   <span class="keyword">deallocate</span>( <a class="code" href="namespaceatmosphere__mod.html#a9f0ef35864e057ad8b3b0d5b644cff55">u_dt</a>, <a class="code" href="namespaceatmosphere__mod.html#a8245233dc81e751888853150262e6489">v_dt</a>, <a class="code" href="namespaceatmosphere__mod.html#adeb134091a56f59ab4c371a3855a6bdc">t_dt</a>, <a class="code" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">pref</a>, <a class="code" href="namespaceatmosphere__mod.html#ab2d51769b2b98337ac742bc3f80d55a7">dum1d</a> )</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#ac8fcb2d928bac9a8e1d31fb4bd5fe3b1">atmosphere_end</a></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="keyword">  subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a1648cbd61c86f2e8890375435b532a5d">atmosphere_restart</a>(timestamp)</div><div class="line"><a name="l00770"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a1648cbd61c86f2e8890375435b532a5d">  770</a></span>&#160;    <span class="keywordtype">character(len=*)</span>,  <span class="keywordtype">intent(in)</span> :: timestamp</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacefv__restart__mod.html#a4e73a658fb6e3a1e2425e248c355a777">fv_write_restart</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>, <a class="code" href="namespaceatmosphere__mod.html#ad80223528e58b40110f8a1ffdd3b9aad">grids_on_this_pe</a>, timestamp)</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="keyword">  end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a1648cbd61c86f2e8890375435b532a5d">atmosphere_restart</a></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; </div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a55d141fa3702c01dae8e656e283827dc">atmosphere_resolution</a> (i_size, j_size, global)</div><div class="line"><a name="l00781"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a55d141fa3702c01dae8e656e283827dc">  781</a></span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span>          :: i_size, j_size</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: global</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;   <span class="keywordtype">logical</span> :: local</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;   local = .true.</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   <span class="keywordflow">if</span>( <span class="keyword">PRESENT</span>(global) ) local = .NOT.global</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;   <span class="keywordflow">if</span>( local ) <span class="keywordflow">then</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;       i_size = <a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a> - <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a> + 1</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;       j_size = <a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a> - <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a> + 1</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;       i_size = <a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a> - 1</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;       j_size = <a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a> - 1</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="keywordflow">   end if</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a55d141fa3702c01dae8e656e283827dc">atmosphere_resolution</a></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a15f14a6344439b29298bfb2b37d9c694">atmosphere_pref</a> (p_ref)</div><div class="line"><a name="l00801"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a15f14a6344439b29298bfb2b37d9c694">  801</a></span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: p_ref</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;   p_ref = <a class="code" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">pref</a></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a15f14a6344439b29298bfb2b37d9c694">atmosphere_pref</a></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#adc8bdf1db2df9551cfc25a0c1f7b1385">atmosphere_control_data</a> (i1, i2, j1, j2, kt, p_hydro, hydro, tile_num)</div><div class="line"><a name="l00809"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#adc8bdf1db2df9551cfc25a0c1f7b1385">  809</a></span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span>           :: i1, i2, j1, j2, kt</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span>, <span class="keywordtype">optional</span> :: p_hydro, hydro</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span>, <span class="keywordtype">optional</span> :: tile_num</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;   i1 = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%isc</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;   i2 = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%iec</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;   j1 = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%jsc</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;   j2 = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%jec</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;   kt = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npz</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">present</span>(tile_num)) tile_num = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%tile</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">present</span>(p_hydro)) p_hydro   = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%phys_hydrostatic</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">present</span>(  hydro))   hydro   = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#adc8bdf1db2df9551cfc25a0c1f7b1385">atmosphere_control_data</a></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a9a51c2f1c5e1cf01dcf112478ecf8cf4">atmosphere_grid_ctr</a> (lon, lat)</div><div class="line"><a name="l00828"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a9a51c2f1c5e1cf01dcf112478ecf8cf4">  828</a></span>&#160;    <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">intent(out)</span> :: lon(:,:), lat(:,:)</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="comment">! Local data:</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordtype">integer</span> i,j</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">do</span> j=<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>,<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;       <span class="keywordflow">do</span> i=<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>,<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;          lon(i-<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>+1,j-<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>+1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%agrid_64(i,j,1)</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;          lat(i-<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>+1,j-<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>+1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%agrid_64(i,j,2)</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="keywordflow">    end do</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a9a51c2f1c5e1cf01dcf112478ecf8cf4">atmosphere_grid_ctr</a></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a3f2bb9d476f9525e20747fd29951dde5">atmosphere_grid_bdry</a> (blon, blat, global)</div><div class="line"><a name="l00845"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a3f2bb9d476f9525e20747fd29951dde5">  845</a></span>&#160;    <span class="keywordtype">real</span>,    <span class="keywordtype">intent(out)</span> :: blon(:,:), blat(:,:)</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: global</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">! Local data:</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordtype">integer</span> i,j</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="keywordflow">if</span>( <span class="keyword">PRESENT</span>(global) ) <span class="keywordflow">then</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      <span class="keywordflow">if</span> (global) <span class="keyword">call </span>mpp_error(fatal, <span class="stringliteral">&#39;==&gt; global grid is no longer available &amp;</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="stringliteral"></span><span class="stringliteral">                               &amp; in the Cubed Sphere&#39;</span>)</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keywordflow">do</span> j=<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>,<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>+1</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;       <span class="keywordflow">do</span> i=<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>,<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>+1</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;          blon(i-<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>+1,j-<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>+1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%grid(i,j,1)</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;          blat(i-<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>+1,j-<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>+1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%grid(i,j,2)</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="keywordflow">    end do</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a3f2bb9d476f9525e20747fd29951dde5">atmosphere_grid_bdry</a></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a2b3029ec0c463f6b1b3b3b6f1b5a0ada">set_atmosphere_pelist</a> ()</div><div class="line"><a name="l00866"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a2b3029ec0c463f6b1b3b3b6f1b5a0ada">  866</a></span>&#160;   <span class="keyword">call </span>mpp_set_current_pelist(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pelist, no_sync=.true.)</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a2b3029ec0c463f6b1b3b3b6f1b5a0ada">set_atmosphere_pelist</a></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a35547644843aec32773bc727b07252de">atmosphere_domain</a> ( fv_domain, layout, regional, nested, pelist )</div><div class="line"><a name="l00875"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a35547644843aec32773bc727b07252de">  875</a></span>&#160;   <span class="keywordtype">type</span>(domain2d), <span class="keywordtype">intent(out)</span> :: fv_domain</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: layout(2)</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span> :: regional</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span> :: nested</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">intent(out)</span> :: <a class="code" href="namespaceatmosphere__mod.html#a40b6e75a5e8c4bafc747edc08eceaed5">pelist</a>(:)</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">!  returns the domain2d variable associated with the coupling grid</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment">!  note: coupling is done using the mass/temperature grid with no halos</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;   fv_domain = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%domain_for_coupler</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;   layout(1:2) =  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%layout(1:2)</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;   regional = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%regional</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;   nested = <a class="code" href="namespacefv__control__mod.html#abaa40fc70569bf400e1385f95bae1f5f">ngrids</a> &gt; 1</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;   <span class="keyword">call </span><a class="code" href="namespaceatmosphere__mod.html#a2b3029ec0c463f6b1b3b3b6f1b5a0ada">set_atmosphere_pelist</a>()</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a40b6e75a5e8c4bafc747edc08eceaed5">pelist</a> =&gt; <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pelist</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a35547644843aec32773bc727b07252de">atmosphere_domain</a></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#af5d819faa34aef7024501c7696540bf0">atmosphere_diag_axes</a> ( axes )</div><div class="line"><a name="l00896"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#af5d819faa34aef7024501c7696540bf0">  896</a></span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: axes (:)</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">!----- returns the axis indices for the atmospheric (mass) grid -----</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;   <span class="keywordflow">if</span> ( <span class="keyword">size</span>(axes(:)) &lt; 0 .or. <span class="keyword">size</span>(axes(:)) &gt; 4 ) <span class="keyword">call </span>error_mesg (    &amp;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                               <span class="stringliteral">&#39;get_atmosphere_axes in atmosphere_mod&#39;</span>, &amp;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                               <span class="stringliteral">&#39;size of argument is incorrect&#39;</span>, fatal   )</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;   axes(1:<span class="keyword">size</span>(axes(:))) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%atmos_axes (1:<span class="keyword">size</span>(axes(:)))</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#af5d819faa34aef7024501c7696540bf0">atmosphere_diag_axes</a></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#ad2c962b25778b4cbd91b48874a52ab95">atmosphere_etalvls</a> (ak, bk, flip)</div><div class="line"><a name="l00913"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#ad2c962b25778b4cbd91b48874a52ab95">  913</a></span>&#160;   <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(inout)</span> :: ak, bk</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: flip</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;   <span class="keyword">allocate</span>(ak(<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1))</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;   <span class="keyword">allocate</span>(bk(<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1))</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;   <span class="keywordflow">if</span> (flip) <span class="keywordflow">then</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;     ak(1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak(<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1:1:-1)</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;     bk(1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bk(<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1:1:-1)</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;     ak(1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak(1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1)</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;     bk(1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bk(1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#ad2c962b25778b4cbd91b48874a52ab95">atmosphere_etalvls</a></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#af16043b77ee4e18b8a8497ad49cfd670">atmosphere_hgt</a> (hgt, position, relative, flip)</div><div class="line"><a name="l00935"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#af16043b77ee4e18b8a8497ad49cfd670">  935</a></span>&#160;   <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: hgt</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;   <span class="keywordtype">character(len=5)</span>, <span class="keywordtype">intent(in)</span> :: position</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: relative</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: flip</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;   <span class="comment">!--- local variables ---</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;   <span class="keywordtype">integer</span>:: lev, k, j, i, <a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>, <a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;   <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(isc:iec,jsc:jec,1:npz+1)</span> :: z</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;   <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(isc:iec,jsc:jec,1:npz)</span> :: dz</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;   <span class="keywordflow">if</span> ((position .ne. <span class="stringliteral">&quot;layer&quot;</span>) .and. (position .ne. <span class="stringliteral">&quot;level&quot;</span>)) <span class="keywordflow">then</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;     <span class="keyword">call </span>mpp_error (fatal, <span class="stringliteral">&#39;atmosphere_hgt:: incorrect position specification&#39;</span>)</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a> = <a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>-<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>+1</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a> = <a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>-<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>+1</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;   z  = 0</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;   dz = 0</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic) <span class="keywordflow">then</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;     <span class="comment">!--- generate dz using hydrostatic assumption</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;     dz(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>) = (rdgas/grav)*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>)  &amp;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                                 * (<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>)          &amp;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                                 -  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,2:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>))</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;     <span class="comment">!--- use non-hydrostatic delz directly</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;     dz(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>)</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;   <span class="comment">!--- calculate geometric heights at the interfaces (levels)</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;   <span class="comment">!--- if needed, flip the indexing during this step</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;   <span class="keywordflow">if</span> (flip) <span class="keywordflow">then</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;     <span class="keywordflow">if</span> (.not. relative) z(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%phis(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>)/grav</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;     <span class="keywordflow">do</span> k = 2,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;       z(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,k) = z(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,k-1) - dz(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+2-k)</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;     <span class="keywordflow">if</span> (.not. relative) z(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%phis(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>)/grav</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;     <span class="keywordflow">do</span> k = <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>,1,-1</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;       z(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,k) = z(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,k+1) - dz(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,k)</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;   <span class="comment">!--- allocate and set either the level or layer height for return</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;   <span class="keywordflow">if</span> (position == <span class="stringliteral">&quot;level&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;     <span class="keyword">allocate</span> (hgt(<a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>,<a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a>,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1))</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;     hgt(1:<a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>,1:<a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a>,1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1) = z(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1)</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;   <span class="keywordflow">elseif</span> (position == <span class="stringliteral">&quot;layer&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;     <span class="keyword">allocate</span> (hgt(<a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>,<a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a>,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>))</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;     hgt(1:<a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>,1:<a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a>,1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>) = 0.5d0 * (z(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,1:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>) + z(<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>:<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>,<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>:<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>,2:<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1))</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#af16043b77ee4e18b8a8497ad49cfd670">atmosphere_hgt</a></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#af9fa6ffe6500a97af113b7a6afb348a6">atmosphere_scalar_field_halo</a> (data, halo, isize, jsize, ksize, data_p)</div><div class="line"><a name="l00995"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#af9fa6ffe6500a97af113b7a6afb348a6">  995</a></span>&#160;   <span class="comment">!--------------------------------------------------------------------</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;   <span class="comment">! data   - output array to return the field with halo (i,j,k)</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;   <span class="comment">!          optionally input for field already in (i,j,k) form</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;   <span class="comment">!          sized to include the halo of the field (+ 2*halo)</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;   <span class="comment">! halo   - size of the halo (must be less than 3)</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;   <span class="comment">! ied    - horizontal resolution in i-dir with haloes</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;   <span class="comment">! jed    - horizontal resolution in j-dir with haloes</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;   <span class="comment">! ksize  - vertical resolution</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;   <span class="comment">! data_p - optional input field in packed format (ix,k)  </span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;   <span class="comment">!--------------------------------------------------------------------</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;   <span class="comment">!--- interface variables ---</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;   <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(1:isize,1:jsize,ksize)</span>, <span class="keywordtype">intent(inout)</span> :: data</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: halo</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: isize</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: jsize</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: ksize</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;   <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: data_p</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;   <span class="comment">!--- local variables ---</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;   <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;   <span class="keywordtype">integer</span> :: ic, jc</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;   <span class="keywordtype">character(len=44)</span> :: modname = <span class="stringliteral">&#39;atmosphere_mod::atmosphere_scalar_field_halo&#39;</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;   <span class="keywordtype">integer</span> :: mpp_flags</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;   <span class="comment">!--- perform error checking</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;   <span class="keywordflow">if</span> (halo .gt. 3) <span class="keyword">call </span>mpp_error(fatal, modname//.gt.<span class="stringliteral">&#39; - halo3 requires extending the MPP domain to support&#39;</span>)</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;   ic = isize - 2 * halo</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;   jc = jsize - 2 * halo</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;   <span class="comment">!--- if packed data is present, unpack it into the two-dimensional data array</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">present</span>(data_p)) <span class="keywordflow">then</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;     <span class="keywordflow">if</span> (ic*jc .ne. <span class="keyword">size</span>(data_p,1)) <span class="keyword">call </span>mpp_error(fatal, modname//<span class="stringliteral">&#39; - incorrect sizes for incoming &amp;</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="stringliteral"></span><span class="stringliteral">                                                  &amp;variables data and data_p&#39;</span>)</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;     <span class="keyword">data</span> = 0.</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment">!$OMP parallel do default (none) &amp;</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">!$OMP              shared (data, data_p, halo, ic, jc, ksize) &amp;</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment">!$OMP             private (i, j, k)</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;     <span class="keywordflow">do</span> k = 1, ksize</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;       <span class="keywordflow">do</span> j = 1, jc</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;         <span class="keywordflow">do</span> i = 1, ic</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;           <span class="keyword">data</span>(i+halo, j+halo, k) = data_p(i + (j-1)*ic, k)</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;   mpp_flags = eupdate + wupdate + supdate + nupdate</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;   <span class="keywordflow">if</span> (halo == 1) <span class="keywordflow">then</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;     <span class="keyword">call </span>mpp_update_domains(<span class="keyword">data</span>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%domain_for_coupler, flags=mpp_flags, complete=.true.)</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   <span class="keywordflow">elseif</span> (halo == 3) <span class="keywordflow">then</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;     <span class="keyword">call </span>mpp_update_domains(<span class="keyword">data</span>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%domain, flags=mpp_flags, complete=.true.)</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;     <span class="keyword">call </span>mpp_error(fatal, modname//<span class="stringliteral">&#39; - unsupported halo size&#39;</span>)</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;   <span class="comment">!--- fill the halo points when at a corner of the cubed-sphere tile </span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;   <span class="comment">!--- interior domain corners are handled correctly</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;   <span class="keywordflow">if</span> ( (<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>==1) .or. (<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>==1) .or. (<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>==<a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>-1) .or. (<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>==<a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a>-1) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;     <span class="keywordflow">do</span> k = 1, ksize</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;       <span class="keywordflow">do</span> j=1,halo</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;         <span class="keywordflow">do</span> i=1,halo</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;           <span class="keywordflow">if</span> ((<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>==    1) .and. (<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>==    1)) <span class="keyword">data</span>(halo+1-j ,halo+1-i ,k) = <span class="keyword">data</span>(halo+i     ,halo+1-j ,k)  <span class="comment">!SW Corner</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;           <span class="keywordflow">if</span> ((<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>==    1) .and. (<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>==<a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a>-1)) <span class="keyword">data</span>(halo+1-j ,halo+jc+i,k) = <span class="keyword">data</span>(halo+i     ,halo+jc+j,k)  <span class="comment">!NW Corner</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;           <span class="keywordflow">if</span> ((<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>==<a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>-1) .and. (<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>==    1)) <span class="keyword">data</span>(halo+ic+j,halo+1-i ,k) = <span class="keyword">data</span>(halo+ic-i+1,halo+1-j ,k)  <span class="comment">!SE Corner</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;           <span class="keywordflow">if</span> ((<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>==<a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>-1) .and. (<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>==<a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a>-1)) <span class="keyword">data</span>(halo+ic+j,halo+jc+i,k) = <span class="keyword">data</span>(halo+ic-i+1,halo+jc+j,k)  <span class="comment">!NE Corner</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;   <span class="keywordflow">return</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#af9fa6ffe6500a97af113b7a6afb348a6">atmosphere_scalar_field_halo</a></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a5966b09ae320c441007e26cc72e00cea">atmosphere_diss_est</a> (npass)</div><div class="line"><a name="l01071"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a5966b09ae320c441007e26cc72e00cea"> 1071</a></span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacedyn__core__mod.html">dyn_core_mod</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacedyn__core__mod.html#ad3018f7acb1006fc424bd0bcaad8b320">del2_cubed</a></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;   <span class="comment">!--- interface variables ---</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: npass</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;   <span class="comment">!--- local variables</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;   <span class="keywordtype">integer</span>:: k</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;   <span class="comment">!horizontally smooth dissiapation estimate for SKEB</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;   <span class="comment">! 3 passes before taking absolute value</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;   <span class="keywordflow">do</span> k = 1,min(3,npass)</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;     <span class="keyword">call </span><a class="code" href="namespacedyn__core__mod.html#ad3018f7acb1006fc424bd0bcaad8b320">del2_cubed</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%diss_est, 0.25*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%da_min, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct, &amp;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                     <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%domain, <a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>, <a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a>, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>, 3, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd)</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="keywordflow">   enddo</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%diss_est=abs(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%diss_est)</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;   <span class="keywordflow">do</span> k = 4,npass</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;     <span class="keyword">call </span><a class="code" href="namespacedyn__core__mod.html#ad3018f7acb1006fc424bd0bcaad8b320">del2_cubed</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%diss_est, 0.25*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%da_min, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct, &amp;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                     <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%domain, <a class="code" href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">npx</a>, <a class="code" href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">npy</a>, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>, 3, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd)</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="keywordflow">   enddo</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;   <span class="comment">! provide back sqrt of dissipation estimate</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%diss_est=sqrt(abs(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%diss_est))</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a5966b09ae320c441007e26cc72e00cea">atmosphere_diss_est</a></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a008a0c84b653d2f8027039570957c12c">atmosphere_nggps_diag</a> (Time, init, ltavg,avg_max_length)</div><div class="line"><a name="l01101"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a008a0c84b653d2f8027039570957c12c"> 1101</a></span>&#160;   <span class="keywordtype">type</span>(time_type),   <span class="keywordtype">intent(in)</span> :: time</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: init, ltavg</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: avg_max_length</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">PRESENT</span>(init)) <span class="keywordflow">then</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;     <span class="keywordflow">if</span> (init) <span class="keywordflow">then</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacefv__nggps__diags__mod.html#ab37da1eb0394d52c06db856e9f875833">fv_nggps_diag_init</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>:<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>), <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%atmos_axes, time)</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;       <span class="keywordflow">return</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;     <span class="keywordflow">else</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;       <span class="keyword">call </span>mpp_error(fatal, <span class="stringliteral">&#39;atmosphere_nggps_diag - calling with init present, but set to .false.&#39;</span>)</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="keywordflow">     endif</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">PRESENT</span>(ltavg)) <span class="keywordflow">then</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;     <span class="keywordflow">if</span> (ltavg) <span class="keywordflow">then</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacefv__nggps__diags__mod.html#a87ed4a1f80258a1b15835104526747e8">fv_nggps_tavg</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>:<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>), <a class="code" href="namespaceatmosphere__mod.html#a6d42cfe750246363957a2e0aaa251f0b">time_step_atmos</a>,avg_max_length,<a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>)</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;       <span class="keywordflow">return</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="keywordflow">     endif</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacefv__nggps__diags__mod.html#a2067cd5af978609a6dc1614795abea87">fv_nggps_diag</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>:<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>), <a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>, time)</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a008a0c84b653d2f8027039570957c12c">atmosphere_nggps_diag</a></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment">!--- Need to know the formulation of the mixing ratio being imported into FV3</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">!--- in order to adjust it in a consistent manner for advection</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">!rab subroutine atmosphere_tracer_postinit (IPD_Data, Atm_block)</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">!rab   !--- interface variables ---</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">!rab   type(IPD_data_type),       intent(in) :: IPD_Data(:)</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">!rab   type(block_control_type),  intent(in) :: Atm_block</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">!rab   !--- local variables ---</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">!rab   integer :: i, j, ix, k, k1, n, nwat, nb, blen</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">!rab   real(kind=kind_phys) :: qwat</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">!rab</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment">!rab   if( nq&lt;3 ) call mpp_error(FATAL, &#39;GFS phys must have 3 interactive tracers&#39;)</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment">!rab</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">!rab   n = mytile</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">!rab   nwat = Atm(n)%flagstruct%nwat</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">!rab</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment">!rab!$OMP parallel do default (none) &amp;</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">!rab!$OMP              shared (Atm_block, Atm, IPD_Data, npz, nq, ncnst, n, nwat) &amp;</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">!rab!$OMP             private (nb, k, k1, ix, i, j, qwat)</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment">!rab   do nb = 1,Atm_block%nblks</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment">!rab     do k = 1, npz</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment">!rab       k1 = npz+1-k !reverse the k direction</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment">!rab       do ix = 1, Atm_block%blksz(nb)</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment">!rab         i = Atm_block%index(nb)%ii(ix)</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">!rab         j = Atm_block%index(nb)%jj(ix)</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment">!rab         qwat = sum(Atm(n)%q(i,j,k1,1:nwat))</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment">!rab         Atm(n)%q(i,j,k1,1:nq) = Atm(n)%q(i,j,k1,1:nq) + IPD_Data(nb)%Stateout%gq0(ix,k,1:nq) * (1.0 - qwat)</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment">!rab         if (nq .gt. ncnst) then</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">!rab           Atm(n)%qdiag(i,j,k1,nq+1:ncnst) = Atm(n)%qdiag(i,j,k1,nq+1:ncnst) + IPD_Data(nb)%Stateout%gq0(ix,k,nq+1:ncnst)</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment">!rab         endif</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment">!rab       enddo</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment">!rab     enddo</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment">!rab   enddo</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment">!rab</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment">!rab   call mpp_update_domains (Atm(n)%q, Atm(n)%domain, complete=.true.)</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment">!rab</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment">!rab   return</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment">!rab end subroutine atmosphere_tracer_postinit</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a94122314f8c8e6209581bfacbbbf8319">get_bottom_mass</a> ( t_bot, tr_bot, p_bot, z_bot, p_surf, slp )</div><div class="line"><a name="l01163"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a94122314f8c8e6209581bfacbbbf8319"> 1163</a></span>&#160;<span class="comment">!--------------------------------------------------------------</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">! returns temp, sphum, pres, height at the lowest model level</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">! and surface pressure</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">!--------------------------------------------------------------</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;   <span class="comment">!--- interface variables ---</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">intent(out)</span>, <span class="keywordtype">dimension(isc:iec,jsc:jec)</span>:: t_bot, p_bot, z_bot, p_surf</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">intent(out)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">dimension(isc:iec,jsc:jec)</span>:: slp</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">intent(out)</span>, <span class="keywordtype">dimension(isc:iec,jsc:jec,nq)</span>:: tr_bot</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;   <span class="comment">!--- local variables ---</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;   <span class="keywordtype">integer</span> :: i, j, m, k, kr</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;   <span class="keywordtype">real</span>    :: rrg, sigtop, sigbot</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">dimension(isc:iec,jsc:jec)</span> :: tref</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span> :: tlaps = 6.5e-3</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;   rrg  = rdgas / grav</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;   <span class="keywordflow">do</span> j=<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>,<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      <span class="keywordflow">do</span> i=<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>,<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;         p_surf(i,j) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ps(i,j)</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;         t_bot(i,j) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>)</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;         p_bot(i,j) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>)/(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln(i,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1,j)-<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln(i,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>,j))</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;         z_bot(i,j) = rrg*t_bot(i,j)*(1. - <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pe(i,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>,j)/p_bot(i,j))</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="preprocessor">#ifdef MULTI_GASES</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="preprocessor"></span>         z_bot(i,j) = z_bot(i,j)*<a class="code" href="namespacemulti__gases__mod.html#a91649465dfa64dee4a0aa4db33496b34">virq</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>,:))</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="preprocessor"></span>         z_bot(i,j) = z_bot(i,j)*(1.+<a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>,1))</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="preprocessor"></span><span class="keywordflow">      enddo</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="keywordflow">   enddo</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;   <span class="keywordflow">if</span> ( <span class="keyword">present</span>(slp) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;     <span class="comment">! determine 0.8 sigma reference level</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;     sigtop = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak(1)/pstd_mks+<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bk(1)</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;     <span class="keywordflow">do</span> k = 1, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        sigbot = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak(k+1)/pstd_mks+<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bk(k+1)</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        <span class="keywordflow">if</span> (sigbot+sigtop &gt; 1.6) <span class="keywordflow">then</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;           kr = k</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;           <span class="keywordflow">exit</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        sigtop = sigbot</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;     <span class="keywordflow">do</span> j=<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>,<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        <span class="keywordflow">do</span> i=<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>,<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;           <span class="comment">! sea level pressure</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;           tref(i,j) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,kr) * (<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,kr)/ &amp;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                            ((<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln(i,kr+1,j)-<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln(i,kr,j))*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ps(i,j)))**(-rrg*tlaps)</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;           slp(i,j) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ps(i,j)*(1.+tlaps*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%phis(i,j)/(tref(i,j)*grav))**(1./(rrg*tlaps))</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment">! Copy tracers</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;   <span class="keywordflow">do</span> m=1,<a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      <span class="keywordflow">do</span> j=<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>,<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;         <span class="keywordflow">do</span> i=<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>,<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            tr_bot(i,j,m) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>,m)</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="keywordflow">   enddo</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a94122314f8c8e6209581bfacbbbf8319">get_bottom_mass</a></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a18b993ba126ae2c1baa890234cfcb289">get_bottom_wind</a> ( u_bot, v_bot )</div><div class="line"><a name="l01227"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a18b993ba126ae2c1baa890234cfcb289"> 1227</a></span>&#160;<span class="comment">!-----------------------------------------------------------</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment">! returns u and v on the mass grid at the lowest model level</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="comment">!-----------------------------------------------------------</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;   <span class="comment">!--- interface variables ---</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">intent(out)</span>, <span class="keywordtype">dimension(isc:iec,jsc:jec)</span>:: u_bot, v_bot</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;   <span class="comment">!--- local variables ---</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;   <span class="keywordtype">integer</span> i, j</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;   <span class="keywordflow">do</span> j=<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>,<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      <span class="keywordflow">do</span> i=<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>,<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;         u_bot(i,j) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%u_srf(i,j)</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;         v_bot(i,j) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%v_srf(i,j)</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="keywordflow">   enddo</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a18b993ba126ae2c1baa890234cfcb289">get_bottom_wind</a></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#af09657a508e73ba69d7a3abeb88d034f">atmosphere_get_bottom_layer</a> (Atm_block, DYCORE_Data)</div><div class="line"><a name="l01249"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#af09657a508e73ba69d7a3abeb88d034f"> 1249</a></span>&#160;<span class="comment">!--------------------------------------------------------------</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment">! Returns in blocked format:</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment">!    temp, pres, winds, height, and tracers at the bottom layer</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment">!    surface pressure</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">!    sea-level pressure</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment">!--------------------------------------------------------------</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;   <span class="comment">!--- interface variables ---</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;   <span class="keywordtype">type</span>(block_control_type), <span class="keywordtype">intent(in)</span>    :: atm_block</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;   <span class="keywordtype">type</span>(<a class="code" href="structdycore__typedefs_1_1dycore__data__type.html">dycore_data_type</a>),   <span class="keywordtype">intent(inout)</span> :: dycore_data(:)</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   <span class="comment">!--- local variables ---</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;   <span class="keywordtype">integer</span> :: ix, i, j, nt, k, nb</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;   <span class="keywordtype">real</span>    :: rrg, sigtop, sigbot, tref</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;   <span class="comment">!--- local parameters ---</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span> :: tlaps = 6.5e-3</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;   <span class="comment">!--- local saved variables ---</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">save</span> :: kr</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">save</span> :: first_time = .true.</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   rrg  = rdgas / grav</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;   <span class="keywordflow">if</span> (first_time) <span class="keywordflow">then</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;     print *, <span class="stringliteral">&#39;calculating slp kr value&#39;</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;     <span class="comment">! determine 0.8 sigma reference level</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;     sigtop = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak(1)/pstd_mks+<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bk(1)</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;     <span class="keywordflow">do</span> k = 1, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;       sigbot = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak(k+1)/pstd_mks+<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bk(k+1)</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;       <span class="keywordflow">if</span> (sigbot+sigtop &gt; 1.6) <span class="keywordflow">then</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;         kr = k</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;         <span class="keywordflow">exit</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="keywordflow">       endif</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;       sigtop = sigbot</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;     <span class="comment">!--- allocate the DYCORE_Data container</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;     <span class="keywordflow">do</span> nb = 1,atm_block%nblks</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;       <span class="keyword">call </span>dycore_data(nb)%Coupling%create (atm_block%blksz(nb), <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>)</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;     first_time = .false.</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment">!$OMP parallel do default (none) &amp;</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment">!$OMP              shared (Atm_block, DYCORE_Data, Atm, mytile, npz, kr, rrg, zvir, nq) &amp;</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment">!$OMP             private (nb, ix, i, j, tref, nt)</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;   <span class="keywordflow">do</span> nb = 1,atm_block%nblks</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;     <span class="keywordflow">do</span> ix = 1,atm_block%blksz(nb)</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;       i = atm_block%index(nb)%ii(ix)</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;       j = atm_block%index(nb)%jj(ix)</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;       <span class="comment">!--- surface pressure</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;       dycore_data(nb)%Coupling%p_srf(ix) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ps(i,j)</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;       <span class="comment">!--- bottom layer temperature, pressure, &amp; winds</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;       dycore_data(nb)%Coupling%t_bot(ix) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>)</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;       dycore_data(nb)%Coupling%p_bot(ix) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>)/(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln(i,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1,j)-<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln(i,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>,j))</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;       dycore_data(nb)%Coupling%u_bot(ix) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%u_srf(i,j)</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;       dycore_data(nb)%Coupling%v_bot(ix) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%v_srf(i,j)</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;       <span class="comment">!--- bottom layer height based on hydrostatic assumptions</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;       dycore_data(nb)%Coupling%z_bot(ix) = rrg*dycore_data(nb)%Coupling%t_bot(ix) * &amp;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                                        (1. - <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pe(i,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>,j)/dycore_data(nb)%Coupling%p_bot(ix))</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="preprocessor">#ifdef MULTI_GASES</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="preprocessor"></span>       dycore_data(nb)%Coupling%z_bot(ix) = dycore_data(nb)%Coupling%z_bot(ix)*<a class="code" href="namespacemulti__gases__mod.html#a91649465dfa64dee4a0aa4db33496b34">virq</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>,:))</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="preprocessor"></span>       dycore_data(nb)%Coupling%z_bot(ix) = dycore_data(nb)%Coupling%z_bot(ix)*(1.+<a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>,1))</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="preprocessor"></span>       <span class="comment">!--- sea level pressure</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;       tref = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,kr) * (<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,kr)/ &amp;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;              ((<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln(i,kr+1,j)-<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln(i,kr,j))*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ps(i,j)))**(-rrg*tlaps)</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;       dycore_data(nb)%Coupling%slp(ix) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ps(i,j)*(1.+tlaps*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%phis(i,j)/(tref*grav))**(1./(rrg*tlaps))</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;     <span class="comment">!--- bottom layer tracers</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;     <span class="keywordflow">do</span> nt = 1,<a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;       <span class="keywordflow">do</span> ix = 1,atm_block%blksz(nb)</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;         i = atm_block%index(nb)%ii(ix)</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;         j = atm_block%index(nb)%jj(ix)</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;         dycore_data(nb)%Coupling%tr_bot(ix,nt) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>,nt)</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="keywordflow">   enddo</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#af09657a508e73ba69d7a3abeb88d034f">atmosphere_get_bottom_layer</a></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a2d856ff000261ca516c3ae653a9ef005">get_stock_pe</a>(index, value)</div><div class="line"><a name="l01330"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a2d856ff000261ca516c3ae653a9ef005"> 1330</a></span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: index</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;   <span class="keywordtype">real</span>,    <span class="keywordtype">intent(out)</span> :: value</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="preprocessor">#ifdef USE_STOCK</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="preprocessor"></span>   include <span class="stringliteral">&#39;stock.inc&#39;</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;   <span class="keywordtype">real</span> wm(isc:iec,jsc:jec)</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;   <span class="keywordtype">integer</span> i,j,k</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span> :: area(:,:)</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;   area =&gt; <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct%area</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;   <span class="keywordflow">select case</span> (index)</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="preprocessor">#ifdef USE_STOCK</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="preprocessor"></span>   <span class="keywordflow">case</span> (istock_water)</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="preprocessor"></span>   <span class="keywordflow">case</span> (1)</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="comment">!----------------------</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="comment">! Perform vertical sum:</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment">!----------------------</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;     wm = 0.</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;     <span class="keywordflow">do</span> j=jsc,jec</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <span class="keywordflow">do</span> k=1,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;           <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">! Warning: the following works only with AM2 physics: water vapor; cloud water, cloud ice.</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;              wm(i,j) = wm(i,j) + <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,k) * ( <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,k,1) +    &amp;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                                                              <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,k,2) +    &amp;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                                                              <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,k,3) )</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="keywordflow">           enddo</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment">!----------------------</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">! Horizontal sum:</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment">!----------------------</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;     <span class="keywordtype">value</span> = 0.</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;     <span class="keywordflow">do</span> j=jsc,jec</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;           <span class="keywordtype">value</span> = <span class="keywordtype">value</span> + wm(i,j)*area(i,j)</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;     <span class="keywordtype">value</span> = <span class="keywordtype">value</span>/grav</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="keywordflow">   case default</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;     <span class="keywordtype">value</span> = 0.0</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="keywordflow">   end select</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a2d856ff000261ca516c3ae653a9ef005">get_stock_pe</a></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#abf96613ef8db32b3e66f3297f62a0346">atmosphere_state_update</a> (Time, IPD_Data, IAU_Data, Atm_block, flip_vc)</div><div class="line"><a name="l01387"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#abf96613ef8db32b3e66f3297f62a0346"> 1387</a></span>&#160;   <span class="keywordtype">type</span>(time_type),              <span class="keywordtype">intent(in)</span> :: time</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;   <span class="keywordtype">type</span>(ipd_data_type),          <span class="keywordtype">intent(in)</span> :: ipd_data(:)</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;   <span class="keywordtype">type</span>(<a class="code" href="structfv__iau__mod_1_1iau__external__data__type.html">iau_external_data_type</a>), <span class="keywordtype">intent(in)</span> :: iau_data</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;   <span class="keywordtype">type</span>(block_control_type),     <span class="keywordtype">intent(in)</span> :: atm_block</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;   <span class="keywordtype">logical</span>,                      <span class="keywordtype">intent(in)</span> :: flip_vc</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;   <span class="comment">!--- local variables ---</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;   <span class="keywordtype">type</span>(time_type) :: time_prev, time_next</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;   <span class="keywordtype">integer</span> :: i, j, ix, k, k1, n, w_diff, nt_dyn, iq</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;   <span class="keywordtype">integer</span> :: nb, blen, nwat, dnats, nq_adv</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;   <span class="keywordtype">real(kind=kind_phys)</span>:: rcp, q0, qwat(<a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>), qt, rdt</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;   time_prev = time</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;   time_next = time + <a class="code" href="namespaceatmosphere__mod.html#a6d42cfe750246363957a2e0aaa251f0b">time_step_atmos</a></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;   rdt = 1.d0 / <a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;   n = <a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;   nwat = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%nwat</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;   dnats = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%dnats</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;   nq_adv = <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a> - dnats</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;   <span class="keywordflow">if</span>( <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>&lt;3 ) <span class="keyword">call </span>mpp_error(fatal, <span class="stringliteral">&#39;GFS phys must have 3 interactive tracers&#39;</span>)</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;   <span class="keywordflow">if</span> (iau_data%in_interval) <span class="keywordflow">then</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment">!     IAU increments are in units of 1/sec</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment">!     add analysis increment to u,v,t tendencies</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">!     directly update delp with analysis increment</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      <span class="keywordflow">do</span> k = 1, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;         <span class="keywordflow">do</span> j = <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>,<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;            <span class="keywordflow">do</span> i = <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>,<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;               <a class="code" href="namespaceatmosphere__mod.html#a9f0ef35864e057ad8b3b0d5b644cff55">u_dt</a>(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#a9f0ef35864e057ad8b3b0d5b644cff55">u_dt</a>(i,j,k) + iau_data%ua_inc(i,j,k)</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;               <a class="code" href="namespaceatmosphere__mod.html#a8245233dc81e751888853150262e6489">v_dt</a>(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#a8245233dc81e751888853150262e6489">v_dt</a>(i,j,k) + iau_data%va_inc(i,j,k)</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;               <a class="code" href="namespaceatmosphere__mod.html#adeb134091a56f59ab4c371a3855a6bdc">t_dt</a>(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#adeb134091a56f59ab4c371a3855a6bdc">t_dt</a>(i,j,k) + iau_data%temp_inc(i,j,k)</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;               <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%delp(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%delp(i,j,k)  + iau_data%delp_inc(i,j,k)*<a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <span class="keywordflow">if</span> (.not. <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic) <span class="keywordflow">then</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;         <span class="keywordflow">do</span> k = 1, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;            <span class="keywordflow">do</span> j = <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>,<a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;               <span class="keywordflow">do</span> i = <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>,<a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%delz(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%delz(i,j,k)  + iau_data%delz_inc(i,j,k)*<a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="keywordflow">             enddo</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="keywordflow">           enddo</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment">!     add analysis increment to tracers to output from physics</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <span class="keywordflow">do</span> nb = 1,atm_block%nblks</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;         <span class="comment">!if (nb.EQ.1) print*,&#39;in block_update&#39;,IAU_Data%in_interval,IAU_Data%temp_inc(isc,jsc,30)</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;         blen = atm_block%blksz(nb)</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;         <span class="keywordflow">do</span> k = 1, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;           <span class="keywordflow">if</span>(flip_vc) <span class="keywordflow">then</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;             k1 = <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1-k <span class="comment">!reverse the k direction </span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;           <span class="keywordflow">else</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;             k1 = k</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="keywordflow">           endif</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;            <span class="keywordflow">do</span> ix = 1, blen</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;               i = atm_block%index(nb)%ii(ix)</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;               j = atm_block%index(nb)%jj(ix)</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;               ipd_data(nb)%Stateout%gq0(ix,k,:) = ipd_data(nb)%Stateout%gq0(ix,k,:) + iau_data%tracer_inc(i,j,k1,:)*<a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;   <span class="keyword">call </span>set_domain ( <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%domain )</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#a85fb4c4c6b3d9604bb682356ab3e7a82">timing_on</a>(<span class="stringliteral">&#39;GFS_TENDENCIES&#39;</span>)</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="comment">!--- put u/v tendencies into haloed arrays u_dt and v_dt</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment">!$OMP parallel do default (none) &amp; </span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="comment">!$OMP              shared (rdt, n, nq, dnats, npz, ncnst, nwat, mytile, u_dt, v_dt, t_dt,&amp;</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="comment">!$OMP                      Atm, IPD_Data, Atm_block, sphum, liq_wat, rainwat, ice_wat,   &amp;</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="preprocessor">#ifdef MULTI_GASES</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="preprocessor"></span><span class="comment">!$OMP                      num_gas,                                                      &amp;</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="preprocessor"></span><span class="comment">!$OMP                      snowwat, graupel, nq_adv, flip_vc)   &amp;</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="comment">!$OMP             private (nb, blen, i, j, k, k1, ix, q0, qwat, qt)</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;   <span class="keywordflow">do</span> nb = 1,atm_block%nblks</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="comment">!SJL: perform vertical filling to fix the negative humidity if the SAS convection scheme is used</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="comment">!     This call may be commented out if RAS or other positivity-preserving CPS is used.</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;     blen = atm_block%blksz(nb)</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;     <span class="keyword">call </span><a class="code" href="namespacefv__fill__mod.html#a527172ca182ebcb99a72bdbd536165d2">fill_gfs</a>(blen, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>, ipd_data(nb)%Statein%prsi, ipd_data(nb)%Stateout%gq0, 1.e-9_kind_phys)</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;     <span class="keywordflow">do</span> k = 1, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;           <span class="keywordflow">if</span>(flip_vc) <span class="keywordflow">then</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;             k1 = <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1-k <span class="comment">!reverse the k direction </span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;           <span class="keywordflow">else</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;             k1 = k</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="keywordflow">           endif</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;       <span class="keywordflow">do</span> ix = 1, blen</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;         i = atm_block%index(nb)%ii(ix)</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;         j = atm_block%index(nb)%jj(ix)</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;         <a class="code" href="namespaceatmosphere__mod.html#a9f0ef35864e057ad8b3b0d5b644cff55">u_dt</a>(i,j,k1) = <a class="code" href="namespaceatmosphere__mod.html#a9f0ef35864e057ad8b3b0d5b644cff55">u_dt</a>(i,j,k1) + (ipd_data(nb)%Stateout%gu0(ix,k) - ipd_data(nb)%Statein%ugrs(ix,k)) * rdt</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;         <a class="code" href="namespaceatmosphere__mod.html#a8245233dc81e751888853150262e6489">v_dt</a>(i,j,k1) = <a class="code" href="namespaceatmosphere__mod.html#a8245233dc81e751888853150262e6489">v_dt</a>(i,j,k1) + (ipd_data(nb)%Stateout%gv0(ix,k) - ipd_data(nb)%Statein%vgrs(ix,k)) * rdt</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="comment">!         t_dt(i,j,k1) = (IPD_Data(nb)%Stateout%gt0(ix,k) - IPD_Data(nb)%Statein%tgrs(ix,k)) * rdt</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;         <a class="code" href="namespaceatmosphere__mod.html#adeb134091a56f59ab4c371a3855a6bdc">t_dt</a>(i,j,k1) = <a class="code" href="namespaceatmosphere__mod.html#adeb134091a56f59ab4c371a3855a6bdc">t_dt</a>(i,j,k1) + (ipd_data(nb)%Stateout%gt0(ix,k) - ipd_data(nb)%Statein%tgrs(ix,k)) * rdt</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="comment">! SJL notes:</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="comment">! ---- DO not touch the code below; dry mass conservation may change due to 64bit &lt;-&gt; 32bit conversion</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="comment">! GFS total air mass = dry_mass + water_vapor (condensate excluded)</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="comment">! GFS mixing ratios  = tracer_mass / (dry_mass + vapor_mass)</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="comment">! FV3 total air mass = dry_mass + [water_vapor + condensate ]</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="comment">! FV3 mixing ratios  = tracer_mass / (dry_mass+vapor_mass+cond_mass)</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;         <span class="keywordflow">if</span>(flip_vc) <span class="keywordflow">then</span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;           q0 = ipd_data(nb)%Statein%prsi(ix,k) - ipd_data(nb)%Statein%prsi(ix,k+1)</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;           q0 = ipd_data(nb)%Statein%prsi(ix,k+1) - ipd_data(nb)%Statein%prsi(ix,k)</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="keywordflow">         endif</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;         qwat(1:nq_adv) = q0*ipd_data(nb)%Stateout%gq0(ix,k,1:nq_adv)</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="comment">! **********************************************************************************************************</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment">! Dry mass: the following way of updating delp is key to mass conservation with hybrid 32-64 bit computation</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="comment">! **********************************************************************************************************</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment">! The following example is for 2 water species. </span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="comment">!        q0 = Atm(n)%delp(i,j,k1)*(1.-(Atm(n)%q(i,j,k1,1)+Atm(n)%q(i,j,k1,2))) + q1 + q2</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="preprocessor">#ifdef MULTI_GASES</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="preprocessor"></span>         q0 = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%delp(i,j,k1)*(1.-sum(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%q(i,j,k1,1:max(nwat,<a class="code" href="namespacemulti__gases__mod.html#ada7f0ffe52c60fbe7f6cafd04490c4d8">num_gas</a>)))) + sum(qwat(1:max(nwat,<a class="code" href="namespacemulti__gases__mod.html#ada7f0ffe52c60fbe7f6cafd04490c4d8">num_gas</a>)))</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="preprocessor"></span>         qt = sum(qwat(1:nwat))</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;         q0 = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%delp(i,j,k1)*(1.-sum(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%q(i,j,k1,1:nwat))) + qt </div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="preprocessor"></span>         <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%delp(i,j,k1) = q0</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;         <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%q(i,j,k1,1:nq_adv) = qwat(1:nq_adv) / q0</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">!        if (dnats .gt. 0) Atm(n)%q(i,j,k1,nq_adv+1:nq) = IPD_Data(nb)%Stateout%gq0(ix,k,nq_adv+1:nq)</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;     <span class="comment">!--- diagnostic tracers are assumed to be updated in-place</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;     <span class="comment">!--- SHOULD THESE DIAGNOSTIC TRACERS BE MASS ADJUSTED???</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;     <span class="comment">!--- See Note in statein...</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;     <span class="keywordflow">do</span> iq = <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>+1, <a class="code" href="namespaceatmosphere__mod.html#a9a8c995d33f2c1869ae7d0b49d5e1002">ncnst</a></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;       <span class="keywordflow">do</span> k = 1, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;           <span class="keywordflow">if</span>(flip_vc) <span class="keywordflow">then</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;             k1 = <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1-k <span class="comment">!reverse the k direction </span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;           <span class="keywordflow">else</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;             k1 = k</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="keywordflow">           endif</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;         <span class="keywordflow">do</span> ix = 1, blen</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;           i = atm_block%index(nb)%ii(ix)</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;           j = atm_block%index(nb)%jj(ix)</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;           <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%qdiag(i,j,k1,iq) = ipd_data(nb)%Stateout%gq0(ix,k,iq)</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="keywordflow">   enddo</span>  <span class="comment">! nb-loop</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#ad40e8855859ae4d87ac63985163a1c3d">timing_off</a>(<span class="stringliteral">&#39;GFS_TENDENCIES&#39;</span>)</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;   w_diff = get_tracer_index(model_atmos, <span class="stringliteral">&#39;w_diff&#39;</span> )</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;   nt_dyn = <a class="code" href="namespaceatmosphere__mod.html#a9a8c995d33f2c1869ae7d0b49d5e1002">ncnst</a>-<a class="code" href="namespaceatmosphere__mod.html#a3ae095d62282ac16560419aa858cbd5b">pnats</a>   <span class="comment">!nothing more than nq</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;   <span class="keywordflow">if</span> ( w_diff /= no_tracer ) <span class="keywordflow">then</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;      nt_dyn = nt_dyn - 1</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="comment">!--- adjust w and heat tendency for non-hydrostatic case</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="preprocessor">#ifdef USE_Q_DT</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( .not.<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%hydrostatic .and. w_diff /= no_tracer ) <span class="keywordflow">then</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;      rcp = 1. / cp_air</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="comment">!$OMP parallel do default (none) &amp;</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="comment">!$OMP              shared (jsc, jec, isc, iec, n, w_diff, Atm, q_dt, t_dt, rcp, dt_atmos) &amp;</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="comment">!$OMP             private (i, j, k)</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;       <span class="keywordflow">do</span> k=1, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%npz</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;         <span class="keywordflow">do</span> j=<a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>, <a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;           <span class="keywordflow">do</span> i=<a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>, <a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;             <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%q(i,j,k,w_diff) = q_dt(i,j,k,w_diff) <span class="comment">! w tendency due to phys</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="comment">! Heating due to loss of KE (vertical diffusion of w)</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;             <a class="code" href="namespaceatmosphere__mod.html#adeb134091a56f59ab4c371a3855a6bdc">t_dt</a>(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#adeb134091a56f59ab4c371a3855a6bdc">t_dt</a>(i,j,k) - q_dt(i,j,k,w_diff)*rcp*&amp;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;                                     (<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%w(i,j,k)+0.5*<a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a>*q_dt(i,j,k,w_diff))</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;             <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%w(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%w(i,j,k) + <a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a>*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%q(i,j,k,w_diff)</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="keywordflow">           enddo</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;   <span class="keyword">call </span>mpp_clock_begin (<a class="code" href="namespaceatmosphere__mod.html#ac1b450b5b014a927fb0456a5b8e73710">id_dynam</a>)</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#a85fb4c4c6b3d9604bb682356ab3e7a82">timing_on</a>(<span class="stringliteral">&#39;FV_UPDATE_PHYS&#39;</span>)</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacefv__update__phys__mod.html#a07d63d9929b6cb44156f6ceb8bc27728">fv_update_phys</a>( <a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a>, <a class="code" href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">isc</a>, <a class="code" href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">iec</a>, <a class="code" href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">jsc</a>, <a class="code" href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">jec</a>, <a class="code" href="namespaceatmosphere__mod.html#a26b6f2e397bc0d76f12ae674aad670be">isd</a>, <a class="code" href="namespaceatmosphere__mod.html#a775666c64f59edcf96c530c1fc0f1ee9">ied</a>, <a class="code" href="namespaceatmosphere__mod.html#a972cd4fc5737c35941feca9dbb6e46a8">jsd</a>, <a class="code" href="namespaceatmosphere__mod.html#a0d51bfe05ec1bd062c1fbbc01c42bf3a">jed</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ng, nt_dyn, &amp;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                         <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%u,  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%v,   <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%w,  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%delp, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%pt,         &amp;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                         <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%q,  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%qdiag,                                          &amp;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                         <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ua, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%va,  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ps, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%pe,   <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%peln,       &amp;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;                         <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%pk, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%pkz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ak, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%bk,   <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%phis,       &amp;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                         <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%u_srf, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%v_srf, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ts, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%delz,               &amp;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                         <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%hydrostatic, <a class="code" href="namespaceatmosphere__mod.html#a9f0ef35864e057ad8b3b0d5b644cff55">u_dt</a>, <a class="code" href="namespaceatmosphere__mod.html#a8245233dc81e751888853150262e6489">v_dt</a>, <a class="code" href="namespaceatmosphere__mod.html#adeb134091a56f59ab4c371a3855a6bdc">t_dt</a>,                  &amp;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                         .true., time_next, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct%nudge, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%gridstruct,    &amp;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                         <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%gridstruct%agrid(:,:,1), <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%gridstruct%agrid(:,:,2),   &amp;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                         <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%npx, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%npy, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%npz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%flagstruct,            &amp;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                         <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%neststruct, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%bd, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%domain, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(n)%ptop)</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#ad40e8855859ae4d87ac63985163a1c3d">timing_off</a>(<span class="stringliteral">&#39;FV_UPDATE_PHYS&#39;</span>)</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;   <span class="keyword">call </span>mpp_clock_end (<a class="code" href="namespaceatmosphere__mod.html#ac1b450b5b014a927fb0456a5b8e73710">id_dynam</a>)</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment">!--- nesting update after updating atmospheric variables with</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">!--- physics tendencies</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacefv__control__mod.html#abaa40fc70569bf400e1385f95bae1f5f">ngrids</a> &gt; 1 .and. <a class="code" href="namespaceatmosphere__mod.html#a95ee36e402cdda22fbff7a5e5a698d2d">p_split</a> &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#a85fb4c4c6b3d9604bb682356ab3e7a82">timing_on</a>(<span class="stringliteral">&#39;TWOWAY_UPDATE&#39;</span>)</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacefv__nesting__mod.html#afedcc378d1c25e2b9d58ea796dc10b9b">twoway_nesting</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>, <a class="code" href="namespacefv__control__mod.html#abaa40fc70569bf400e1385f95bae1f5f">ngrids</a>, <a class="code" href="namespaceatmosphere__mod.html#ad80223528e58b40110f8a1ffdd3b9aad">grids_on_this_pe</a>, <a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>)</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#ad40e8855859ae4d87ac63985163a1c3d">timing_off</a>(<span class="stringliteral">&#39;TWOWAY_UPDATE&#39;</span>)</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="keywordflow">    endif</span>   </div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;   <span class="keyword">call </span>nullify_domain()</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;  <span class="comment">!---- diagnostics for FV dynamics -----</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%print_freq /= -99) <span class="keywordflow">then</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;     <span class="keyword">call </span>mpp_clock_begin(<a class="code" href="namespaceatmosphere__mod.html#a6d434f016963346507b32a22b7f41440">id_fv_diag</a>)</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;     <a class="code" href="namespacefv__diagnostics__mod.html#ad47b1fcfcd29f3dc6009a3a52208a573">fv_time</a> = time_next</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;     <span class="keyword">call </span>get_time (<a class="code" href="namespacefv__diagnostics__mod.html#ad47b1fcfcd29f3dc6009a3a52208a573">fv_time</a>, <a class="code" href="namespaceatmosphere__mod.html#aafb92c94f8850295ad027e0538ae78ca">seconds</a>,  <a class="code" href="namespaceatmosphere__mod.html#a110bc10bed586ca2cddc28ac924959a7">days</a>)</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;     <span class="keyword">call </span>nullify_domain()</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;     <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#a85fb4c4c6b3d9604bb682356ab3e7a82">timing_on</a>(<span class="stringliteral">&#39;FV_DIAG&#39;</span>)</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;     <span class="keyword">call </span><a class="code" href="namespacefv__diagnostics__mod.html#a6f0646bd762a9150bf0636f22f70cfbc">fv_diag</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>:<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>), <a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>, <a class="code" href="namespacefv__diagnostics__mod.html#ad47b1fcfcd29f3dc6009a3a52208a573">fv_time</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%print_freq)</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;     <a class="code" href="namespaceatmosphere__mod.html#ad7cd98f866fa2b4b4f8528f385d7efc1">first_diag</a> = .false.</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;     <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#ad40e8855859ae4d87ac63985163a1c3d">timing_off</a>(<span class="stringliteral">&#39;FV_DIAG&#39;</span>)</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;     <span class="keyword">call </span>mpp_clock_end(<a class="code" href="namespaceatmosphere__mod.html#a6d434f016963346507b32a22b7f41440">id_fv_diag</a>)</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="keywordflow">   endif</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#abf96613ef8db32b3e66f3297f62a0346">atmosphere_state_update</a></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#abd3fee5137633b7451c0ee1f29942e26">adiabatic_init</a>(zvir,nudge_dz,time)</div><div class="line"><a name="l01609"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#abd3fee5137633b7451c0ee1f29942e26"> 1609</a></span>&#160;   <span class="keywordtype">type</span>(time_type),<span class="keywordtype">intent(in)</span> :: time</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span>:: u0, v0, t0, dz0, dp0</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;   <span class="keywordtype">real</span>,    <span class="keywordtype">intent(in)</span>   :: zvir</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(inout)</span>:: nudge_dz</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="comment">!  real, parameter:: wt = 1.  ! was 2.</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span>:: wt = 2.</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment">!***********</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment">! Haloe Data</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment">!***********</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span>::    q1_h2o = 2.2e-6</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span>::    q7_h2o = 3.8e-6</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span>::  q100_h2o = 3.8e-6</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span>:: q1000_h2o = 3.1e-6</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span>:: q2000_h2o = 2.8e-6</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;   <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span>:: q3000_h2o = 3.0e-6</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;   <span class="keywordtype">real</span>:: xt, p00, q00</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;   <span class="keywordtype">integer</span>:: isc, iec, jsc, jec, npz</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;   <span class="keywordtype">integer</span>:: m, n, i,j,k, ngc, n_split_loc, days</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;   <span class="keywordtype">character(len=80)</span> :: errstr</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;   xt = 1./(1.+wt)</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;   <span class="keyword">write</span>(errstr,<span class="stringliteral">&#39;(A, I4, A)&#39;</span>) <span class="stringliteral">&#39;Performing adiabatic init&#39;</span>,  <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%na_init, <span class="stringliteral">&#39; times&#39;</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;   <span class="keyword">call </span>mpp_error(note, errstr)</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a794b092a72b516a3078dbff077136a08">sphum</a> = get_tracer_index(model_atmos, <span class="stringliteral">&#39;sphum&#39;</span> )</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    npz = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npz</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    isc = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%isc</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    iec = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%iec</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    jsc = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%jsc</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    jec = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd%jec</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    ngc = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ng</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <a class="code" href="namespaceatmosphere__mod.html#a26b6f2e397bc0d76f12ae674aad670be">isd</a> = isc - ngc</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    <a class="code" href="namespaceatmosphere__mod.html#a775666c64f59edcf96c530c1fc0f1ee9">ied</a> = iec + ngc</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    <a class="code" href="namespaceatmosphere__mod.html#a972cd4fc5737c35941feca9dbb6e46a8">jsd</a> = jsc - ngc</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <a class="code" href="namespaceatmosphere__mod.html#a0d51bfe05ec1bd062c1fbbc01c42bf3a">jed</a> = jec + ngc</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;     <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#a85fb4c4c6b3d9604bb682356ab3e7a82">timing_on</a>(<span class="stringliteral">&#39;adiabatic_init&#39;</span>)</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;     <a class="code" href="namespacefv__nwp__nudge__mod.html#a1be70541c37811b39b54dcf8d977feac">do_adiabatic_init</a> = .true.</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;     <span class="keyword">allocate</span> ( u0(isc:iec,  jsc:jec+1, npz) )</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;     <span class="keyword">allocate</span> ( v0(isc:iec+1,jsc:jec,   npz) )</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;     <span class="keyword">allocate</span> (dp0(isc:iec,jsc:jec, npz) )</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;     <span class="keywordflow">if</span> ( <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic ) nudge_dz = .false.</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;     <span class="keywordflow">if</span> ( nudge_dz ) <span class="keywordflow">then</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;          <span class="keyword">allocate</span> (dz0(isc:iec,jsc:jec, npz) )</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;     <span class="keywordflow">else</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;          <span class="keyword">allocate</span> ( t0(isc:iec,jsc:jec, npz) )</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="keywordflow">     endif</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="comment">!$omp parallel do default (none) &amp; </span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="comment">!$omp              shared (nudge_dz, npz, jsc, jec, isc, iec, n, sphum, u0, v0, t0, dz0, dp0, Atm, zvir, mytile) &amp;</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="comment">!$omp             private (k, j, i) </span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;       <span class="keywordflow">do</span> k=1,npz</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;          <span class="keywordflow">do</span> j=jsc,jec+1</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;             <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                u0(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%u(i,j,k)</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="keywordflow">             enddo</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;          <span class="keywordflow">do</span> j=jsc,jec</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;             <span class="keywordflow">do</span> i=isc,iec+1</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                v0(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%v(i,j,k)</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="keywordflow">             enddo</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;          <span class="keywordflow">if</span> ( nudge_dz ) <span class="keywordflow">then</span></div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;             <span class="keywordflow">do</span> j=jsc,jec</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;                <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                   dp0(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,k)</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;                   dz0(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz(i,j,k)</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="keywordflow">             enddo</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;             <span class="keywordflow">do</span> j=jsc,jec</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="preprocessor">#ifdef MULTI_GASES</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="preprocessor"></span>                   t0(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,k)*<a class="code" href="namespacemulti__gases__mod.html#a91649465dfa64dee4a0aa4db33496b34">virq</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,k,:))  <span class="comment">! virt T</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="preprocessor"></span>                   t0(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,k)*(1.+zvir*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,k,<a class="code" href="namespaceatmosphere__mod.html#a794b092a72b516a3078dbff077136a08">sphum</a>))  <span class="comment">! virt T</span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="preprocessor"></span>                   dp0(i,j,k) = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,k)</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="keywordflow">             enddo</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;       <span class="keyword">call </span>get_time (time, <a class="code" href="namespaceatmosphere__mod.html#aafb92c94f8850295ad027e0538ae78ca">seconds</a>, days)</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespaceatmosphere__mod.html#aafb92c94f8850295ad027e0538ae78ca">seconds</a> &lt; nint(3600*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%fhouri) .and. <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%fac_n_spl &gt; 1.0) <span class="keywordflow">then</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        n_split_loc = nint(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%n_split * <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%fac_n_spl)</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        n_split_loc = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%n_split</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="comment">!     write(0,*)&#39; before calling init  n_split_loc=&#39;,n_split_loc,&#39; seconds=&#39;,seconds,&#39; days=&#39;,days,&amp;</span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="comment">!               &#39; n_split=&#39;,Atm(mytile)%flagstruct%n_split,&#39; mytile=&#39;,mytile</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;     <span class="keywordflow">do</span> m=1,<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%na_init</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="comment">! Forward call</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacefv__dynamics__mod.html#a57030300ce6aacf81a3588faf906f07f">fv_dynamics</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npx, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npy, npz,  <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ng, <a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a>, 0.,                 &amp;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%fill, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%reproduce_sum, kappa, cp_air, zvir,   &amp;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="comment">!                       Atm(mytile)%ptop, Atm(mytile)%ks, nq, Atm(mytile)%flagstruct%n_split,                     &amp;</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ptop, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ks, <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>,  n_split_loc,                                       &amp;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%q_split, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%u, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%v, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%w,              &amp;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic,                                     &amp; </div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ps,                          &amp;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pe, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pk, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pkz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%phis,      &amp;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q_con, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%omga, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ua, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%va, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%uc, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%vc, &amp;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bk, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%mfx, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%mfy,                         &amp;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%cx, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%cy, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ze0, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hybrid_z,         &amp;</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct,                                           &amp;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%neststruct, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%idiag, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%parent_grid,       &amp;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%domain,<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%diss_est)</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="comment">! Backward</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacefv__dynamics__mod.html#a57030300ce6aacf81a3588faf906f07f">fv_dynamics</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npx, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npy, npz,  <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ng, -<a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a>, 0.,                &amp;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%fill, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%reproduce_sum, kappa, cp_air, zvir,   &amp;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;<span class="comment">!                       Atm(mytile)%ptop, Atm(mytile)%ks, nq, Atm(mytile)%flagstruct%n_split,                     &amp;</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ptop, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ks, <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>, n_split_loc,                                        &amp;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%q_split, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%u, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%v, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%w,              &amp;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic,                                     &amp; </div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ps,                          &amp;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pe, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pk, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pkz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%phis,      &amp;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q_con, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%omga, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ua, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%va, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%uc, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%vc, &amp;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak,    <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bk,   <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%mfx, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%mfy,                    &amp;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%cx,    <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%cy,   <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ze0, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hybrid_z,    &amp;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct,                                           &amp;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%neststruct, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%idiag, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%parent_grid,       &amp;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%domain,<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%diss_est)</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="comment">!Nudging back to IC</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">!$omp parallel do default (none) &amp;</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment">!$omp              shared (pref, npz, jsc, jec, isc, iec, n, sphum, Atm, u0, v0, t0, dp0, xt, zvir, mytile, nudge_dz, dz0) &amp;</span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment">!$omp             private (i, j, k, p00, q00)</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;       <span class="keywordflow">do</span> k=1,npz</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;         <span class="keywordflow">do</span> j=jsc,jec+1</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;           <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;             <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%u(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%u(i,j,k) + wt*u0(i,j,k))</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="keywordflow">           enddo</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;         <span class="keywordflow">do</span> j=jsc,jec</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;           <span class="keywordflow">do</span> i=isc,iec+1</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;             <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%v(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%v(i,j,k) + wt*v0(i,j,k))</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="keywordflow">           enddo</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;         <span class="keywordflow">if</span>( <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%nudge_qv ) <span class="keywordflow">then</span></div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;<span class="comment">! SJL note: Nudging water vaport towards HALOE climatology:</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;<span class="comment">! In case of better IC (IFS) this step may not be necessary</span></div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;           p00 = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pe(isc,k,jsc)</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;           <span class="keywordflow">if</span> ( p00 &lt; 30.e2 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;              <span class="keywordflow">if</span> ( p00 &lt; 1. ) <span class="keywordflow">then</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;                 q00 = q1_h2o</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;              <span class="keywordflow">elseif</span> ( p00 &lt;= 7. .and. p00 &gt;= 1. ) <span class="keywordflow">then</span></div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;                 q00 = q1_h2o + (q7_h2o-q1_h2o)*log(<a class="code" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">pref</a>(k,1)/1.)/log(7.)</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;              <span class="keywordflow">elseif</span> ( p00 &lt; 100. .and. p00 &gt;= 7. ) <span class="keywordflow">then</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;                 q00 = q7_h2o + (q100_h2o-q7_h2o)*log(<a class="code" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">pref</a>(k,1)/7.)/log(100./7.)</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;              <span class="keywordflow">elseif</span> ( p00 &lt; 1000. .and. p00 &gt;= 100. ) <span class="keywordflow">then</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;                 q00 = q100_h2o + (q1000_h2o-q100_h2o)*log(<a class="code" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">pref</a>(k,1)/1.e2)/log(10.)</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;              <span class="keywordflow">elseif</span> ( p00 &lt; 2000. .and. p00 &gt;= 1000. ) <span class="keywordflow">then</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;                 q00 = q1000_h2o + (q2000_h2o-q1000_h2o)*log(<a class="code" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">pref</a>(k,1)/1.e3)/log(2.)</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;                 q00 = q2000_h2o + (q3000_h2o-q2000_h2o)*log(<a class="code" href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">pref</a>(k,1)/2.e3)/log(1.5)</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;              <span class="keywordflow">do</span> j=jsc,jec</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;                <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                   <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,k,<a class="code" href="namespaceatmosphere__mod.html#a794b092a72b516a3078dbff077136a08">sphum</a>) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,k,<a class="code" href="namespaceatmosphere__mod.html#a794b092a72b516a3078dbff077136a08">sphum</a>) + wt*q00)</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="keywordflow">           endif</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="keywordflow">         endif</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;         <span class="keywordflow">if</span> ( nudge_dz ) <span class="keywordflow">then</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            <span class="keywordflow">do</span> j=jsc,jec</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;              <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,k) + wt*dp0(i,j,k))</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz(i,j,k) + wt*dz0(i,j,k))</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;            <span class="keywordflow">do</span> j=jsc,jec</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;              <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="preprocessor">#ifdef MULTI_GASES</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="preprocessor"></span>                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,k) + wt*t0(i,j,k)/<a class="code" href="namespacemulti__gases__mod.html#a91649465dfa64dee4a0aa4db33496b34">virq</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,k,:)))</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="preprocessor"></span>                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,k) + wt*t0(i,j,k)/(1.+zvir*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,k,<a class="code" href="namespaceatmosphere__mod.html#a794b092a72b516a3078dbff077136a08">sphum</a>)))</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="preprocessor"></span>                 <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,k) + wt*dp0(i,j,k))</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="keywordflow">         endif</span></div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="comment">! Backward</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacefv__dynamics__mod.html#a57030300ce6aacf81a3588faf906f07f">fv_dynamics</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npx, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npy, npz,  <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ng, -<a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a>, 0.,                &amp;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%fill, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%reproduce_sum, kappa, cp_air, zvir,   &amp;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="comment">!                       Atm(mytile)%ptop, Atm(mytile)%ks, nq, Atm(mytile)%flagstruct%n_split,                     &amp;</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ptop, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ks, <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>, n_split_loc,                                        &amp;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%q_split, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%u, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%v, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%w,              &amp;</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic,                                     &amp; </div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ps,                          &amp;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pe, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pk, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pkz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%phis,      &amp;</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q_con, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%omga, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ua, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%va, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%uc, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%vc, &amp;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bk, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%mfx, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%mfy,                         &amp;</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%cx, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%cy, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ze0, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hybrid_z,         &amp;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct,                                           &amp;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%neststruct, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%idiag, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%parent_grid,       &amp;</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%domain,<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%diss_est)</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment">! Forward call</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacefv__dynamics__mod.html#a57030300ce6aacf81a3588faf906f07f">fv_dynamics</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npx, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%npy, npz,  <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ng, <a class="code" href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">dt_atmos</a>, 0.,                 &amp;</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%fill, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%reproduce_sum, kappa, cp_air, zvir,   &amp;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">!                       Atm(mytile)%ptop, Atm(mytile)%ks, nq, Atm(mytile)%flagstruct%n_split,                     &amp;</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ptop, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ks, <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>, n_split_loc,                                        &amp;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%q_split, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%u, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%v, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%w,              &amp;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic,                                     &amp; </div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ps,                          &amp;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pe, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pk, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%peln, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pkz, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%phis,      &amp;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q_con, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%omga, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ua, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%va, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%uc, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%vc, &amp;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bk, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%mfx, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%mfy,                         &amp;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%cx, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%cy, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ze0, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hybrid_z,         &amp;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%gridstruct, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct,                                           &amp;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%neststruct, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%idiag, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%bd, <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%parent_grid,       &amp;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;                        <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%domain,<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%diss_est)</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="comment">! Nudging back to IC</span></div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="comment">!$omp parallel do default (none) &amp;</span></div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment">!$omp              shared (nudge_dz,npz, jsc, jec, isc, iec, n, sphum, Atm, u0, v0, t0, dz0, dp0, xt, zvir, mytile) &amp;</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="comment">!$omp             private (i, j, k)</span></div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;       <span class="keywordflow">do</span> k=1,npz</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;         <span class="keywordflow">do</span> j=jsc,jec+1</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;           <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;              <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%u(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%u(i,j,k) + wt*u0(i,j,k))</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;         <span class="keywordflow">do</span> j=jsc,jec</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;           <span class="keywordflow">do</span> i=isc,iec+1</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;              <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%v(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%v(i,j,k) + wt*v0(i,j,k))</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="keywordflow">           enddo</span></div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;         <span class="keywordflow">if</span> ( nudge_dz ) <span class="keywordflow">then</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;           <span class="keywordflow">do</span> j=jsc,jec</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;             <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,k) + wt*dp0(i,j,k))</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz(i,j,k) + wt*dz0(i,j,k))</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;<span class="keywordflow">             enddo</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="keywordflow">           enddo</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;           <span class="keywordflow">do</span> j=jsc,jec</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;             <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="preprocessor">#ifdef MULTI_GASES</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="preprocessor"></span>                <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,k) + wt*t0(i,j,k)/<a class="code" href="namespacemulti__gases__mod.html#a91649465dfa64dee4a0aa4db33496b34">virq</a>(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,k,:)))</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="preprocessor"></span>                <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,k) + wt*t0(i,j,k)/(1.+zvir*<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,k,<a class="code" href="namespaceatmosphere__mod.html#a794b092a72b516a3078dbff077136a08">sphum</a>)))</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="preprocessor"></span>                <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,k) = xt*(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,k) + wt*dp0(i,j,k))</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="keywordflow">             enddo</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="keywordflow">           enddo</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="keywordflow">         endif</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;     <span class="keyword">deallocate</span> ( u0 )</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;     <span class="keyword">deallocate</span> ( v0 )</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;     <span class="keyword">deallocate</span> (dp0 )</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;     <span class="keywordflow">if</span> ( <span class="keyword">allocated</span>(t0) )  <span class="keyword">deallocate</span> ( t0 )</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;     <span class="keywordflow">if</span> ( <span class="keyword">allocated</span>(dz0) ) <span class="keyword">deallocate</span> ( dz0 )</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;     <a class="code" href="namespacefv__nwp__nudge__mod.html#a1be70541c37811b39b54dcf8d977feac">do_adiabatic_init</a> = .false.</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;     <span class="keyword">call </span><a class="code" href="namespacefv__timing__mod.html#ad40e8855859ae4d87ac63985163a1c3d">timing_off</a>(<span class="stringliteral">&#39;adiabatic_init&#39;</span>)</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#abd3fee5137633b7451c0ee1f29942e26">adiabatic_init</a></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="preprocessor">#if defined(OVERLOAD_R4)</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define _DBL_(X) DBLE(X)</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define _RL_(X) REAL(X,KIND=4)</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#else</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define _DBL_(X) X</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define _RL_(X) X</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="preprocessor"></span><span class="keyword"> subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a5dfb607fd7c0bb4cd771a72f1daf8ded">atmos_phys_driver_statein</a> (IPD_Data, Atm_block,flip_vc)</div><div class="line"><a name="l01897"></a><span class="lineno"><a class="line" href="namespaceatmosphere__mod.html#a5dfb607fd7c0bb4cd771a72f1daf8ded"> 1897</a></span>&#160;   type(ipd_data_type),      <span class="keywordtype">intent(inout)</span> :: ipd_data(:)</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;   type(block_control_type), <span class="keywordtype">intent(in)</span>    :: atm_block</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;   <span class="keywordtype">logical</span>,                   <span class="keywordtype">intent(in)</span>    :: flip_vc</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="comment">!--------------------------------------</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="comment">! Local GFS-phys consistent parameters:</span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="comment">!--------------------------------------</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;   <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: p00 = 1.e5</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;   <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: qmin = 1.0e-10   </div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;   <span class="keywordtype">real(kind=kind_phys)</span> :: pk0inv, ptop, pktop</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;   <span class="keywordtype">real(kind=kind_phys)</span> :: rtv, dm, qgrs_rad</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;   <span class="keywordtype">integer</span> :: nb, blen, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>, i, j, k, ix, k1, kz, dnats, nq_adv</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="comment">!!! NOTES: lmh 6nov15</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment">!!! - &quot;Layer&quot; means &quot;layer mean&quot;, ie. the average value in a layer</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment">!!! - &quot;Level&quot; means &quot;level interface&quot;, ie the point values at the top or bottom of a layer</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;   ptop   = _dbl_(_rl_(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ak(1)))</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;   pktop  = (ptop/p00)**kappa</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;   pk0inv = (1.0_kind_phys/p00)**kappa</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;   <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>    = atm_block%npz</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;   dnats  = <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%dnats</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;   nq_adv = <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a> - dnats</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;<span class="comment">!---------------------------------------------------------------------</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="comment">! use most up to date atmospheric properties when running serially</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;<span class="comment">!---------------------------------------------------------------------</span></div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="comment">!$OMP parallel do default (none) &amp; </span></div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="comment">!$OMP             shared  (Atm_block, Atm, IPD_Data, npz, nq, ncnst, sphum, liq_wat, &amp;</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;<span class="comment">!$OMP                      ice_wat, rainwat, snowwat, graupel, pk0inv, ptop,   &amp;</span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="comment">!$OMP                      pktop, zvir, mytile, dnats, nq_adv, flip_vc) &amp;</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="comment">!$OMP             private (dm, nb, blen, i, j, ix, k1, kz, rTv, qgrs_rad)</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;   <span class="keywordflow">do</span> nb = 1,atm_block%nblks</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<span class="comment">! gas_phase_mass &lt;-- prsl</span></div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;<span class="comment">! log(pe) &lt;-- prsik</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;     blen = atm_block%blksz(nb)</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;     <span class="comment">!-- level interface geopotential height (relative to the surface)</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;     <span class="keywordflow">if</span>(flip_vc) <span class="keywordflow">then</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;       ipd_data(nb)%Statein%phii(:,1) = 0.0_kind_phys</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;     <span class="keywordflow">else</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;       ipd_data(nb)%Statein%phii(:,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1) = 0.0_kind_phys</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;<span class="keywordflow">     endif</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;     ipd_data(nb)%Statein%prsik(:,:) = 1.e25_kind_phys</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;     <span class="keywordflow">do</span> k = 1, <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;       <span class="comment">!Indices for FV&#39;s vertical coordinate, for which 1 = top</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;       <span class="comment">!here, k is the index for GFS&#39;s vertical coordinate, for which 1 =</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;       <span class="comment">!bottom</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;       kz = <a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1-k</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;       <span class="keywordflow">if</span>(flip_vc) <span class="keywordflow">then</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;         k1 = kz <span class="comment">! flipping the index</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;       <span class="keywordflow">else</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;         k1 = k</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="keywordflow">       endif</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;       <span class="keywordflow">do</span> ix = 1, blen</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;         i = atm_block%index(nb)%ii(ix)</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;         j = atm_block%index(nb)%jj(ix)</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;         ipd_data(nb)%Statein%tgrs(ix,k) = _dbl_(_rl_(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%pt(i,j,k1)))</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;         ipd_data(nb)%Statein%ugrs(ix,k) = _dbl_(_rl_(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%ua(i,j,k1)))</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;         ipd_data(nb)%Statein%vgrs(ix,k) = _dbl_(_rl_(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%va(i,j,k1)))</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;         ipd_data(nb)%Statein%vvl(ix,k)  = _dbl_(_rl_(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%omga(i,j,k1)))</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;         ipd_data(nb)%Statein%prsl(ix,k) = _dbl_(_rl_(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delp(i,j,k1)))   <span class="comment">! Total mass</span></div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%do_skeb)ipd_data(nb)%Statein%diss_est(ix,k) = _dbl_(_rl_(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%diss_est(i,j,k1)))</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;         <span class="keywordflow">if</span>(flip_vc) <span class="keywordflow">then</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;           <span class="keywordflow">if</span> (.not.<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic .and. (.not.<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%use_hydro_pressure))  &amp;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;             ipd_data(nb)%Statein%phii(ix,k+1) = ipd_data(nb)%Statein%phii(ix,k) - _dbl_(_rl_(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz(i,j,k1)*grav))</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;           <span class="keywordflow">if</span> (.not.<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic .and. (.not.<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%use_hydro_pressure))  &amp;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;             ipd_data(nb)%Statein%phii(ix,kz) = ipd_data(nb)%Statein%phii(ix,kz+1) - _dbl_(_rl_(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%delz(i,j,kz)*grav))</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;<span class="keywordflow">         endif</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="comment">! Convert to tracer mass:</span></div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;         ipd_data(nb)%Statein%qgrs(ix,k,1:nq_adv) =  _dbl_(_rl_(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,k1,1:nq_adv))) &amp;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                                                          * ipd_data(nb)%Statein%prsl(ix,k)</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;         <span class="keywordflow">if</span> (dnats &gt; 0) &amp;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;             ipd_data(nb)%Statein%qgrs(ix,k,nq_adv+1:<a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>) =  _dbl_(_rl_(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%q(i,j,k1,nq_adv+1:<a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>)))</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;         <span class="comment">!--- SHOULD THESE BE CONVERTED TO MASS SINCE THE DYCORE DOES NOT TOUCH THEM IN ANY WAY???</span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;         <span class="comment">!--- See Note in state update...</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;         <span class="keywordflow">if</span> ( <a class="code" href="namespaceatmosphere__mod.html#a9a8c995d33f2c1869ae7d0b49d5e1002">ncnst</a> &gt; <a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>) &amp;</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;             ipd_data(nb)%Statein%qgrs(ix,k,<a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>+1:<a class="code" href="namespaceatmosphere__mod.html#a9a8c995d33f2c1869ae7d0b49d5e1002">ncnst</a>) = _dbl_(_rl_(<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%qdiag(i,j,k1,<a class="code" href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">nq</a>+1:<a class="code" href="namespaceatmosphere__mod.html#a9a8c995d33f2c1869ae7d0b49d5e1002">ncnst</a>)))</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;<span class="comment">! Remove the contribution of condensates to delp (mass):</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;         <span class="keywordflow">if</span> ( <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%nwat == 6 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;            ipd_data(nb)%Statein%prsl(ix,k) = ipd_data(nb)%Statein%prsl(ix,k)           &amp;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                                            - ipd_data(nb)%Statein%qgrs(ix,k,<a class="code" href="namespaceatmosphere__mod.html#a41f34859d8c8fd6e84cd71aabd6d2a25">liq_wat</a>)   &amp;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;                                            - ipd_data(nb)%Statein%qgrs(ix,k,<a class="code" href="namespaceatmosphere__mod.html#a9d5b133b6c0010773c3f475af7e879fc">ice_wat</a>)   &amp;</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;                                            - ipd_data(nb)%Statein%qgrs(ix,k,<a class="code" href="namespaceatmosphere__mod.html#ad9345d06c2a877903e3bfdfb529a2a63">rainwat</a>)   &amp;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;                                            - ipd_data(nb)%Statein%qgrs(ix,k,<a class="code" href="namespaceatmosphere__mod.html#a638b8d7ecc568cfe3706105b9db0affe">snowwat</a>)   &amp;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;                                            - ipd_data(nb)%Statein%qgrs(ix,k,<a class="code" href="namespaceatmosphere__mod.html#a6af183d451e4d59e5cd97150b69e9ec7">graupel</a>)</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;         <span class="keywordflow">else</span> <span class="comment">!variable condensate numbers</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;            ipd_data(nb)%Statein%prsl(ix,k) = ipd_data(nb)%Statein%prsl(ix,k) &amp;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                                            - sum(ipd_data(nb)%Statein%qgrs(ix,k,2:<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%nwat))   </div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="keywordflow">         endif</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;<span class="comment">! Re-compute pressure (dry_mass + water_vapor) derived fields:</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;     <span class="keywordflow">if</span>(flip_vc) <span class="keywordflow">then</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;       <span class="keywordflow">do</span> i=1,blen</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;         ipd_data(nb)%Statein%prsi(i,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1) = ptop </div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;       <span class="keywordflow">do</span> k=<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>,1,-1</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;         <span class="keywordflow">do</span> i=1,blen</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;           ipd_data(nb)%Statein%prsi(i,k)  = ipd_data(nb)%Statein%prsi(i,k+1) + ipd_data(nb)%Statein%prsl(i,k)</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;           ipd_data(nb)%Statein%prsik(i,k) = log( ipd_data(nb)%Statein%prsi(i,k) )</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;<span class="comment">! Redefine mixing ratios for GFS == tracer_mass / (dry_air_mass + water_vapor_mass)</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;           ipd_data(nb)%Statein%qgrs(i,k,1:nq_adv) = ipd_data(nb)%Statein%qgrs(i,k,1:nq_adv) &amp;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;                                                   / ipd_data(nb)%Statein%prsl(i,k)</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;     <span class="keywordflow">else</span></div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;       <span class="keywordflow">do</span> i=1,blen</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;         ipd_data(nb)%Statein%prsi(i,    1) = ptop </div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;       <span class="keywordflow">do</span> k=1,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;         <span class="keywordflow">do</span> i=1,blen</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;           ipd_data(nb)%Statein%prsi(i,k+1)  = ipd_data(nb)%Statein%prsi(i,k) + ipd_data(nb)%Statein%prsl(i,k)</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;           ipd_data(nb)%Statein%prsik(i,k) = log( ipd_data(nb)%Statein%prsi(i,k) )</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="comment">! Redefine mixing ratios for GFS == tracer_mass / (dry_air_mass + water_vapor_mass)</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;           ipd_data(nb)%Statein%qgrs(i,k,1:nq_adv) = ipd_data(nb)%Statein%qgrs(i,k,1:nq_adv) &amp;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;                                                   / ipd_data(nb)%Statein%prsl(i,k)</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="keywordflow">     endif</span></div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;     <span class="keywordflow">do</span> i=1,blen</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;        ipd_data(nb)%Statein%pgr(i)         = ipd_data(nb)%Statein%prsi(i,1)    <span class="comment">! surface pressure for GFS</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;        ipd_data(nb)%Statein%prsik(i,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1) = log(ptop)</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;     <span class="keywordflow">do</span> k=1,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        <span class="keywordflow">do</span> i=1,blen</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="comment">! Geo-potential at interfaces:</span></div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;<span class="preprocessor">#ifdef MULTI_GASES</span></div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="preprocessor"></span>           rtv = rdgas*ipd_data(nb)%Statein%tgrs(i,k)*<a class="code" href="namespacemulti__gases__mod.html#ab6332eff515faa91fd8560fff744f704">virq_max</a>(ipd_data(nb)%Statein%qgrs(i,k,:),qmin)</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="preprocessor"></span>           qgrs_rad = max(qmin,ipd_data(nb)%Statein%qgrs(i,k,<a class="code" href="namespaceatmosphere__mod.html#a794b092a72b516a3078dbff077136a08">sphum</a>))</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;           rtv = rdgas*ipd_data(nb)%Statein%tgrs(i,k)*(1.+<a class="code" href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">zvir</a>*qgrs_rad)</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="preprocessor"></span>           <span class="keywordflow">if</span> ( <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic .or. <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%use_hydro_pressure )   &amp;</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;                ipd_data(nb)%Statein%phii(i,k+1) = ipd_data(nb)%Statein%phii(i,k) &amp;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;                                                     + rtv*(ipd_data(nb)%Statein%prsik(i,k) &amp;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;                                                          - ipd_data(nb)%Statein%prsik(i,k+1))</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="comment">! Layer mean pressure by perfect gas law:</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;           dm = ipd_data(nb)%Statein%prsl(i,k)</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;           ipd_data(nb)%Statein%prsl(i,k) = dm*rtv/(ipd_data(nb)%Statein%phii(i,k+1) &amp;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;                                                  - ipd_data(nb)%Statein%phii(i,k))</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="comment">!!! Ensure subgrid MONOTONICITY of Pressure: SJL 09/11/2016</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;           <span class="keywordflow">if</span> ( .not.<a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic ) <span class="keywordflow">then</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="comment">! If violated, replaces it with hydrostatic pressure</span></div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;              ipd_data(nb)%Statein%prsl(i,k) = min(ipd_data(nb)%Statein%prsl(i,k), &amp;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;                                                   ipd_data(nb)%Statein%prsi(i,k)   - 0.01*dm)</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;              ipd_data(nb)%Statein%prsl(i,k) = max(ipd_data(nb)%Statein%prsl(i,k), &amp;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;                                                   ipd_data(nb)%Statein%prsi(i,k+1) + 0.01*dm)</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="keywordflow">           endif</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;     <span class="keywordflow">do</span> k = 1,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a></div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        <span class="keywordflow">do</span> i=1,blen</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="comment">! Exner function layer center: large sensitivity to non-hydro runs with moist kappa</span></div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;           ipd_data(nb)%Statein%prslk(i,k) = exp( kappa*log(ipd_data(nb)%Statein%prsl(i,k)/p00) )</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="comment">!--  layer center geopotential; geometric midpoint</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;           ipd_data(nb)%Statein%phil(i,k) = 0.5_kind_phys*(ipd_data(nb)%Statein%phii(i,k) &amp;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;                                                         + ipd_data(nb)%Statein%phii(i,k+1))</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;<span class="keywordflow">     enddo</span></div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="comment">! Compute Exner function at layer &quot;interfaces&quot;</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    <span class="keywordflow">do</span> i=1,blen</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;<span class="comment">!      Top &amp; Bottom edges computed hydrostaticlly</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;       ipd_data(nb)%Statein%prsik(i,    1) = exp( kappa*ipd_data(nb)%Statein%prsik(i,1) )*pk0inv  <span class="comment">! bottom</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;       ipd_data(nb)%Statein%prsik(i,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a>+1) = pktop                           <span class="comment">! TOA</span></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%hydrostatic .or. <a class="code" href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atm</a>(<a class="code" href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">mytile</a>)%flagstruct%use_hydro_pressure ) <span class="keywordflow">then</span></div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;        <span class="keywordflow">do</span> k=2,<a class="code" href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">npz</a></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;           <span class="keywordflow">do</span> i=1,blen</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;              ipd_data(nb)%Statein%prsik(i,k) = exp( kappa*ipd_data(nb)%Statein%prsik(i,k) )*pk0inv </div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="keywordflow">           enddo</span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;<span class="keyword"> end subroutine </span><a class="code" href="namespaceatmosphere__mod.html#a5dfb607fd7c0bb4cd771a72f1daf8ded">atmos_phys_driver_statein</a></div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;<span class="keyword">end module </span><a class="code" href="namespaceatmosphere__mod.html">atmosphere_mod</a></div><div class="ttc" id="namespaceatmosphere__mod_html_ac8fcb2d928bac9a8e1d31fb4bd5fe3b1"><div class="ttname"><a href="namespaceatmosphere__mod.html#ac8fcb2d928bac9a8e1d31fb4bd5fe3b1">atmosphere_mod::atmosphere_end</a></div><div class="ttdeci">subroutine, public atmosphere_end(Time, Grid_box)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_end&amp;#39; is an API for the termination of the FV3 dynamical core responsible f...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00716">atmosphere.F90:716</a></div></div>
<div class="ttc" id="namespacefv__diagnostics__mod_html_a2caa18f65b49b0d404e4eee6e8514441"><div class="ttname"><a href="namespacefv__diagnostics__mod.html#a2caa18f65b49b0d404e4eee6e8514441">fv_diagnostics_mod::prt_height</a></div><div class="ttdeci">subroutine, public prt_height(qname, is, ie, js, je, ng, km, press, phis, delz, peln, area, lat)</div><div class="ttdef"><b>Definition:</b> <a href="fv__diagnostics_8F90_source.html#l03543">fv_diagnostics.F90:3543</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_ad7cd98f866fa2b4b4f8528f385d7efc1"><div class="ttname"><a href="namespaceatmosphere__mod.html#ad7cd98f866fa2b4b4f8528f385d7efc1">atmosphere_mod::first_diag</a></div><div class="ttdeci">logical first_diag</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00262">atmosphere.F90:262</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a95ee36e402cdda22fbff7a5e5a698d2d"><div class="ttname"><a href="namespaceatmosphere__mod.html#a95ee36e402cdda22fbff7a5e5a698d2d">atmosphere_mod::p_split</a></div><div class="ttdeci">integer p_split</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00249">atmosphere.F90:249</a></div></div>
<div class="ttc" id="namespacefv__restart__mod_html_aaa447f67223fef4de61917a1a912a133"><div class="ttname"><a href="namespacefv__restart__mod.html#aaa447f67223fef4de61917a1a912a133">fv_restart_mod::fv_restart</a></div><div class="ttdeci">subroutine, public fv_restart(fv_domain, Atm, dt_atmos, seconds, days, cold_start, grid_type, grids_on_this_pe)</div><div class="ttdoc">The subroutine &amp;#39;fv_restart&amp;#39; initializes the model state, including prognaostic variables and several ...</div><div class="ttdef"><b>Definition:</b> <a href="fv__restart_8F90_source.html#l00196">fv_restart.F90:196</a></div></div>
<div class="ttc" id="namespacefv__update__phys__mod_html_a07d63d9929b6cb44156f6ceb8bc27728"><div class="ttname"><a href="namespacefv__update__phys__mod.html#a07d63d9929b6cb44156f6ceb8bc27728">fv_update_phys_mod::fv_update_phys</a></div><div class="ttdeci">subroutine, public fv_update_phys(dt, is, ie, js, je, isd, ied, jsd, jed, ng, nq, u, v, w, delp, pt, q, qdiag, ua, va, ps, pe, peln, pk, pkz, ak, bk, phis, u_srf, v_srf, ts, delz, hydrostatic, u_dt, v_dt, t_dt, moist_phys, Time, nudge, gridstruct, lona, lata, npx, npy, npz, flagstruct, neststruct, bd, domain, ptop, q_dt)</div><div class="ttdef"><b>Definition:</b> <a href="fv__update__phys_8F90_source.html#l00141">fv_update_phys.F90:141</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a46726a89e78937df996b8fa2987af885"><div class="ttname"><a href="namespaceatmosphere__mod.html#a46726a89e78937df996b8fa2987af885">atmosphere_mod::atmosphere_dynamics</a></div><div class="ttdeci">subroutine, public atmosphere_dynamics(Time)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_dynamics&amp;#39; is an API for the main driver of the FV3 dynamical core responsi...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00604">atmosphere.F90:604</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_af16043b77ee4e18b8a8497ad49cfd670"><div class="ttname"><a href="namespaceatmosphere__mod.html#af16043b77ee4e18b8a8497ad49cfd670">atmosphere_mod::atmosphere_hgt</a></div><div class="ttdeci">subroutine, public atmosphere_hgt(hgt, position, relative, flip)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_hgt&amp;#39; is an API to return the height coordinate.  By default, the vertical dimension assumes the standard FV3 convention of TOA (k=1) to Surface (k=npz). There are options to choose location [level (interface) or layer] and absolute vs. relative height (zero-based). </div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00935">atmosphere.F90:935</a></div></div>
<div class="ttc" id="namespacefv__nwp__nudge__mod_html_a1be70541c37811b39b54dcf8d977feac"><div class="ttname"><a href="namespacefv__nwp__nudge__mod.html#a1be70541c37811b39b54dcf8d977feac">fv_nwp_nudge_mod::do_adiabatic_init</a></div><div class="ttdeci">logical, public do_adiabatic_init</div><div class="ttdef"><b>Definition:</b> <a href="fv__nudge_8F90_source.html#l00138">fv_nudge.F90:138</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a8db34afa5af2e9757555a6ce961b26e5"><div class="ttname"><a href="namespaceatmosphere__mod.html#a8db34afa5af2e9757555a6ce961b26e5">atmosphere_mod::npz</a></div><div class="ttdeci">integer npz</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00234">atmosphere.F90:234</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_ab5e69a4d3670d2800a288b1c49ad3d9a"><div class="ttname"><a href="namespaceatmosphere__mod.html#ab5e69a4d3670d2800a288b1c49ad3d9a">atmosphere_mod::nq</a></div><div class="ttdeci">integer nq</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00237">atmosphere.F90:237</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a0c326e48546ef823bdc928ba03bac964"><div class="ttname"><a href="namespaceatmosphere__mod.html#a0c326e48546ef823bdc928ba03bac964">atmosphere_mod::id_udt_dyn</a></div><div class="ttdeci">integer id_udt_dyn</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00254">atmosphere.F90:254</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a2d856ff000261ca516c3ae653a9ef005"><div class="ttname"><a href="namespaceatmosphere__mod.html#a2d856ff000261ca516c3ae653a9ef005">atmosphere_mod::get_stock_pe</a></div><div class="ttdeci">subroutine get_stock_pe(index, value)</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l01330">atmosphere.F90:1330</a></div></div>
<div class="ttc" id="namespacefv__regional__mod_html_acb12d0df0e8fb775d3a41fba0b0f34e9"><div class="ttname"><a href="namespacefv__regional__mod.html#acb12d0df0e8fb775d3a41fba0b0f34e9">fv_regional_mod::current_time_in_seconds</a></div><div class="ttdeci">real, public current_time_in_seconds</div><div class="ttdef"><b>Definition:</b> <a href="fv__regional__bc_8F90_source.html#l00108">fv_regional_bc.F90:108</a></div></div>
<div class="ttc" id="namespacefv__mp__mod_html"><div class="ttname"><a href="namespacefv__mp__mod.html">fv_mp_mod</a></div><div class="ttdoc">The module &amp;#39;fv_mp_mod&amp;#39; is a single program multiple data (SPMD) parallel decompostion/communication m...</div><div class="ttdef"><b>Definition:</b> <a href="fv__mp__mod_8F90_source.html#l00024">fv_mp_mod.F90:24</a></div></div>
<div class="ttc" id="namespacefv__timing__mod_html_ad40e8855859ae4d87ac63985163a1c3d"><div class="ttname"><a href="namespacefv__timing__mod.html#ad40e8855859ae4d87ac63985163a1c3d">fv_timing_mod::timing_off</a></div><div class="ttdeci">subroutine timing_off(blk_name)</div><div class="ttdoc">The subroutine &amp;#39;timing_off&amp;#39; stops a timer. </div><div class="ttdef"><b>Definition:</b> <a href="fv__timing_8F90_source.html#l00180">fv_timing.F90:180</a></div></div>
<div class="ttc" id="namespacefv__restart__mod_html_a4e73a658fb6e3a1e2425e248c355a777"><div class="ttname"><a href="namespacefv__restart__mod.html#a4e73a658fb6e3a1e2425e248c355a777">fv_restart_mod::fv_write_restart</a></div><div class="ttdeci">subroutine, public fv_write_restart(Atm, grids_on_this_pe, timestamp)</div><div class="ttdoc">The subroutine &amp;#39;fv_write_restart&amp;#39; writes restart files to disk. </div><div class="ttdef"><b>Definition:</b> <a href="fv__restart_8F90_source.html#l01420">fv_restart.F90:1420</a></div></div>
<div class="ttc" id="namespacefv__control__mod_html_ad626f01c20738f5101fb5f64e5d3dcfe"><div class="ttname"><a href="namespacefv__control__mod.html#ad626f01c20738f5101fb5f64e5d3dcfe">fv_control_mod::fv_init</a></div><div class="ttdeci">subroutine, public fv_init(Atm, dt_atmos, grids_on_this_pe, p_split)</div><div class="ttdoc">The subroutine &amp;#39;fv_init&amp;#39; initializes FV3. </div><div class="ttdef"><b>Definition:</b> <a href="fv__control_8F90_source.html#l00375">fv_control.F90:375</a></div></div>
<div class="ttc" id="namespacedycore__typedefs_html"><div class="ttname"><a href="namespacedycore__typedefs.html">dycore_typedefs</a></div><div class="ttdef"><b>Definition:</b> <a href="DYCORE__typedefs_8F90_source.html#l00021">DYCORE_typedefs.F90:21</a></div></div>
<div class="ttc" id="namespacefv__regional__mod_html_a829242ae29d3a80d8bf09dbc093cbac0"><div class="ttname"><a href="namespacefv__regional__mod.html#a829242ae29d3a80d8bf09dbc093cbac0">fv_regional_mod::p_step</a></div><div class="ttdeci">integer, public p_step</div><div class="ttdef"><b>Definition:</b> <a href="fv__regional__bc_8F90_source.html#l00183">fv_regional_bc.F90:183</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_af09657a508e73ba69d7a3abeb88d034f"><div class="ttname"><a href="namespaceatmosphere__mod.html#af09657a508e73ba69d7a3abeb88d034f">atmosphere_mod::atmosphere_get_bottom_layer</a></div><div class="ttdeci">subroutine, public atmosphere_get_bottom_layer(Atm_block, DYCORE_Data)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_get_bottom_layer&amp;#39; is an API to provide the bottom layer quantities needed ...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l01249">atmosphere.F90:1249</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_aa372781c11fb092462ce67e7d29f3cb0"><div class="ttname"><a href="namespaceatmosphere__mod.html#aa372781c11fb092462ce67e7d29f3cb0">atmosphere_mod::id_vdt_dyn</a></div><div class="ttdeci">integer id_vdt_dyn</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00254">atmosphere.F90:254</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a3ae095d62282ac16560419aa858cbd5b"><div class="ttname"><a href="namespaceatmosphere__mod.html#a3ae095d62282ac16560419aa858cbd5b">atmosphere_mod::pnats</a></div><div class="ttdeci">integer pnats</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00234">atmosphere.F90:234</a></div></div>
<div class="ttc" id="namespacemulti__gases__mod_html_ada7f0ffe52c60fbe7f6cafd04490c4d8"><div class="ttname"><a href="namespacemulti__gases__mod.html#ada7f0ffe52c60fbe7f6cafd04490c4d8">multi_gases_mod::num_gas</a></div><div class="ttdeci">integer, public num_gas</div><div class="ttdef"><b>Definition:</b> <a href="multi__gases_8F90_source.html#l00044">multi_gases.F90:44</a></div></div>
<div class="ttc" id="namespacefv__nggps__diags__mod_html_a87ed4a1f80258a1b15835104526747e8"><div class="ttname"><a href="namespacefv__nggps__diags__mod.html#a87ed4a1f80258a1b15835104526747e8">fv_nggps_diags_mod::fv_nggps_tavg</a></div><div class="ttdeci">subroutine, public fv_nggps_tavg(Atm, Time_step_atmos, avg_max_length, zvir)</div><div class="ttdef"><b>Definition:</b> <a href="fv__nggps__diag_8F90_source.html#l00737">fv_nggps_diag.F90:737</a></div></div>
<div class="ttc" id="namespacemulti__gases__mod_html"><div class="ttname"><a href="namespacemulti__gases__mod.html">multi_gases_mod</a></div><div class="ttdoc">The module &amp;#39;multi_gases&amp;#39; peforms multi constitutents computations. </div><div class="ttdef"><b>Definition:</b> <a href="multi__gases_8F90_source.html#l00025">multi_gases.F90:25</a></div></div>
<div class="ttc" id="namespacemulti__gases__mod_html_ab6332eff515faa91fd8560fff744f704"><div class="ttname"><a href="namespacemulti__gases__mod.html#ab6332eff515faa91fd8560fff744f704">multi_gases_mod::virq_max</a></div><div class="ttdeci">pure real function, public virq_max(q, qmin)</div><div class="ttdef"><b>Definition:</b> <a href="multi__gases_8F90_source.html#l00175">multi_gases.F90:175</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a5966b09ae320c441007e26cc72e00cea"><div class="ttname"><a href="namespaceatmosphere__mod.html#a5966b09ae320c441007e26cc72e00cea">atmosphere_mod::atmosphere_diss_est</a></div><div class="ttdeci">subroutine, public atmosphere_diss_est(npass)</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l01071">atmosphere.F90:1071</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_abd3fee5137633b7451c0ee1f29942e26"><div class="ttname"><a href="namespaceatmosphere__mod.html#abd3fee5137633b7451c0ee1f29942e26">atmosphere_mod::adiabatic_init</a></div><div class="ttdeci">subroutine adiabatic_init(zvir, nudge_dz, time)</div><div class="ttdoc">The subroutine &amp;#39;adiabatic_init&amp;#39; is an optional step during initialization to pre-condition a solution...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l01609">atmosphere.F90:1609</a></div></div>
<div class="ttc" id="namespacefv__eta__mod_html_ac666b63cee9afad18f2cf33dbced10f6"><div class="ttname"><a href="namespacefv__eta__mod.html#ac666b63cee9afad18f2cf33dbced10f6">fv_eta_mod::get_eta_level</a></div><div class="ttdeci">subroutine, public get_eta_level(npz, p_s, pf, ph, ak, bk, pscale)</div><div class="ttdoc">The subroutine &amp;#39;get_eta_level&amp;#39; returns the interface and layer-mean pressures for reference...</div><div class="ttdef"><b>Definition:</b> <a href="fv__eta_8F90_source.html#l02588">fv_eta.F90:2588</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_adc8bdf1db2df9551cfc25a0c1f7b1385"><div class="ttname"><a href="namespaceatmosphere__mod.html#adc8bdf1db2df9551cfc25a0c1f7b1385">atmosphere_mod::atmosphere_control_data</a></div><div class="ttdeci">subroutine, public atmosphere_control_data(i1, i2, j1, j2, kt, p_hydro, hydro, tile_num)</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00809">atmosphere.F90:809</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a5dfb607fd7c0bb4cd771a72f1daf8ded"><div class="ttname"><a href="namespaceatmosphere__mod.html#a5dfb607fd7c0bb4cd771a72f1daf8ded">atmosphere_mod::atmos_phys_driver_statein</a></div><div class="ttdeci">subroutine, public atmos_phys_driver_statein(IPD_Data, Atm_block, flip_vc)</div><div class="ttdoc">The subroutine &amp;#39;atmos_phys_driver_statein&amp;#39; is an API to populate the IPD_DataStatein container with t...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l01897">atmosphere.F90:1897</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_aa39dea540d1cba46aa0cd710e17bf8a9"><div class="ttname"><a href="namespaceatmosphere__mod.html#aa39dea540d1cba46aa0cd710e17bf8a9">atmosphere_mod::jsc</a></div><div class="ttdeci">integer jsc</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00235">atmosphere.F90:235</a></div></div>
<div class="ttc" id="namespacefv__control__mod_html_abaa40fc70569bf400e1385f95bae1f5f"><div class="ttname"><a href="namespacefv__control__mod.html#abaa40fc70569bf400e1385f95bae1f5f">fv_control_mod::ngrids</a></div><div class="ttdeci">integer, public ngrids</div><div class="ttdef"><b>Definition:</b> <a href="fv__control_8F90_source.html#l00350">fv_control.F90:350</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_ad80223528e58b40110f8a1ffdd3b9aad"><div class="ttname"><a href="namespaceatmosphere__mod.html#ad80223528e58b40110f8a1ffdd3b9aad">atmosphere_mod::grids_on_this_pe</a></div><div class="ttdeci">logical, dimension(:), allocatable grids_on_this_pe</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00251">atmosphere.F90:251</a></div></div>
<div class="ttc" id="namespacefv__update__phys__mod_html"><div class="ttname"><a href="namespacefv__update__phys__mod.html">fv_update_phys_mod</a></div><div class="ttdoc">The module &amp;#39;fv_update_phys&amp;#39; applies physics tendencies consistent with the FV3 discretization and def...</div><div class="ttdef"><b>Definition:</b> <a href="fv__update__phys_8F90_source.html#l00026">fv_update_phys.F90:26</a></div></div>
<div class="ttc" id="namespacefv__arrays__mod_html_ab0ba8527d270f349a84fa0a330be1923"><div class="ttname"><a href="namespacefv__arrays__mod.html#ab0ba8527d270f349a84fa0a330be1923">fv_arrays_mod::r_grid</a></div><div class="ttdeci">integer, parameter, public r_grid</div><div class="ttdef"><b>Definition:</b> <a href="fv__arrays_8F90_source.html#l00035">fv_arrays.F90:35</a></div></div>
<div class="ttc" id="namespacefv__dynamics__mod_html"><div class="ttname"><a href="namespacefv__dynamics__mod.html">fv_dynamics_mod</a></div><div class="ttdoc">The module &amp;#39;fv_dynamics&amp;#39; is the top-level routine for the dynamical core. </div><div class="ttdef"><b>Definition:</b> <a href="fv__dynamics_8F90_source.html#l00026">fv_dynamics.F90:26</a></div></div>
<div class="ttc" id="namespacemulti__gases__mod_html_acdbd2cbc0014ad073f6daadeffc5cfce"><div class="ttname"><a href="namespacemulti__gases__mod.html#acdbd2cbc0014ad073f6daadeffc5cfce">multi_gases_mod::ri</a></div><div class="ttdeci">real, dimension(:), allocatable ri</div><div class="ttdef"><b>Definition:</b> <a href="multi__gases_8F90_source.html#l00048">multi_gases.F90:48</a></div></div>
<div class="ttc" id="namespacefv__sg__mod_html"><div class="ttname"><a href="namespacefv__sg__mod.html">fv_sg_mod</a></div><div class="ttdoc">The module &amp;#39;fv_sg&amp;#39; performs FV sub-grid mixing. </div><div class="ttdef"><b>Definition:</b> <a href="fv__sg_8F90_source.html#l00054">fv_sg.F90:54</a></div></div>
<div class="ttc" id="namespacefv__nwp__nudge__mod_html"><div class="ttname"><a href="namespacefv__nwp__nudge__mod.html">fv_nwp_nudge_mod</a></div><div class="ttdoc">The module fv_nwp_nudge contains routines for nudging to input analyses. note This module is currentl...</div><div class="ttdef"><b>Definition:</b> <a href="fv__nudge_8F90_source.html#l00032">fv_nudge.F90:32</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_ae021e6f5700c65ee41c520e77e44712d"><div class="ttname"><a href="namespaceatmosphere__mod.html#ae021e6f5700c65ee41c520e77e44712d">atmosphere_mod::id_tracerdt_dyn</a></div><div class="ttdeci">integer, dimension(:), allocatable id_tracerdt_dyn</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00242">atmosphere.F90:242</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a6d42cfe750246363957a2e0aaa251f0b"><div class="ttname"><a href="namespaceatmosphere__mod.html#a6d42cfe750246363957a2e0aaa251f0b">atmosphere_mod::time_step_atmos</a></div><div class="ttdeci">type(time_type) time_step_atmos</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00228">atmosphere.F90:228</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a9f0ef35864e057ad8b3b0d5b644cff55"><div class="ttname"><a href="namespaceatmosphere__mod.html#a9f0ef35864e057ad8b3b0d5b644cff55">atmosphere_mod::u_dt</a></div><div class="ttdeci">real, dimension(:,:,:), allocatable u_dt</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00259">atmosphere.F90:259</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a110bc10bed586ca2cddc28ac924959a7"><div class="ttname"><a href="namespaceatmosphere__mod.html#a110bc10bed586ca2cddc28ac924959a7">atmosphere_mod::days</a></div><div class="ttdeci">integer days</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00238">atmosphere.F90:238</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a94122314f8c8e6209581bfacbbbf8319"><div class="ttname"><a href="namespaceatmosphere__mod.html#a94122314f8c8e6209581bfacbbbf8319">atmosphere_mod::get_bottom_mass</a></div><div class="ttdeci">subroutine get_bottom_mass(t_bot, tr_bot, p_bot, z_bot, p_surf, slp)</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l01163">atmosphere.F90:1163</a></div></div>
<div class="ttc" id="namespacefv__timing__mod_html"><div class="ttname"><a href="namespacefv__timing__mod.html">fv_timing_mod</a></div><div class="ttdoc">The module &amp;#39;fv_timing&amp;#39; contains FV3 timers. </div><div class="ttdef"><b>Definition:</b> <a href="fv__timing_8F90_source.html#l00024">fv_timing.F90:24</a></div></div>
<div class="ttc" id="namespacemulti__gases__mod_html_a91649465dfa64dee4a0aa4db33496b34"><div class="ttname"><a href="namespacemulti__gases__mod.html#a91649465dfa64dee4a0aa4db33496b34">multi_gases_mod::virq</a></div><div class="ttdeci">pure real function, public virq(q)</div><div class="ttdef"><b>Definition:</b> <a href="multi__gases_8F90_source.html#l00136">multi_gases.F90:136</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_ab2d51769b2b98337ac742bc3f80d55a7"><div class="ttname"><a href="namespaceatmosphere__mod.html#ab2d51769b2b98337ac742bc3f80d55a7">atmosphere_mod::dum1d</a></div><div class="ttdeci">real, dimension(:), allocatable dum1d</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00260">atmosphere.F90:260</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_aeef69bc0cde093c538645187edff87ff"><div class="ttname"><a href="namespaceatmosphere__mod.html#aeef69bc0cde093c538645187edff87ff">atmosphere_mod::npy</a></div><div class="ttdeci">integer npy</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00234">atmosphere.F90:234</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_af368e346f77c2d615969072223e3edad"><div class="ttname"><a href="namespaceatmosphere__mod.html#af368e346f77c2d615969072223e3edad">atmosphere_mod::id_subgridz</a></div><div class="ttdeci">integer id_subgridz</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00239">atmosphere.F90:239</a></div></div>
<div class="ttc" id="structdycore__typedefs_1_1dycore__data__type_html"><div class="ttname"><a href="structdycore__typedefs_1_1dycore__data__type.html">dycore_typedefs::dycore_data_type</a></div><div class="ttdef"><b>Definition:</b> <a href="DYCORE__typedefs_8F90_source.html#l00094">DYCORE_typedefs.F90:94</a></div></div>
<div class="ttc" id="namespacefv__diagnostics__mod_html_acfb51973f4727b7ba5e27a04b28d3396"><div class="ttname"><a href="namespacefv__diagnostics__mod.html#acfb51973f4727b7ba5e27a04b28d3396">fv_diagnostics_mod::fv_diag_init</a></div><div class="ttdeci">subroutine, public fv_diag_init(Atm, axes, Time, npx, npy, npz, p_ref)</div><div class="ttdef"><b>Definition:</b> <a href="fv__diagnostics_8F90_source.html#l00201">fv_diagnostics.F90:201</a></div></div>
<div class="ttc" id="namespacefv__dynamics__mod_html_a57030300ce6aacf81a3588faf906f07f"><div class="ttname"><a href="namespacefv__dynamics__mod.html#a57030300ce6aacf81a3588faf906f07f">fv_dynamics_mod::fv_dynamics</a></div><div class="ttdeci">subroutine, public fv_dynamics(npx, npy, npz, nq_tot, ng, bdt, consv_te, fill, reproduce_sum, kappa, cp_air, zvir, ptop, ks, ncnst, n_split, q_split, u, v, w, delz, hydrostatic, pt, delp, q, ps, pe, pk, peln, pkz, phis, q_con, omga, ua, va, uc, vc, ak, bk, mfx, mfy, cx, cy, ze0, hybrid_z, gridstruct, flagstruct, neststruct, idiag, bd, parent_grid, domain, diss_est, time_total)</div><div class="ttdef"><b>Definition:</b> <a href="fv__dynamics_8F90_source.html#l00181">fv_dynamics.F90:181</a></div></div>
<div class="ttc" id="namespacefv__nggps__diags__mod_html"><div class="ttname"><a href="namespacefv__nggps__diags__mod.html">fv_nggps_diags_mod</a></div><div class="ttdoc">The module &amp;#39;fv_nggps_diags&amp;#39; computes output diagnostics entirely on 3D pressure levels. </div><div class="ttdef"><b>Definition:</b> <a href="fv__nggps__diag_8F90_source.html#l00028">fv_nggps_diag.F90:28</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a1a7a45008a0aebc7bce0bc31d6ded35c"><div class="ttname"><a href="namespaceatmosphere__mod.html#a1a7a45008a0aebc7bce0bc31d6ded35c">atmosphere_mod::isc</a></div><div class="ttdeci">integer isc</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00235">atmosphere.F90:235</a></div></div>
<div class="ttc" id="namespacefv__iau__mod_html"><div class="ttname"><a href="namespacefv__iau__mod.html">fv_iau_mod</a></div><div class="ttdoc">incremental analysis update module </div><div class="ttdef"><b>Definition:</b> <a href="fv__iau__mod_8F90_source.html#l00038">fv_iau_mod.F90:38</a></div></div>
<div class="ttc" id="namespacefv__nggps__diags__mod_html_a2067cd5af978609a6dc1614795abea87"><div class="ttname"><a href="namespacefv__nggps__diags__mod.html#a2067cd5af978609a6dc1614795abea87">fv_nggps_diags_mod::fv_nggps_diag</a></div><div class="ttdeci">subroutine, public fv_nggps_diag(Atm, zvir, Time)</div><div class="ttdef"><b>Definition:</b> <a href="fv__nggps__diag_8F90_source.html#l00436">fv_nggps_diag.F90:436</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a18b993ba126ae2c1baa890234cfcb289"><div class="ttname"><a href="namespaceatmosphere__mod.html#a18b993ba126ae2c1baa890234cfcb289">atmosphere_mod::get_bottom_wind</a></div><div class="ttdeci">subroutine get_bottom_wind(u_bot, v_bot)</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l01227">atmosphere.F90:1227</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a6af183d451e4d59e5cd97150b69e9ec7"><div class="ttname"><a href="namespaceatmosphere__mod.html#a6af183d451e4d59e5cd97150b69e9ec7">atmosphere_mod::graupel</a></div><div class="ttdeci">integer graupel</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00243">atmosphere.F90:243</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a0d51bfe05ec1bd062c1fbbc01c42bf3a"><div class="ttname"><a href="namespaceatmosphere__mod.html#a0d51bfe05ec1bd062c1fbbc01c42bf3a">atmosphere_mod::jed</a></div><div class="ttdeci">integer jed</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00236">atmosphere.F90:236</a></div></div>
<div class="ttc" id="namespacefv__nggps__diags__mod_html_ab37da1eb0394d52c06db856e9f875833"><div class="ttname"><a href="namespacefv__nggps__diags__mod.html#ab37da1eb0394d52c06db856e9f875833">fv_nggps_diags_mod::fv_nggps_diag_init</a></div><div class="ttdeci">subroutine, public fv_nggps_diag_init(Atm, axes, Time)</div><div class="ttdef"><b>Definition:</b> <a href="fv__nggps__diag_8F90_source.html#l00154">fv_nggps_diag.F90:154</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_af5d819faa34aef7024501c7696540bf0"><div class="ttname"><a href="namespaceatmosphere__mod.html#af5d819faa34aef7024501c7696540bf0">atmosphere_mod::atmosphere_diag_axes</a></div><div class="ttdeci">subroutine, public atmosphere_diag_axes(axes)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_diag_axes&amp;#39; is an API to return the axis indices for the atmospheric (mass)...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00896">atmosphere.F90:896</a></div></div>
<div class="ttc" id="namespacefv__nwp__nudge__mod_html_a824609f6aaef3ce3b013048f4402ecb6"><div class="ttname"><a href="namespacefv__nwp__nudge__mod.html#a824609f6aaef3ce3b013048f4402ecb6">fv_nwp_nudge_mod::fv_nwp_nudge_end</a></div><div class="ttdeci">subroutine, public fv_nwp_nudge_end</div><div class="ttdoc">The subroutine &amp;#39;fv_nwp_nudge_end&amp;#39; terminates the nudging module. </div><div class="ttdef"><b>Definition:</b> <a href="fv__nudge_8F90_source.html#l02085">fv_nudge.F90:2085</a></div></div>
<div class="ttc" id="namespacefv__arrays__mod_html"><div class="ttname"><a href="namespacefv__arrays__mod.html">fv_arrays_mod</a></div><div class="ttdoc">The module &amp;#39;fv_arrays&amp;#39; contains the &amp;#39;fv_atmos_type&amp;#39; and associated datatypes. </div><div class="ttdef"><b>Definition:</b> <a href="fv__arrays_8F90_source.html#l00024">fv_arrays.F90:24</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a6f65980184c149309238cf3926145607"><div class="ttname"><a href="namespaceatmosphere__mod.html#a6f65980184c149309238cf3926145607">atmosphere_mod::cold_start</a></div><div class="ttdeci">logical cold_start</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00240">atmosphere.F90:240</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a2b3029ec0c463f6b1b3b3b6f1b5a0ada"><div class="ttname"><a href="namespaceatmosphere__mod.html#a2b3029ec0c463f6b1b3b3b6f1b5a0ada">atmosphere_mod::set_atmosphere_pelist</a></div><div class="ttdeci">subroutine, public set_atmosphere_pelist()</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00866">atmosphere.F90:866</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a8245233dc81e751888853150262e6489"><div class="ttname"><a href="namespaceatmosphere__mod.html#a8245233dc81e751888853150262e6489">atmosphere_mod::v_dt</a></div><div class="ttdeci">real, dimension(:,:,:), allocatable v_dt</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00259">atmosphere.F90:259</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a972cd4fc5737c35941feca9dbb6e46a8"><div class="ttname"><a href="namespaceatmosphere__mod.html#a972cd4fc5737c35941feca9dbb6e46a8">atmosphere_mod::jsd</a></div><div class="ttdeci">integer jsd</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00236">atmosphere.F90:236</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_aafb92c94f8850295ad027e0538ae78ca"><div class="ttname"><a href="namespaceatmosphere__mod.html#aafb92c94f8850295ad027e0538ae78ca">atmosphere_mod::seconds</a></div><div class="ttdeci">integer seconds</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00238">atmosphere.F90:238</a></div></div>
<div class="ttc" id="namespacefv__eta__mod_html"><div class="ttname"><a href="namespacefv__eta__mod.html">fv_eta_mod</a></div><div class="ttdoc">The module &amp;#39;fv_eta&amp;#39; contains routine to set up the reference (Eulerian) pressure coordinate. </div><div class="ttdef"><b>Definition:</b> <a href="fv__eta_8F90_source.html#l00025">fv_eta.F90:25</a></div></div>
<div class="ttc" id="namespacefv__nesting__mod_html_afedcc378d1c25e2b9d58ea796dc10b9b"><div class="ttname"><a href="namespacefv__nesting__mod.html#afedcc378d1c25e2b9d58ea796dc10b9b">fv_nesting_mod::twoway_nesting</a></div><div class="ttdeci">subroutine, public twoway_nesting(Atm, ngrids, grids_on_this_pe, zvir)</div><div class="ttdoc">The subroutine&amp;#39;twoway_nesting&amp;#39; performs a two-way update of nested-grid data onto the parent grid...</div><div class="ttdef"><b>Definition:</b> <a href="fv__nesting_8F90_source.html#l01044">fv_nesting.F90:1044</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a775666c64f59edcf96c530c1fc0f1ee9"><div class="ttname"><a href="namespaceatmosphere__mod.html#a775666c64f59edcf96c530c1fc0f1ee9">atmosphere_mod::ied</a></div><div class="ttdeci">integer ied</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00236">atmosphere.F90:236</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a72d23c8d327e3066174b6e43f5697494"><div class="ttname"><a href="namespaceatmosphere__mod.html#a72d23c8d327e3066174b6e43f5697494">atmosphere_mod::mytile</a></div><div class="ttdeci">integer, public mytile</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00248">atmosphere.F90:248</a></div></div>
<div class="ttc" id="namespacefv__diagnostics__mod_html_a6f0646bd762a9150bf0636f22f70cfbc"><div class="ttname"><a href="namespacefv__diagnostics__mod.html#a6f0646bd762a9150bf0636f22f70cfbc">fv_diagnostics_mod::fv_diag</a></div><div class="ttdeci">subroutine, public fv_diag(Atm, zvir, Time, print_freq)</div><div class="ttdef"><b>Definition:</b> <a href="fv__diagnostics_8F90_source.html#l01091">fv_diagnostics.F90:1091</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html"><div class="ttname"><a href="namespaceatmosphere__mod.html">atmosphere_mod</a></div><div class="ttdoc">The module &amp;#39;atmosphere&amp;#39; provides the interface for the Cubed-Sphere FV dynamical core. </div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00026">atmosphere.F90:26</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_ac2c4834fc822689255bc707f8405fed1"><div class="ttname"><a href="namespaceatmosphere__mod.html#ac2c4834fc822689255bc707f8405fed1">atmosphere_mod::w0_big</a></div><div class="ttdeci">real, parameter w0_big</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00256">atmosphere.F90:256</a></div></div>
<div class="ttc" id="structfv__iau__mod_1_1iau__external__data__type_html"><div class="ttname"><a href="structfv__iau__mod_1_1iau__external__data__type.html">fv_iau_mod::iau_external_data_type</a></div><div class="ttdef"><b>Definition:</b> <a href="fv__iau__mod_8F90_source.html#l00088">fv_iau_mod.F90:88</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a55d141fa3702c01dae8e656e283827dc"><div class="ttname"><a href="namespaceatmosphere__mod.html#a55d141fa3702c01dae8e656e283827dc">atmosphere_mod::atmosphere_resolution</a></div><div class="ttdeci">subroutine, public atmosphere_resolution(i_size, j_size, global)</div><div class="ttdoc">The subroutine &amp;#39;atmospehre_resolution&amp;#39; is an API to return the local extents of the current MPI-rank ...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00781">atmosphere.F90:781</a></div></div>
<div class="ttc" id="namespacefv__regional__mod_html"><div class="ttname"><a href="namespacefv__regional__mod.html">fv_regional_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="fv__regional__bc_8F90_source.html#l00022">fv_regional_bc.F90:22</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a41f34859d8c8fd6e84cd71aabd6d2a25"><div class="ttname"><a href="namespaceatmosphere__mod.html#a41f34859d8c8fd6e84cd71aabd6d2a25">atmosphere_mod::liq_wat</a></div><div class="ttdeci">integer liq_wat</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00243">atmosphere.F90:243</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_ad2c962b25778b4cbd91b48874a52ab95"><div class="ttname"><a href="namespaceatmosphere__mod.html#ad2c962b25778b4cbd91b48874a52ab95">atmosphere_mod::atmosphere_etalvls</a></div><div class="ttdeci">subroutine, public atmosphere_etalvls(ak, bk, flip)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_etalvls&amp;#39; is an API to return the ak/bk pairs used to compute the eta or pr...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00913">atmosphere.F90:913</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a38757921a7432338ac2a4135dbc7d9c8"><div class="ttname"><a href="namespaceatmosphere__mod.html#a38757921a7432338ac2a4135dbc7d9c8">atmosphere_mod::atmosphere_init</a></div><div class="ttdeci">subroutine, public atmosphere_init(Time_init, Time, Time_step, Grid_box, area)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_init&amp;#39; is an API to initialize the FV3 dynamical core, including the grid s...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00271">atmosphere.F90:271</a></div></div>
<div class="ttc" id="namespacedyn__core__mod_html_ad3018f7acb1006fc424bd0bcaad8b320"><div class="ttname"><a href="namespacedyn__core__mod.html#ad3018f7acb1006fc424bd0bcaad8b320">dyn_core_mod::del2_cubed</a></div><div class="ttdeci">subroutine, public del2_cubed(q, cd, gridstruct, domain, npx, npy, km, nmax, bd)</div><div class="ttdoc">The subroutine &amp;#39;del2-cubed&amp;#39; filters the omega field for the physics. </div><div class="ttdef"><b>Definition:</b> <a href="dyn__core_8F90_source.html#l02421">dyn_core.F90:2421</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a65be72573dcfd288a47a65ffaf881284"><div class="ttname"><a href="namespaceatmosphere__mod.html#a65be72573dcfd288a47a65ffaf881284">atmosphere_mod::atm</a></div><div class="ttdeci">type(fv_atmos_type), dimension(:), allocatable, target, public atm</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00252">atmosphere.F90:252</a></div></div>
<div class="ttc" id="namespacefv__fill__mod_html_a527172ca182ebcb99a72bdbd536165d2"><div class="ttname"><a href="namespacefv__fill__mod.html#a527172ca182ebcb99a72bdbd536165d2">fv_fill_mod::fill_gfs</a></div><div class="ttdeci">subroutine, public fill_gfs(im, km, pe2, q, q_min)</div><div class="ttdoc">The subroutine &amp;#39;fill_gfs&amp;#39; is for mass-conservative filling of nonphysical negative values in the trac...</div><div class="ttdef"><b>Definition:</b> <a href="fv__fill_8F90_source.html#l00163">fv_fill.F90:163</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a40b6e75a5e8c4bafc747edc08eceaed5"><div class="ttname"><a href="namespaceatmosphere__mod.html#a40b6e75a5e8c4bafc747edc08eceaed5">atmosphere_mod::pelist</a></div><div class="ttdeci">integer, dimension(:), allocatable pelist</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00250">atmosphere.F90:250</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_aa742152443b418c81cda5ab32bf17f0e"><div class="ttname"><a href="namespaceatmosphere__mod.html#aa742152443b418c81cda5ab32bf17f0e">atmosphere_mod::p_adi</a></div><div class="ttdeci">subroutine p_adi(km, ng, ifirst, ilast, jfirst, jlast, ptop, delp, pt, ps, pe, peln, pk, pkz, hydrostatic)</div><div class="ttdoc">The subroutine &amp;#39;p_adi&amp;#39; computes (ps, pk, pe, peln, pkz) given (ptop, delp). </div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00547">atmosphere.F90:547</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a313b4e35ea4020ee6ce916400b716e81"><div class="ttname"><a href="namespaceatmosphere__mod.html#a313b4e35ea4020ee6ce916400b716e81">atmosphere_mod::zvir</a></div><div class="ttdeci">real zvir</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00233">atmosphere.F90:233</a></div></div>
<div class="ttc" id="namespacefv__diagnostics__mod_html_ad47b1fcfcd29f3dc6009a3a52208a573"><div class="ttname"><a href="namespacefv__diagnostics__mod.html#ad47b1fcfcd29f3dc6009a3a52208a573">fv_diagnostics_mod::fv_time</a></div><div class="ttdeci">type(time_type), public fv_time</div><div class="ttdef"><b>Definition:</b> <a href="fv__diagnostics_8F90_source.html#l00166">fv_diagnostics.F90:166</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a9d5b133b6c0010773c3f475af7e879fc"><div class="ttname"><a href="namespaceatmosphere__mod.html#a9d5b133b6c0010773c3f475af7e879fc">atmosphere_mod::ice_wat</a></div><div class="ttdeci">integer ice_wat</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00243">atmosphere.F90:243</a></div></div>
<div class="ttc" id="namespacemulti__gases__mod_html_a85983a7159ef293fa1c2d65647a66400"><div class="ttname"><a href="namespacemulti__gases__mod.html#a85983a7159ef293fa1c2d65647a66400">multi_gases_mod::cpi</a></div><div class="ttdeci">real, dimension(:), allocatable cpi</div><div class="ttdef"><b>Definition:</b> <a href="multi__gases_8F90_source.html#l00049">multi_gases.F90:49</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a15f14a6344439b29298bfb2b37d9c694"><div class="ttname"><a href="namespaceatmosphere__mod.html#a15f14a6344439b29298bfb2b37d9c694">atmosphere_mod::atmosphere_pref</a></div><div class="ttdeci">subroutine, public atmosphere_pref(p_ref)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_pref&amp;#39; is an API to return the reference pressure. </div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00801">atmosphere.F90:801</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_aa26f13c1bf254400bc1d3c556bc4b2f7"><div class="ttname"><a href="namespaceatmosphere__mod.html#aa26f13c1bf254400bc1d3c556bc4b2f7">atmosphere_mod::npx</a></div><div class="ttdeci">integer npx</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00234">atmosphere.F90:234</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a638b8d7ecc568cfe3706105b9db0affe"><div class="ttname"><a href="namespaceatmosphere__mod.html#a638b8d7ecc568cfe3706105b9db0affe">atmosphere_mod::snowwat</a></div><div class="ttdeci">integer snowwat</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00243">atmosphere.F90:243</a></div></div>
<div class="ttc" id="namespacefv__timing__mod_html_a85fb4c4c6b3d9604bb682356ab3e7a82"><div class="ttname"><a href="namespacefv__timing__mod.html#a85fb4c4c6b3d9604bb682356ab3e7a82">fv_timing_mod::timing_on</a></div><div class="ttdeci">subroutine timing_on(blk_name)</div><div class="ttdoc">The subroutine &amp;#39;timing_on&amp;#39; starts a timer. </div><div class="ttdef"><b>Definition:</b> <a href="fv__timing_8F90_source.html#l00116">fv_timing.F90:116</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a26b6f2e397bc0d76f12ae674aad670be"><div class="ttname"><a href="namespaceatmosphere__mod.html#a26b6f2e397bc0d76f12ae674aad670be">atmosphere_mod::isd</a></div><div class="ttdeci">integer isd</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00236">atmosphere.F90:236</a></div></div>
<div class="ttc" id="namespacefv__diagnostics__mod_html"><div class="ttname"><a href="namespacefv__diagnostics__mod.html">fv_diagnostics_mod</a></div><div class="ttdoc">@ The module &amp;#39;fv_diagnostics&amp;#39; contains routines to compute diagnosic fields. </div><div class="ttdef"><b>Definition:</b> <a href="fv__diagnostics_8F90_source.html#l00024">fv_diagnostics.F90:24</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a1648cbd61c86f2e8890375435b532a5d"><div class="ttname"><a href="namespaceatmosphere__mod.html#a1648cbd61c86f2e8890375435b532a5d">atmosphere_mod::atmosphere_restart</a></div><div class="ttdeci">subroutine, public atmosphere_restart(timestamp)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_restart&amp;#39; is an API to save restart information at a given timestamp...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00770">atmosphere.F90:770</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a794b092a72b516a3078dbff077136a08"><div class="ttname"><a href="namespaceatmosphere__mod.html#a794b092a72b516a3078dbff077136a08">atmosphere_mod::sphum</a></div><div class="ttdeci">integer sphum</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00243">atmosphere.F90:243</a></div></div>
<div class="ttc" id="namespacedyn__core__mod_html"><div class="ttname"><a href="namespacedyn__core__mod.html">dyn_core_mod</a></div><div class="ttdoc">The module &amp;#39;dyn_core&amp;#39; peforms the Lagrangian acoustic dynamics described by . </div><div class="ttdef"><b>Definition:</b> <a href="dyn__core_8F90_source.html#l00028">dyn_core.F90:28</a></div></div>
<div class="ttc" id="namespacefv__diagnostics__mod_html_a1fad494d94b2fd086c4003778d3f9f63"><div class="ttname"><a href="namespacefv__diagnostics__mod.html#a1fad494d94b2fd086c4003778d3f9f63">fv_diagnostics_mod::prt_maxmin</a></div><div class="ttdeci">subroutine, public prt_maxmin(qname, q, is, ie, js, je, n_g, km, fac)</div><div class="ttdef"><b>Definition:</b> <a href="fv__diagnostics_8F90_source.html#l03210">fv_diagnostics.F90:3210</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_ad4f4fdf067d2b71eb5764b34cea8cb92"><div class="ttname"><a href="namespaceatmosphere__mod.html#ad4f4fdf067d2b71eb5764b34cea8cb92">atmosphere_mod::mod_name</a></div><div class="ttdeci">character(len=20) mod_name</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00225">atmosphere.F90:225</a></div></div>
<div class="ttc" id="structfv__arrays__mod_1_1fv__atmos__type_html"><div class="ttname"><a href="structfv__arrays__mod_1_1fv__atmos__type.html">fv_arrays_mod::fv_atmos_type</a></div><div class="ttdef"><b>Definition:</b> <a href="fv__arrays_8F90_source.html#l01166">fv_arrays.F90:1166</a></div></div>
<div class="ttc" id="namespacefv__regional__mod_html_a0d3b818eb47e19e7254ccd506c5a5895"><div class="ttname"><a href="namespacefv__regional__mod.html#a0d3b818eb47e19e7254ccd506c5a5895">fv_regional_mod::start_regional_restart</a></div><div class="ttdeci">subroutine, public start_regional_restart(Atm, isc, iec, jsc, jec, isd, ied, jsd, jed)</div><div class="ttdef"><b>Definition:</b> <a href="fv__regional__bc_8F90_source.html#l01140">fv_regional_bc.F90:1140</a></div></div>
<div class="ttc" id="namespacefv__regional__mod_html_a7d48ecf3376e882113cf29f2c50b996c"><div class="ttname"><a href="namespacefv__regional__mod.html#a7d48ecf3376e882113cf29f2c50b996c">fv_regional_mod::a_step</a></div><div class="ttdeci">integer, public a_step</div><div class="ttdef"><b>Definition:</b> <a href="fv__regional__bc_8F90_source.html#l00183">fv_regional_bc.F90:183</a></div></div>
<div class="ttc" id="namespacefv__sg__mod_html_a12f8e293e862927c307b386cdd8217cb"><div class="ttname"><a href="namespacefv__sg__mod.html#a12f8e293e862927c307b386cdd8217cb">fv_sg_mod::fv_subgrid_z</a></div><div class="ttdeci">subroutine, public fv_subgrid_z(isd, ied, jsd, jed, is, ie, js, je, km, nq, dt, tau, nwat, delp, pe, peln, pkz, ta, qa, ua, va, hydrostatic, w, delz, u_dt, v_dt, t_dt, q_dt, k_bot)</div><div class="ttdef"><b>Definition:</b> <a href="fv__sg_8F90_source.html#l00680">fv_sg.F90:680</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a532d3470860edef9ff203c5fc8e0b39d"><div class="ttname"><a href="namespaceatmosphere__mod.html#a532d3470860edef9ff203c5fc8e0b39d">atmosphere_mod::pref</a></div><div class="ttdeci">real, dimension(:,:), allocatable pref</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00260">atmosphere.F90:260</a></div></div>
<div class="ttc" id="namespacefv__restart__mod_html"><div class="ttname"><a href="namespacefv__restart__mod.html">fv_restart_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="fv__restart_8F90_source.html#l00022">fv_restart.F90:22</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_af9fa6ffe6500a97af113b7a6afb348a6"><div class="ttname"><a href="namespaceatmosphere__mod.html#af9fa6ffe6500a97af113b7a6afb348a6">atmosphere_mod::atmosphere_scalar_field_halo</a></div><div class="ttdeci">subroutine, public atmosphere_scalar_field_halo(data, halo, isize, jsize, ksize, data_p)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_scalar_field_halo&amp;#39; is an API to return halo information of the current MPI...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00995">atmosphere.F90:995</a></div></div>
<div class="ttc" id="namespacefv__nwp__nudge__mod_html_ac6397ea7496a338d4a086a95bb58fa38"><div class="ttname"><a href="namespacefv__nwp__nudge__mod.html#ac6397ea7496a338d4a086a95bb58fa38">fv_nwp_nudge_mod::fv_nwp_nudge_init</a></div><div class="ttdeci">subroutine, public fv_nwp_nudge_init(time, axes, npz, zvir, ak, bk, ts, phis, gridstruct, ks, npx, neststruct, bd)</div><div class="ttdoc">The subroutine &amp;#39;fv_nwp_nudge_init&amp;#39; initializes the nudging module. </div><div class="ttdef"><b>Definition:</b> <a href="fv__nudge_8F90_source.html#l01257">fv_nudge.F90:1257</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a008a0c84b653d2f8027039570957c12c"><div class="ttname"><a href="namespaceatmosphere__mod.html#a008a0c84b653d2f8027039570957c12c">atmosphere_mod::atmosphere_nggps_diag</a></div><div class="ttdeci">subroutine, public atmosphere_nggps_diag(Time, init, ltavg, avg_max_length)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_nggps_diag&amp;#39; is an API to trigger output of diagnostics in NCEP/EMC format...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l01101">atmosphere.F90:1101</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_ac1b450b5b014a927fb0456a5b8e73710"><div class="ttname"><a href="namespaceatmosphere__mod.html#ac1b450b5b014a927fb0456a5b8e73710">atmosphere_mod::id_dynam</a></div><div class="ttdeci">integer id_dynam</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00239">atmosphere.F90:239</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_abf96613ef8db32b3e66f3297f62a0346"><div class="ttname"><a href="namespaceatmosphere__mod.html#abf96613ef8db32b3e66f3297f62a0346">atmosphere_mod::atmosphere_state_update</a></div><div class="ttdeci">subroutine, public atmosphere_state_update(Time, IPD_Data, IAU_Data, Atm_block, flip_vc)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_state_update&amp;#39; is an API to apply tendencies and compute a consistent progn...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l01387">atmosphere.F90:1387</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_ad9345d06c2a877903e3bfdfb529a2a63"><div class="ttname"><a href="namespaceatmosphere__mod.html#ad9345d06c2a877903e3bfdfb529a2a63">atmosphere_mod::rainwat</a></div><div class="ttdeci">integer rainwat</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00243">atmosphere.F90:243</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_abe192872a4a5b42159d0c2251ac9cb14"><div class="ttname"><a href="namespaceatmosphere__mod.html#abe192872a4a5b42159d0c2251ac9cb14">atmosphere_mod::sec</a></div><div class="ttdeci">integer sec</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00238">atmosphere.F90:238</a></div></div>
<div class="ttc" id="namespacefv__control__mod_html"><div class="ttname"><a href="namespacefv__control__mod.html">fv_control_mod</a></div><div class="ttdoc">The module &amp;#39;FV3_control&amp;#39; is for initialization and termination of the model, and controls namelist pa...</div><div class="ttdef"><b>Definition:</b> <a href="fv__control_8F90_source.html#l00031">fv_control.F90:31</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a3f2bb9d476f9525e20747fd29951dde5"><div class="ttname"><a href="namespaceatmosphere__mod.html#a3f2bb9d476f9525e20747fd29951dde5">atmosphere_mod::atmosphere_grid_bdry</a></div><div class="ttdeci">subroutine, public atmosphere_grid_bdry(blon, blat, global)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_grid_bdry&amp;#39; is an API to returns the longitude and latitude finite volume e...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00845">atmosphere.F90:845</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_ab0f4510c9097aa7a29c57c545aa02976"><div class="ttname"><a href="namespaceatmosphere__mod.html#ab0f4510c9097aa7a29c57c545aa02976">atmosphere_mod::iec</a></div><div class="ttdeci">integer iec</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00235">atmosphere.F90:235</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a9a51c2f1c5e1cf01dcf112478ecf8cf4"><div class="ttname"><a href="namespaceatmosphere__mod.html#a9a51c2f1c5e1cf01dcf112478ecf8cf4">atmosphere_mod::atmosphere_grid_ctr</a></div><div class="ttdeci">subroutine, public atmosphere_grid_ctr(lon, lat)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_grid_ctr&amp;#39; is an API that returns the longitude and latitude cell centers o...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00828">atmosphere.F90:828</a></div></div>
<div class="ttc" id="namespacefv__control__mod_html_a94ddeaf4916cd0adc5a56db5ec3c5081"><div class="ttname"><a href="namespacefv__control__mod.html#a94ddeaf4916cd0adc5a56db5ec3c5081">fv_control_mod::fv_end</a></div><div class="ttdeci">subroutine, public fv_end(Atm, grids_on_this_pe)</div><div class="ttdoc">The subroutine &amp;#39;fv_end&amp;#39; terminates FV3, deallocates memory, saves restart files, and stops I/O...</div><div class="ttdef"><b>Definition:</b> <a href="fv__control_8F90_source.html#l00598">fv_control.F90:598</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a0ac3bd99046244dd0abfa4719b688bc0"><div class="ttname"><a href="namespaceatmosphere__mod.html#a0ac3bd99046244dd0abfa4719b688bc0">atmosphere_mod::jec</a></div><div class="ttdeci">integer jec</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00235">atmosphere.F90:235</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a9a8c995d33f2c1869ae7d0b49d5e1002"><div class="ttname"><a href="namespaceatmosphere__mod.html#a9a8c995d33f2c1869ae7d0b49d5e1002">atmosphere_mod::ncnst</a></div><div class="ttdeci">integer ncnst</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00234">atmosphere.F90:234</a></div></div>
<div class="ttc" id="namespacefv__fill__mod_html"><div class="ttname"><a href="namespacefv__fill__mod.html">fv_fill_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="fv__fill_8F90_source.html#l00021">fv_fill.F90:21</a></div></div>
<div class="ttc" id="namespacefv__regional__mod_html_ae3ebee89f81e0493a8c7e17875152d72"><div class="ttname"><a href="namespacefv__regional__mod.html#ae3ebee89f81e0493a8c7e17875152d72">fv_regional_mod::read_new_bc_data</a></div><div class="ttdeci">subroutine, public read_new_bc_data(Atm, Time, Time_step_atmos, p_split, isd, ied, jsd, jed)</div><div class="ttdef"><b>Definition:</b> <a href="fv__regional__bc_8F90_source.html#l01222">fv_regional_bc.F90:1222</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a8bd26483e8952209607d542434d5a1f1"><div class="ttname"><a href="namespaceatmosphere__mod.html#a8bd26483e8952209607d542434d5a1f1">atmosphere_mod::dt_atmos</a></div><div class="ttdeci">real dt_atmos</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00232">atmosphere.F90:232</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a6d434f016963346507b32a22b7f41440"><div class="ttname"><a href="namespaceatmosphere__mod.html#a6d434f016963346507b32a22b7f41440">atmosphere_mod::id_fv_diag</a></div><div class="ttdeci">integer id_fv_diag</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00239">atmosphere.F90:239</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_a35547644843aec32773bc727b07252de"><div class="ttname"><a href="namespaceatmosphere__mod.html#a35547644843aec32773bc727b07252de">atmosphere_mod::atmosphere_domain</a></div><div class="ttdeci">subroutine, public atmosphere_domain(fv_domain, layout, regional, nested, pelist)</div><div class="ttdoc">The subroutine &amp;#39;atmosphere_domain&amp;#39; is an API to return the &quot;domain2d&quot; variable associated with the co...</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00875">atmosphere.F90:875</a></div></div>
<div class="ttc" id="namespacefv__nesting__mod_html"><div class="ttname"><a href="namespacefv__nesting__mod.html">fv_nesting_mod</a></div><div class="ttdoc">The module &amp;#39;fv_nesting&amp;#39; is a collection of routines pertaining to grid nesting . </div><div class="ttdef"><b>Definition:</b> <a href="fv__nesting_8F90_source.html#l00027">fv_nesting.F90:27</a></div></div>
<div class="ttc" id="namespaceatmosphere__mod_html_adeb134091a56f59ab4c371a3855a6bdc"><div class="ttname"><a href="namespaceatmosphere__mod.html#adeb134091a56f59ab4c371a3855a6bdc">atmosphere_mod::t_dt</a></div><div class="ttdeci">real, dimension(:,:,:), allocatable t_dt</div><div class="ttdef"><b>Definition:</b> <a href="atmosphere_8F90_source.html#l00259">atmosphere.F90:259</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_1284b95147afa48b330f502c8bbc0529.html">driver</a></li><li class="navelem"><a class="el" href="dir_ef13d85282fd0ff3db59aa5e99d2bcaa.html">fvGFS</a></li><li class="navelem"><a class="el" href="atmosphere_8F90.html">atmosphere.F90</a></li>
    <li class="footer">Generated on Wed Dec 11 2019 15:12:40 for FV3DYCORE by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
